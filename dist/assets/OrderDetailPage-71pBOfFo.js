import{h as F,u as _,b as R,c as S,j as e,L as U,a as d}from"./index-425XPhkP.js";import{r as l,h as I,A as L,H as $,J as V}from"./ui-libs-xkhqbQ7p.js";import{N as q}from"./NotificationModal-Du1quDf6.js";import"./vendor-qkC6yhPU.js";const A=()=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"});function J(){const{orderId:o}=F(),m=_(),x=A(),{user:c}=R(),[u,g]=l.useState(!1),[p,f]=l.useState(!1),[h,b]=l.useState(!1),[y,w]=l.useState(!1),j=I.useRef(null),[i,n]=l.useState({isOpen:!1,title:"",message:"",variant:"info"}),{data:t,isLoading:C,error:v}=S({queryKey:["orderDetail",o],queryFn:()=>d.fetchOrderDetail(o),enabled:!!o&&!!c?.id}),D=async()=>{g(!0);try{const r=await d.downloadOrderPDF(o),a=window.URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`Pedido_${o}.pdf`,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a)}catch(r){console.error("Error al descargar el PDF:",r),console.error("Error al descargar el PDF:",r),n({isOpen:!0,title:"Error",message:`No se pudo descargar el PDF: ${r.message}`,variant:"error"})}finally{g(!1)}},P=async()=>{f(!0);try{const r=await d.downloadOrderCSV(o),a=window.URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`Pedido_${o}.csv`,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a)}catch(r){console.error("Error al descargar el CSV:",r),console.error("Error al descargar el CSV:",r),n({isOpen:!0,title:"Error",message:`No se pudo descargar el CSV: ${r.message}`,variant:"error"})}finally{f(!1)}},O=async r=>{const a=r.target.files[0];if(!a)return;if(a.type!=="application/pdf"&&a.type!=="application/pdf"){n({isOpen:!0,title:"Error",message:"Solo se permiten archivos PDF.",variant:"error"});return}b(!0);const s=new FormData;s.append("invoiceFile",a);try{await d.uploadOrderInvoice(o,s),await d.uploadOrderInvoice(o,s),n({isOpen:!0,title:"Éxito",message:"Factura subida exitosamente.",variant:"success"}),window.location.reload()}catch(N){console.error("Error al subir factura:",N),n({isOpen:!0,title:"Error",message:`Error al subir factura: ${N.message}`,variant:"error"})}finally{b(!1)}},k=async()=>{w(!0);try{const r=await d.downloadOrderInvoice(o),a=window.URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`Factura_Pedido_${o}.pdf`,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a)}catch(r){console.error("Error al descargar factura:",r),console.error("Error al descargar factura:",r),n({isOpen:!0,title:"Error",message:`Error al descargar factura: ${r.message}`,variant:"error"})}finally{w(!1)}},E=()=>{j.current?.click()};return C?e.jsx(U,{text:"Cargando detalles del pedido..."}):v?e.jsxs("div",{children:["Error al cargar el pedido: ",v.message]}):t?e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-6 border-b-2 border-gray-200 pb-2",children:["Detalle del Pedido #",t.id]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8 items-center",children:[e.jsx("button",{onClick:()=>m("/order-history"),className:"hidden md:block px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors duration-200 font-semibold",children:"Volver al Historial"}),e.jsxs("button",{onClick:()=>m("/order-history"),className:"md:hidden flex items-center text-gray-600 mb-2 self-start",children:[e.jsx(L,{className:"w-5 h-5 mr-1"}),"Volver"]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsx("button",{onClick:D,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200",disabled:u,children:u?"PDF...":"Descargar PDF"}),c?.role==="vendedor"&&e.jsx("button",{onClick:P,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",disabled:p,children:p?"CSV...":"Descargar CSV"}),t.invoice_url&&e.jsxs("button",{onClick:k,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200",disabled:y,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),y?"Descargando...":"Descargar Factura"]}),c?.role==="vendedor"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:j,className:"hidden",accept:"application/pdf",onChange:O}),e.jsxs("button",{onClick:E,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors duration-200",disabled:h,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),h?"Subiendo...":"Adjuntar Factura"]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-8 shadow-md relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-900",children:"Fecha:"})," ",t.formatted_date]}),t.client_name&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-900",children:"Cliente:"})," ",t.client_code," - ",t.client_name]}),t.status==="Confirmado"&&t.vendor_sales_order_number&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-900",children:"N° Pedido Venta:"})," #",t.vendor_sales_order_number]}),e.jsxs("p",{className:"md:hidden",children:[e.jsx("strong",{className:"text-gray-900",children:"Estado:"})," ",t.status]})]}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("strong",{className:"text-gray-700",children:"Estado:"})," ",t.status]}),e.jsx("div",{className:`md:hidden absolute top-0 right-0 px-3 py-1 rounded-bl-lg text-xs font-bold uppercase tracking-wide
                ${t.status==="Pendiente"?"bg-yellow-100 text-yellow-800":""}
                ${t.status==="Confirmado"?"bg-green-100 text-green-800":""}
                ${t.status==="Cancelado"||t.status==="Rechazado"?"bg-red-100 text-red-800":""}
                ${["Pendiente","Confirmado","Cancelado","Rechazado"].includes(t.status)?"":"bg-gray-100 text-gray-800"}
            `,children:t.status})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex justify-between items-end",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Total del Pedido:"}),e.jsx("span",{className:"text-2xl font-bold text-[#183B64]",children:t.formattedTotal})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mt-8 mb-3 border-b-2 border-gray-200 pb-2",children:"Items del Pedido"}),e.jsx("div",{className:"md:hidden space-y-4",children:t.items.map(r=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 leading-snug",children:r.product_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Cód: ",r.product_code]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-50 text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:[r.quantity," x ",r.formattedPrice]}),e.jsx("div",{className:"font-bold text-gray-900",children:x.format(r.quantity*r.unit_price)})]})]},r.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto bg-white rounded-lg shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Código"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Precio Unit."}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Subtotal"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.items.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800",children:r.product_code}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800",children:r.product_name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:r.quantity}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:r.formattedPrice}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:x.format(r.quantity*r.unit_price)})]},r.id))})]})}),e.jsx(q,{isOpen:i.isOpen,onClose:()=>n({...i,isOpen:!1}),title:i.title,message:i.message,variant:i.variant})]}):e.jsx("div",{children:"Pedido no encontrado."})}export{J as default};
