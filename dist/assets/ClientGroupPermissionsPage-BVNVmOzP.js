import{b as k,r as t,j as r,d as U,a as g}from"./index-D9tNegem.js";import{C as $}from"./CustomSelect-Rgf5NQO_.js";import"./check-TxVrsHns.js";const B=()=>{const{user:a}=k(),[y,N]=t.useState([]),[p,S]=t.useState(""),[w,v]=t.useState([]),[l,_]=t.useState(""),[m,d]=t.useState([]),[h,P]=t.useState(""),[G,x]=t.useState(!1),[b,c]=t.useState(!1),[f,o]=t.useState(null),[C,j]=t.useState("");t.useEffect(()=>{(async()=>{if(!a||!a.is_admin){o("Acceso denegado. Requiere permisos de administrador."),c(!1);return}try{c(!0);const[s,n]=await Promise.all([g.getAdminUsers(),g.getAdminProductGroups()]);N(s),v(n),o(null)}catch(s){o("Error al cargar datos iniciales. Asegúrese de tener permisos de administrador."),console.error(s)}finally{c(!1)}})()},[a]),t.useEffect(()=>{if(!l||!a||!a.is_admin){d([]);return}(async()=>{try{c(!0),o(null);const s=await g.getDeniedProductGroups(l);d(s)}catch(s){o("Error al cargar los permisos para el cliente seleccionado."),console.error(s)}finally{c(!1)}})()},[l,a]);const L=e=>{d(s=>s.includes(e)?s.filter(n=>n!==e):[...s,e])},A=async()=>{if(!l){o("Por favor, seleccione un cliente primero.");return}if(!a||!a.is_admin){o("Acceso denegado. Requiere permisos de administrador para guardar.");return}try{c(!0),o(null),j(""),await g.updateUserGroupPermissions(l,m),j("Permisos guardados con éxito.")}catch(e){o("Error al guardar los permisos."),console.error(e)}finally{c(!1)}},D=y.filter(e=>e.full_name&&e.full_name.toLowerCase().includes(p.toLowerCase())||e.email&&e.email.toLowerCase().includes(p.toLowerCase())||e.a1_cod&&e.a1_cod.toLowerCase().includes(p.toLowerCase())),i=w.filter(e=>e.product_group&&e.product_group.toLowerCase().includes(h.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(h.toLowerCase())),E=e=>{const s=e.target.checked;x(s);const n=i.map(u=>u.product_group);d(s?u=>[...new Set([...u,...n])]:u=>u.filter(F=>!n.includes(F)))};return t.useEffect(()=>{i.length>0&&i.every(e=>m.includes(e.product_group))?x(!0):x(!1)},[i,m]),b&&!f?r.jsx(U,{text:"Cargando..."}):f?r.jsx("div",{className:"text-center p-8 text-red-500",children:f}):!a||!a.is_admin?r.jsx("div",{className:"text-center p-8 text-red-500",children:"Acceso denegado. No tiene permisos de administrador para ver esta página."}):r.jsxs("div",{className:"p-8 max-w-4xl mx-auto bg-gray-50 rounded-lg shadow-md",children:[r.jsx("h2",{className:"text-center mb-8 text-gray-800",children:"Gestionar Permisos por Grupo de Producto"}),C&&r.jsx("p",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:C}),r.jsxs("div",{className:"mb-8 flex flex-col items-stretch gap-3",children:[r.jsx("label",{htmlFor:"user-search",className:"font-bold",children:"Buscar Cliente:"}),r.jsx("input",{type:"text",id:"user-search",value:p,onChange:e=>S(e.target.value),placeholder:"Filtrar por nombre, email o código...",className:"p-2 rounded border border-gray-300 w-full"}),r.jsx("label",{htmlFor:"client-select",className:"font-bold",children:"Seleccionar Cliente:"}),r.jsx($,{options:D.map(e=>({label:`${e.full_name} (${e.email})`,value:e.id})),value:l,onChange:e=>_(e),placeholder:"-- Seleccione un cliente --"})]}),l&&r.jsxs("div",{className:"mt-4 p-6 border border-gray-200 rounded-lg bg-white",children:[r.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[r.jsx("label",{htmlFor:"product-group-filter",className:"font-bold",children:"Filtrar Grupos:"}),r.jsx("input",{type:"text",id:"product-group-filter",value:h,onChange:e=>P(e.target.value),placeholder:"Filtrar por grupo o marca...",className:"p-2 rounded border border-gray-300 flex-grow"})]}),r.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"select-all-groups",checked:G,onChange:E,className:"w-5 h-5"}),r.jsx("label",{htmlFor:"select-all-groups",className:"font-bold",children:"Seleccionar todos los grupos filtrados"})]}),r.jsx("h3",{className:"mt-0 mb-6 border-b pb-4 text-xl font-semibold text-gray-700",children:"Grupos de Productos Denegados"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8",children:i.map(e=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:`group-${e.product_group}`,checked:m.includes(e.product_group),onChange:()=>L(e.product_group),className:"w-5 h-5"}),r.jsxs("label",{htmlFor:`group-${e.product_group}`,children:[e.product_group," ",r.jsxs("span",{className:"text-gray-600 text-sm ml-1",children:["(",e.brand,")"]})]})]},e.product_group))}),r.jsx("button",{onClick:A,disabled:b,className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Guardar Permisos"})]})]})};export{B as default};
