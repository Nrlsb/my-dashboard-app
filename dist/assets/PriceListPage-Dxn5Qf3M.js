import{c as V,a as K,u as Q,r as o,j as e,f as H,C as W,b as N}from"./index-DdJE43U1.js";import{u as X}from"./useQuery-BEQRBtFK.js";import{u as Y}from"./useMutation-DPoeNVPU.js";import{u as J}from"./useInfiniteQuery-V0FRzoW4.js";import{A as Z}from"./arrow-left-BAGcWOPu.js";import{L as w}from"./loader-circle-DRHXNtMv.js";import{X as ee}from"./x-DL_2EWkG.js";import"./useBaseQuery-jfS3X2ww.js";const se=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],te=V("download",se),v=t=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(t||0),P=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),T=t=>new Intl.NumberFormat("es-AR",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0),A=t=>{const d=Number(t);return d===2?"USD Billete":d===3?"USD Divisa":"ARS"},re=({product:t})=>e.jsxs("tr",{className:`border-b border-gray-200 hover:bg-gray-50 ${t.recentlyChanged?"bg-yellow-50":""}`,children:[e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500 font-mono",children:t.code}),e.jsxs("td",{className:"py-3 px-4 text-sm text-gray-900 font-medium",children:[t.name,t.recentlyChanged&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"Precio modificado"})]}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:t.brand}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:t.product_group}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500 text-right",children:A(t.moneda)}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500 text-right",children:T(t.cotizacion)}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 font-medium text-right",children:Number(t.moneda)===2||Number(t.moneda)===3?P(t.originalPrice):"-"}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 font-semibold text-right",children:v(t.price)})]}),ae=()=>e.jsxs("tr",{className:"border-b border-gray-200 animate-pulse",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-48"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-10 ml-auto"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 ml-auto"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 ml-auto"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 ml-auto"})})]}),R=({message:t,onRetry:d,showRetry:c=!0})=>e.jsxs("div",{className:"text-center p-6 bg-white rounded-lg shadow-md my-6",children:[e.jsx("p",{className:"text-red-500 font-semibold",children:"Error al cargar productos"}),e.jsx("p",{className:"text-gray-600 mt-2",children:t}),c&&d&&e.jsx("button",{onClick:d,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",children:"Volver a intentar"})]});function he(){const{user:t}=K(),d=Q(),[c,S]=o.useState(""),[a,C]=o.useState([]),[u,F]=o.useState(!1),[m,B]=o.useState(""),x=o.useRef(null),g=o.useRef(null),p=Y({mutationFn:()=>N.fetchAllProductsForPDF(m,a),onSuccess:s=>{if(!s||s.length===0){alert("No se encontraron productos con los filtros actuales para generar el PDF.");return}const{jsPDF:r}=window.jspdf,n=new r;n.setFontSize(16),n.text("Lista de Precios - Pintureria Mercurio",14,22),n.setFontSize(10);const f=a.length>0?a.join(", "):"Todas";n.text(`Filtros: ${m||"Ninguno"} | Marca: ${f}`,14,28),n.text(`Fecha: ${new Date().toLocaleDateString("es-AR")}`,n.internal.pageSize.getWidth()-14,28,{align:"right"});const j=["Código","Descripción","Marca","Grupo","Mon","Cotiz","Precio USD","Precio ARS"],O=s.map(l=>[l.code,l.name,l.brand,l.product_group,A(l.moneda),T(l.cotizacion),Number(l.moneda)===2||Number(l.moneda)===3?P(l.originalPrice):"-",v(l.price)]);n.autoTable({startY:35,head:[j],body:O,theme:"striped",headStyles:{fillColor:[40,58,90]},styles:{fontSize:8},columnStyles:{4:{halign:"right"},5:{halign:"right"},6:{halign:"right"},7:{halign:"right"}}}),n.save("lista-de-precios.pdf")},onError:s=>{console.error("Error al generar el PDF:",s),alert(`Error al generar el PDF: ${s.message}`)}}),{data:E,fetchNextPage:z,hasNextPage:D,isFetchingNextPage:b,isError:y,error:k,isLoading:h}=J({queryKey:["products",m,a,t?.id],queryFn:({pageParam:s=1})=>N.fetchProducts(s,m,a,!1,20),getNextPageParam:(s,r)=>r.reduce((f,j)=>f+j.products.length,0)<s.totalProducts?r.length+1:void 0,initialPageParam:1,staleTime:1e3*60*1,enabled:!!t}),{data:L,isLoading:M}=X({queryKey:["brands",t?.id],queryFn:()=>N.fetchProtheusBrands(),staleTime:1e3*60*60,enabled:!!t});o.useEffect(()=>(x.current&&clearTimeout(x.current),x.current=setTimeout(()=>B(c),500),()=>clearTimeout(x.current)),[c]),o.useEffect(()=>{const s=r=>{g.current&&!g.current.contains(r.target)&&F(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const U=s=>S(s.target.value),$=s=>{C(r=>r.includes(s)?r.filter(n=>n!==s):[...r,s])},I=()=>{S(""),C([])},_=()=>p.mutate(),i=E?.pages.flatMap(s=>s.products)||[],q=c.length>0||a.length>0,G=()=>M?"Cargando marcas...":a.length===0?"Todas las marcas":a.length===1?a[0]:`${a.length} marcas seleccionadas`;return e.jsxs("div",{className:"p-4 md:p-6 bg-gray-50 min-h-screen",children:[e.jsxs("header",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>d("/dashboard"),className:"flex items-center justify-center p-2 mr-2 md:mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Volver al dashboard",children:e.jsx(Z,{className:"w-5 h-5 md:w-6 md:h-6"})}),e.jsx("h1",{className:"text-xl md:text-3xl font-bold text-gray-800",children:"Lista de Precios"})]}),e.jsxs("button",{onClick:_,disabled:p.isPending,className:"inline-flex items-center justify-center px-3 py-2 md:px-4 md:py-2 bg-espint-green text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition-colors disabled:opacity-50 cursor-pointer",children:[p.isPending?e.jsx(w,{className:"w-5 h-5 md:mr-2 animate-spin"}):e.jsx(te,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Descargar PDF"})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"search",className:"sr-only",children:"Buscar producto"}),e.jsx(H,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{id:"search",type:"text",value:c,onChange:U,placeholder:"Buscar por nombre o código...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-espint-blue"})]}),e.jsxs("div",{className:"relative",ref:g,children:[e.jsx("label",{htmlFor:"brand-dropdown",className:"sr-only",children:"Filtrar por marca"}),e.jsxs("button",{id:"brand-dropdown",onClick:()=>F(!u),disabled:M,className:"w-full flex justify-between items-center text-left bg-white pl-4 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-espint-blue cursor-pointer",children:[e.jsx("span",{className:"truncate",children:G()}),e.jsx(W,{className:`w-5 h-5 text-gray-400 transition-transform ${u?"rotate-180":""}`})]}),u&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:L&&L.map(s=>e.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.includes(s),onChange:()=>$(s),className:"h-4 w-4 rounded border-gray-300 text-espint-blue focus:ring-espint-blue"}),e.jsx("span",{className:"ml-3 text-sm text-gray-700",children:s})]},s))})]})]}),q&&e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:I,className:"flex items-center text-sm text-espint-blue hover:text-blue-800 cursor-pointer",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Limpiar filtros"]})}),e.jsxs("div",{className:"md:hidden space-y-3 mb-6",children:[h&&i.length===0&&Array.from({length:5}).map((s,r)=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 ml-auto"})]},r)),y&&e.jsx(R,{message:k.message,onRetry:()=>window.location.reload()}),i.length>0&&i.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("h3",{className:"text-sm font-bold text-gray-900 leading-snug",children:[s.name,s.recentlyChanged&&e.jsx("span",{className:"ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-yellow-100 text-yellow-800",children:"Modificado"})]})}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsxs("p",{children:["Cód: ",s.code]}),e.jsxs("p",{children:["Marca: ",s.brand]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:v(s.price)}),(Number(s.moneda)===2||Number(s.moneda)===3)&&e.jsx("p",{className:"text-xs text-gray-400",children:P(s.originalPrice)})]})]})]},s.id))]}),e.jsx("div",{className:"hidden md:block bg-white rounded-lg shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gray-100 border-b border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider",children:"Marca"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider",children:"Grupo"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider text-right",children:"Moneda"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider text-right",children:"Cotización"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider text-right",children:"Precio (USD)"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-espint-blue uppercase tracking-wider text-right",children:"Precio Final (ARS)"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[h&&i.length===0&&Array.from({length:10}).map((s,r)=>e.jsx(ae,{},r)),y&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",children:e.jsx(R,{message:k.message,onRetry:()=>window.location.reload()})})}),i.length>0&&i.map(s=>e.jsx(re,{product:s},s.id))]})]})})}),e.jsxs("div",{className:"p-4 text-center",children:[!h&&!y&&i.length===0&&e.jsx("p",{className:"text-gray-500",children:"No se encontraron productos con esos filtros."}),b&&e.jsxs("div",{className:"flex justify-center items-center py-4",children:[e.jsx(w,{className:"w-6 h-6 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Cargando más productos..."})]}),!D&&!h&&i.length>0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Fin de los resultados."}),D&&e.jsx("button",{onClick:()=>z(),disabled:b,className:"mt-4 px-6 py-2 bg-espint-blue text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center justify-center mx-auto cursor-pointer",children:b?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-5 h-5 mr-2 animate-spin"})," Cargando más..."]}):"Cargar más productos"})]})]})}export{he as default};
