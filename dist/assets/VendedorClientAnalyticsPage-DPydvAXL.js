import{a as N,j as e,i as L,u as M,e as V,L as z}from"./index-ZXV4l69V.js";import{r as t,X as C,Q as D,t as R,i as S,V as F,a0 as T,c as P,A as $}from"./ui-libs-xEc9wXfK.js";import{C as B}from"./ClientAnalyticsView-H_8E1LAy.js";import"./vendor-qkC6yhPU.js";const I=({isOpen:n,onClose:i,clientId:c,clientName:o})=>{const[d,f]=t.useState(!0),[x,m]=t.useState(!1),[b,p]=t.useState([]),[j,u]=t.useState([]),[y,a]=t.useState(null),[v,w]=t.useState(null);t.useEffect(()=>{n&&c?k():(w(null),a(null))},[n,c]);const k=async()=>{f(!0),a(null);try{const[s,r]=await Promise.all([N.getVendedorProductGroups(),N.getClientPermissions(c)]);p(s),u(r)}catch(s){console.error(s),a("Error al cargar datos. Intente nuevamente.")}finally{f(!1)}},A=s=>{u(r=>{const g=r.find(l=>l.group===s);return g?g.source==="admin"?r:r.filter(l=>l.group!==s):[...r,{group:s,source:"vendedor"}]})},E=async()=>{m(!0),a(null);try{const s=j.filter(r=>r.source==="vendedor").map(r=>r.group);await N.updateClientPermissions(c,s),w("Permisos actualizados correctamente."),setTimeout(()=>{w(null),i()},1500)}catch(s){console.error(s),a(s.message||"Error al guardar cambios.")}finally{m(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-4xl rounded-xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gray-50/50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Restricciones de Productos"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Gestionando restricciones para: ",e.jsx("span",{className:"font-semibold text-blue-600",children:o})]})]}),e.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(C,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-white relative",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Cargando grupos..."})]}):e.jsxs(e.Fragment,{children:[y&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 text-red-700 rounded-lg flex items-center gap-3",children:[e.jsx(D,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:y})]}),v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90 z-10",children:e.jsxs("div",{className:"flex flex-col items-center animate-bounce-in",children:[e.jsx(R,{className:"w-16 h-16 text-green-500 mb-4"}),e.jsx("p",{className:"text-xl font-semibold text-gray-800",children:v})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(s=>{const r=s.product_group,g=j.find(G=>G.group===r),l=!!g,h=g?.source==="admin";return e.jsxs("label",{className:`
                                                relative flex items-center p-4 rounded-lg border transition-all cursor-pointer
                                                ${h?"bg-gray-50 border-gray-200 opacity-75 cursor-not-allowed":l?"bg-red-50 border-red-200 shadow-sm":"bg-white border-gray-200 hover:border-blue-300 hover:shadow-sm"}
                                            `,children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:l,onChange:()=>!h&&A(r),disabled:h}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`text-sm font-medium truncate ${l?"text-red-700":"text-gray-700"}`,children:r}),h&&e.jsx(S,{className:"w-4 h-4 text-gray-400"})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.brand||"General"})]}),e.jsx("div",{className:`
                                                w-5 h-5 rounded border flex items-center justify-center ml-3 transition-colors
                                                ${l?h?"bg-gray-400 border-gray-400":"bg-red-500 border-red-500":"border-gray-300"}
                                            `,children:l&&e.jsx(C,{className:"w-3.5 h-3.5 text-white"})})]},r)})})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-100 bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:[e.jsx(S,{className:"w-3 h-3 inline mx-1"})," Restringido por Admin (Bloqueado)"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-lg font-medium text-sm transition-colors",disabled:x,children:"Cancelar"}),e.jsx("button",{onClick:E,disabled:x||d,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm shadow-md hover:shadow-lg transition-all disabled:opacity-50 flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),"Guardar Cambios"]})})]})]})]})}):null};function _(){const{userId:n}=L(),i=M(),[c]=V(),o=c.get("name")||"Cliente",[d,f]=t.useState(null),[x,m]=t.useState(!0),[b,p]=t.useState(null),[j,u]=t.useState(!1);t.useEffect(()=>{n&&y()},[n]);const y=async()=>{m(!0),p(null);try{const a=await N.getVendedorClientAnalytics(n);f(a.data)}catch(a){console.error("Error fetching analytics:",a),p("No se pudo cargar la información del cliente.")}finally{m(!1)}};return x?e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:e.jsx(z,{text:"Cargando análisis..."})}):b?e.jsx("div",{className:"flex flex-col justify-center items-center min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md text-center max-w-md w-full",children:[e.jsx("div",{className:"text-red-500 mb-4 mx-auto w-12 h-12 flex items-center justify-center bg-red-100 rounded-full",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:b}),e.jsx("button",{onClick:()=>i("/vendedor-clients"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Volver a Clientes"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-12",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>i(-1),className:"mr-4 p-2 rounded-full hover:bg-gray-100 text-gray-600 transition",children:e.jsx($,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-blue-600"}),"Análisis Detallado"]}),e.jsx("p",{className:"text-sm text-gray-500",children:o})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:d&&e.jsx(B,{stats:d,clientName:o,onManagePermissions:()=>u(!0)})}),e.jsx(I,{isOpen:j,onClose:()=>u(!1),clientId:n,clientName:o})]})}export{_ as default};
