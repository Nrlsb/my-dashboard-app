import{a as x,j as e,L as H}from"./index-B7R224wI.js";import{r as t,t as J,S as E,i as K,W as X,aa as Y,Q as Z}from"./ui-libs-DRx-SISE.js";import{T as ee}from"./TestUserAnalyticsModal-C6z4_yX4.js";import{C as se}from"./ConfirmationModal-y7uLXfiz.js";import"./vendor-qkC6yhPU.js";const oe=()=>{const[i,M]=t.useState([]),[P,T]=t.useState(!0),[f,b]=t.useState(null),[y,a]=t.useState(null),[w,l]=t.useState(null),[d,R]=t.useState(""),[c,O]=t.useState(""),[L,j]=t.useState(!1),[D,N]=t.useState(!1),[r,v]=t.useState(null),[C,S]=t.useState(null),[o,k]=t.useState(""),[_,U]=t.useState(""),[q,h]=t.useState(!1),[u,g]=t.useState(null),m=t.useCallback(async s=>{try{b(null);const n=await x.getAllClients(s);M(n)}catch(n){b(n.message||"Error al cargar los clientes.")}finally{T(!1)}},[]);t.useEffect(()=>{const s=setTimeout(()=>{m(d)},500);return()=>clearTimeout(s)},[d,m]);const I=s=>{R(s.target.value)},$=t.useMemo(()=>{const s=i.map(n=>n.vendedor_nombre).filter(n=>n);return[...new Set(s)].sort()},[i]),A=t.useMemo(()=>c?i.filter(s=>s.vendedor_nombre===c):i,[i,c]),F=s=>{v(s),k(""),U(""),a(null),l(null),j(!0)},p=()=>{j(!1),v(null)},z=s=>{S(s),N(!0)},B=()=>{N(!1),S(null)},V=async()=>{if(!o){a("La contraseña es requerida.");return}if(o.length<6){a("La contraseña debe tener al menos 6 caracteres.");return}if(o!==_){a("Las contraseñas no coinciden.");return}try{a(null),r.has_password?(await x.resetUserPassword(r.id,o),l(`Contraseña restablecida correctamente para ${r.full_name}.`)):(await x.assignClientPassword({a1_cod:r.a1_cod,password:o,email:r.email}),l(`Contraseña asignada correctamente a ${r.full_name}.`),m(d)),p(),setTimeout(()=>l(null),3e3)}catch(s){a(s.message||"Error al procesar la contraseña.")}},G=s=>{g(s),h(!0)},W=async()=>{if(u){h(!1);try{a(null),l(null),await x.deleteUser(u.id),l(`Usuario ${u.full_name} eliminado correctamente.`),m(d),setTimeout(()=>l(null),3e3)}catch(s){console.error(s),a(s.message||"Error al eliminar el usuario.")}finally{g(null)}}},Q=()=>{h(!1),g(null)};return P?e.jsx(H,{text:"Cargando usuarios..."}):f?e.jsx("div",{className:"p-8 text-center",children:e.jsxs("div",{className:"text-red-600 bg-red-100 p-4 rounded-lg inline-block",children:["Error: ",f]})}):e.jsxs("div",{className:"p-4 sm:p-6 max-w-[1600px] mx-auto min-h-screen bg-gray-50",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center",children:"Gestión de Usuarios"}),w&&e.jsxs("div",{className:"mb-6 p-4 bg-green-100 border-l-4 border-green-500 text-green-700 flex items-center justify-center rounded shadow-sm animate-fade-in-down",children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:w})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"p-4 sm:p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-center gap-4 bg-gray-50/50",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 w-full md:w-auto flex-1",children:[e.jsxs("form",{className:"relative w-full md:max-w-md",onSubmit:s=>s.preventDefault(),autoComplete:"off",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(E,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"search",name:"search_users_query",id:"search_users_query",placeholder:"Buscar por nombre, email o código...",className:"pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all shadow-sm",value:d,onChange:I,autoComplete:"off"})]}),e.jsxs("select",{className:"w-full md:w-64 px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm bg-white text-gray-700",value:c,onChange:s=>O(s.target.value),children:[e.jsx("option",{value:"",children:"Todos los Vendedores"}),$.map(s=>e.jsx("option",{value:s,children:s},s))]})]})}),e.jsx("div",{className:"w-full overflow-hidden",children:e.jsxs("table",{className:"w-full divide-y divide-gray-200 table-fixed",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"w-[30%] px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider truncate",children:"Usuario"}),e.jsx("th",{scope:"col",className:"w-[10%] px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider hidden sm:table-cell truncate",children:"Código"}),e.jsx("th",{scope:"col",className:"w-[20%] px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider hidden md:table-cell truncate",children:"Email"}),e.jsx("th",{scope:"col",className:"w-[15%] px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider hidden lg:table-cell truncate",children:"Vendedor"}),e.jsx("th",{scope:"col",className:"w-[25%] px-4 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.length>0?A.map(s=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3 overflow-hidden",children:e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 h-9 w-9 hidden xs:block",children:e.jsx("div",{className:"h-9 w-9 rounded-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center text-blue-700 font-bold shadow-sm",children:s.full_name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{className:"ml-0 xs:ml-3 min-w-0 flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",title:s.full_name,children:s.full_name}),e.jsx("div",{className:"md:hidden text-xs text-gray-500 truncate",children:s.email})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap hidden sm:table-cell",children:e.jsx("span",{className:"px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800",children:s.a1_cod||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 truncate hidden md:table-cell",title:s.email,children:s.email}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 truncate hidden lg:table-cell",title:s.vendedor_nombre,children:s.vendedor_nombre||"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm font-medium whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 sm:gap-2",children:[e.jsxs("button",{onClick:()=>z(s),className:"text-white bg-blue-500 hover:bg-blue-600 font-medium rounded-lg text-xs px-2.5 py-1.5 transition-all shadow-sm focus:outline-none flex items-center gap-1",title:"Ver Análisis",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-bar-chart-2",children:[e.jsx("line",{x1:"18",x2:"18",y1:"20",y2:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"20",y2:"4"}),e.jsx("line",{x1:"6",x2:"6",y1:"20",y2:"14"})]}),e.jsx("span",{className:"hidden xl:inline",children:"Análisis"})]}),e.jsxs("button",{onClick:()=>F(s),className:`text-white font-medium rounded-lg text-xs px-2.5 py-1.5 transition-all shadow-sm focus:outline-none flex items-center justify-center gap-1 ${s.has_password?"bg-indigo-600 hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-300":"bg-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-300"}`,title:s.has_password?"Resetear":"Asignar",children:[s.has_password?e.jsx(K,{className:"w-3.5 h-3.5"}):e.jsx(X,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:s.has_password?"Reset":"Asignar"})]}),!s.is_admin&&e.jsx("button",{onClick:()=>G(s),className:"text-white bg-red-500 hover:bg-red-600 font-medium rounded-lg text-xs px-2.5 py-1.5 transition-all shadow-sm focus:outline-none flex items-center gap-1",title:"Eliminar Usuario",children:e.jsx(Y,{className:"w-3.5 h-3.5"})})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-10 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(E,{className:"h-10 w-10 text-gray-300 mb-3"}),e.jsx("p",{className:"text-lg font-medium",children:"No se encontraron usuarios"}),e.jsx("p",{className:"text-sm",children:"Intenta con otros filtros o términos de búsqueda."})]})})})})]})})]}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center overflow-x-hidden overflow-y-auto outline-none focus:outline-none bg-black/50 backdrop-blur-sm transition-opacity",children:e.jsx("div",{className:"relative w-full max-w-md mx-4 my-6",children:e.jsxs("div",{className:"relative flex flex-col w-full bg-white border-0 rounded-xl shadow-2xl outline-none focus:outline-none animate-bounce-in",children:[e.jsxs("div",{className:"flex items-start justify-between p-5 border-b border-solid border-gray-200 rounded-t-xl bg-gray-50",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:r?.has_password?"Restablecer Contraseña":"Asignar Nueva Contraseña"}),e.jsx("button",{className:"p-1 ml-auto bg-transparent border-0 text-gray-400 hover:text-gray-900 float-right text-3xl leading-none font-semibold outline-none focus:outline-none transition-colors",onClick:p,children:e.jsx("span",{className:"bg-transparent h-6 w-6 text-2xl block outline-none focus:outline-none",children:"×"})})]}),e.jsxs("div",{className:"relative p-6 flex-auto",children:[e.jsxs("p",{className:"my-2 text-gray-600 text-sm leading-relaxed mb-6",children:["Estás restableciendo la contraseña para el usuario:",e.jsx("br",{}),e.jsx("strong",{className:"text-gray-900 block mt-1 text-base",children:r?.full_name})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",readOnly:!0,className:"opacity-0 absolute w-0 h-0 -z-10",autoComplete:"username"}),e.jsx("input",{type:"password",readOnly:!0,className:"opacity-0 absolute w-0 h-0 -z-10",autoComplete:"current-password"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nueva Contraseña"}),e.jsx("input",{type:"password",id:"newPassword",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none",value:o,onChange:s=>k(s.target.value),placeholder:"Ingresa la nueva contraseña"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmar Contraseña"}),e.jsx("input",{type:"password",id:"confirmPassword",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none",value:_,onChange:s=>U(s.target.value),placeholder:"Repite la nueva contraseña"})]}),y&&e.jsxs("div",{className:"text-red-600 text-sm bg-red-50 p-2 rounded flex items-start gap-2",children:[e.jsx(Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:y})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end p-6 border-t border-solid border-gray-200 rounded-b-xl bg-gray-50",children:[e.jsx("button",{className:"text-gray-500 background-transparent font-bold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-2 mb-1 ease-linear transition-all duration-150 hover:bg-gray-200 rounded-lg",type:"button",onClick:p,children:"Cancelar"}),e.jsx("button",{className:"bg-indigo-600 text-white active:bg-indigo-700 font-bold uppercase text-sm px-6 py-3 rounded-lg shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150 hover:bg-indigo-700",type:"button",onClick:V,children:"Guardar Cambios"})]})]})})}),e.jsx(ee,{isOpen:D,onClose:B,userId:C?.id,userName:C?.full_name,isRegularUser:!0}),e.jsx(se,{isOpen:q,onClose:Q,onConfirm:W,title:"Eliminar Usuario",message:`¿Estás seguro de que deseas eliminar al usuario ${u?.full_name}? esta acción borrará sus credenciales y datos del sistema.`,confirmText:"Eliminar",variant:"danger"})]})};export{oe as default};
