import{u as D,j as e,b as se,d as te,e as re,a as L,L as ae}from"./index-CsD2u-dk.js";import{r as i,X as ne,k as z,n as le,o as ce,p as O,a as G,S as ie,q as de,s as oe,t as me,u as U}from"./ui-libs-CLIssbRL.js";import{u as xe}from"./useProductQuantity-3W-FSCfs.js";import{C as ue}from"./CustomSelect-EaEf_Yjh.js";import"./vendor-qkC6yhPU.js";const he=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),ge=({product:s,onClose:o,onAddToCart:x})=>{const{quantity:u,increment:y,decrement:g,handleInputChange:b,handleBlur:n,stock:j}=xe(s),[h,N]=i.useState(!1),f=D();i.useEffect(()=>{N(!1)},[s]);const P=()=>{x(s,u),N(!0),setTimeout(()=>{o()},1500)},S=v=>{f(`/product-detail/${v}`),o()};return s?e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:o,children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row overflow-hidden",onClick:v=>v.stopPropagation(),children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-2 text-gray-500 hover:text-gray-800 bg-gray-100 rounded-full z-10",children:e.jsx(ne,{className:"w-6 h-6"})}),e.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center bg-gray-100 p-8",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"max-h-64 object-contain rounded-lg"}):e.jsx(z,{className:"w-48 h-48 text-gray-400"})}),e.jsxs("div",{className:"w-full md:w-1/2 p-8 flex flex-col justify-center overflow-y-auto",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600 uppercase",children:s.brand||"Marca"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-1",children:s.name}),e.jsx("p",{className:"text-3xl font-extrabold text-gray-800 mt-3",children:he(s.price)}),e.jsxs("div",{className:"flex items-center space-x-4 my-4",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cantidad:"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-l-lg",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:u,onChange:b,onBlur:n,className:"w-16 text-center border-y-0 border-x focus:ring-0"}),e.jsx("button",{onClick:y,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-r-lg",children:e.jsx(ce,{className:"w-4 h-4"})})]}),j<=0?e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsx("span",{className:"text-sm font-medium text-red-600",children:"Sin Stock"}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]}):e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Stock: ",j>100?"+100":j]}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]})]}),e.jsx("button",{onClick:P,disabled:h,className:`w-full py-3 px-6 rounded-lg text-white font-semibold transition-colors duration-300 ${h?"bg-espint-green hover:bg-green-600":"bg-espint-blue hover:bg-blue-700"}`,children:h?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Agregado"]}):e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Agregar al Carrito"]})}),e.jsx("button",{onClick:()=>S(s.id),className:"mt-4 text-center text-sm text-blue-600 hover:underline",children:"Ver detalles completos del producto"})]})]})}):null},be=({searchTerm:s,setSearchTerm:o,selectedBrand:x,setSelectedBrand:u,allBrands:y,setCurrentPage:g})=>e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"search-product",className:"sr-only",children:"Buscar Producto"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{id:"search-product",type:"text",value:s,onChange:b=>{o(b.target.value),g(1)},className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-espint-blue focus:border-espint-blue",placeholder:"Buscar por nombre o código..."})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"brand-select",className:"sr-only",children:"Seleccionar Marca"}),e.jsx(ue,{options:y,value:x,onChange:b=>{u(b),g(1)},placeholder:"Todas las marcas"})]})]})}),fe=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),pe=({product:s,setSelectedProduct:o,handleAddToCartClick:x})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between p-4 bg-white rounded-lg shadow-md cursor-pointer hover:shadow-lg transition-shadow gap-4 md:gap-0",onClick:()=>o(s),children:[e.jsxs("div",{className:"flex items-start md:items-center space-x-4 w-full md:w-auto",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-gray-100 rounded-lg",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-16 h-16 object-cover rounded-md"}):e.jsx(z,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 line-clamp-2 md:line-clamp-2",children:s.name}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-500 mt-1",children:[s.brand," ",e.jsx("span",{className:"mx-1",children:"•"})," Cód: ",s.code]}),e.jsx("div",{className:"flex items-center mt-1",children:s.stock_disponible<=0?e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs md:text-sm font-medium text-red-600",children:"Sin Stock"}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-[10px] md:text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xs md:text-sm font-medium text-gray-600",children:["Stock: ",s.stock_disponible>100?"+100":s.stock_disponible]}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-[10px] md:text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between md:flex-col md:items-end md:justify-center w-full md:w-auto mt-2 md:mt-0 pt-3 md:pt-0 border-t md:border-t-0 border-gray-100",children:[e.jsx("p",{className:"text-lg font-bold text-[#0B3D68]",children:fe(s.price)}),e.jsx("button",{onClick:u=>{u.stopPropagation(),x(s)},className:"px-6 py-2 md:px-4 md:py-1 text-sm font-medium text-white bg-[#8CB818] rounded-md hover:bg-[#7aa315] transition-colors cursor-pointer md:mt-2",children:"Añadir"})]})]}),V=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),ye=({cart:s,productMap:o,updateQuantity:x,removeFromCart:u,totalPrice:y,handleReviewOrder:g,handleQuantityChange:b})=>e.jsx("div",{className:"lg-col-span-1 hidden lg:block",children:e.jsxs("div",{className:"sticky top-8 bg-white rounded-lg shadow-md flex flex-col max-h-[calc(100vh-4rem)] border-t-4 border-espint-magenta",children:[e.jsx("div",{className:"flex-shrink-0 p-6",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(G,{className:"w-6 h-6 text-gray-800 mr-3"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Resumen del Pedido"})]})}),e.jsxs("div",{className:"flex-1 divide-y divide-gray-200 overflow-y-auto px-6",children:[s.length===0&&e.jsx("p",{className:"py-4 text-center text-gray-500",children:"Tu carrito está vacío."}),s.map(n=>{const h=(o.get(n.id)||n)?.indicator_description,N=h!=null&&(String(h).trim()==="0"||Number(h)===0);return e.jsxs("div",{className:"py-4 flex items-center space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.name}),N&&e.jsx("span",{className:"inline-block px-2 py-0.5 mt-1 text-[10px] font-bold text-blue-700 bg-blue-100 rounded-full border border-blue-200",children:"Pedido por embalaje"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:V(n.price)}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("label",{htmlFor:`qty-${n.id}`,className:"text-xs text-gray-600 mr-2",children:"Cant:"}),e.jsx("input",{id:`qty-${n.id}`,type:"number",value:n.quantity,onChange:f=>x(n.id,f.target.value),onBlur:f=>b(n.id,f.target.value,o.get(n.id)||n),className:"w-16 border-gray-300 rounded-md shadow-sm focus:ring-espint-blue focus:border-espint-blue text-center",min:"0"},`qty-${n.id}`)]})]}),e.jsx("button",{onClick:()=>u(n.id),className:"p-1 text-gray-400 hover:text-red-600","aria-label":"Quitar item",children:e.jsx(de,{className:"w-5 h-5"})})]},n.id)})]}),s.length>0&&e.jsxs("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:V(y)})]}),e.jsxs("button",{onClick:g,disabled:s.length===0,className:"w-full inline-flex items-center justify-center px-6 py-3 font-semibold text-white bg-[#8CB818] rounded-md shadow-sm hover:bg-[#7aa315] transition-colors disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Revisar Pedido"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Precio con IVA incluído"})]})]})}),je=20,Ne=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),Se=()=>{const{user:s}=se(),o=D(),[x]=te(),[u,y]=i.useState([]),[g,b]=i.useState(new Map),[n,j]=i.useState(0),[h,N]=i.useState([]),[f,P]=i.useState(!0),[S,v]=i.useState(null),[q,M]=i.useState(x.get("search")||""),[_,X]=i.useState(""),[H,I]=i.useState(null),{cart:w,addToCart:F,updateQuantity:B,removeFromCart:J,setCart:K}=re(),[C,T]=i.useState(1),A=Math.ceil(n/je);i.useEffect(()=>{s&&(async()=>{try{const c=await L.fetchProtheusBrands();N(c)}catch(c){console.error(c)}})()},[s]),i.useEffect(()=>{const t=x.get("search");t!==null&&M(t)},[x]),i.useEffect(()=>{s&&(async()=>{try{P(!0),v(null);const c=_?[_]:[],l=await L.fetchProducts(C,q,c);y(l.products),j(l.totalProducts),b(r=>{const m=new Map(r);return l.products.forEach(a=>m.set(a.id,a)),m})}catch(c){console.error("Error al cargar productos:",c),v(c.message)}finally{P(!1)}})()},[C,q,_,s]);const W=(t,c,l)=>{let r=parseInt(c,10);if(isNaN(r)||r<1){B(t,0);return}const m=Number(l?.stock_disponible)||0,a=Number(l?.pack_quantity)>0?Number(l.pack_quantity):1,k=l?.indicator_description;if(k!=null&&(String(k).trim()==="0"||Number(k)===0)){if(m<=0){if(r%a!==0){const d=r%a;d>=a/2?r=r+(a-d):r=r-d,r<a&&(r=a)}}else if(r>m){const d=r-m;if(d%a!==0){const R=d%a;let p=d;R>=a/2?p=d+(a-R):p=d-R,p<a&&(p=a),r=m+p}}}B(t,r)},Y=t=>{const c=Number(t?.stock_disponible)||0,l=t?.indicator_description,r=l!=null&&(String(l).trim()==="0"||Number(l)===0),m=Number(t?.pack_quantity)>0?Number(t.pack_quantity):1;let a=1;c<=0&&r&&(a=m),F(t,a)},$=()=>{let t=!1;const c=w.map(l=>{const r=g.get(l.id)||l,m=Number(r?.stock_disponible)||0,a=r?.indicator_description,k=a!=null&&(String(a).trim()==="0"||Number(a)===0),E=Number(r?.pack_quantity)>0?Number(r.pack_quantity):1;let d=l.quantity;if(k&&d>m){const p=(d-m)%E;if(p!==0){const ee=E-p;d=d+ee,t=!0}}return{...l,quantity:d}});t&&K(c),o("/order-preview")},Q=i.useMemo(()=>w.reduce((t,c)=>t+c.price*c.quantity,0),[w]),Z=()=>f?e.jsx(ae,{text:"Cargando productos..."}):S?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md text-center text-red-500",children:S}):u.length===0?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md text-center text-gray-500",children:"No se encontraron productos."}):u.map(t=>e.jsx(pe,{product:t,setSelectedProduct:I,handleAddToCartClick:Y},t.id));return e.jsxs("div",{className:"min-h-screen bg-gray-100 font-sans",children:[e.jsx(ge,{product:H,onClose:()=>I(null),onAddToCart:F}),e.jsxs("main",{className:"p-4 md:p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>o("/dashboard"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Volver al dashboard",children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Nuevo Pedido"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx(be,{searchTerm:q,setSearchTerm:M,selectedBrand:_,setSelectedBrand:X,allBrands:h,setCurrentPage:T}),e.jsx("div",{className:"bg-blue-50 border-l-4 border-espint-blue p-4 mb-4 rounded-r-lg",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Nota:"})," Seleccione los productos de la lista para agregarlos al pedido."]})}),e.jsx("div",{className:"space-y-4",children:Z()}),A>1&&e.jsxs("div",{className:"flex justify-between items-center p-4 bg-white rounded-lg shadow-md",children:[e.jsxs("button",{onClick:()=>T(t=>Math.max(t-1,1)),disabled:C===1||f,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 cursor-pointer",children:[e.jsx(me,{className:"w-5 h-5 mr-2"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Página ",C," de ",A]}),e.jsxs("button",{onClick:()=>T(t=>Math.min(t+1,A)),disabled:C===A||f,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 cursor-pointer",children:["Siguiente",e.jsx(U,{className:"w-5 h-5 ml-2"})]})]})]}),e.jsx(ye,{cart:w,productMap:g,updateQuantity:B,removeFromCart:J,totalPrice:Q,handleReviewOrder:$,handleQuantityChange:W})]})]}),w.length>0&&e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] p-4 lg:hidden z-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Total Estimado"}),e.jsx("span",{className:"text-xl font-bold text-espint-blue",children:Ne(Q)})]}),e.jsxs("button",{onClick:$,className:"flex items-center justify-center px-6 py-3 bg-[#8CB818] text-white font-bold rounded-lg shadow-md hover:bg-[#7aa315] transition-colors",children:["Ver Pedido",e.jsx(U,{className:"w-5 h-5 ml-1"})]})]}),w.length>0&&e.jsx("div",{className:"h-24 lg:hidden"})]})};export{Se as default};
