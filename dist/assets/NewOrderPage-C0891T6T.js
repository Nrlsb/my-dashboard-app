import{u as J,j as e,d as K,b as de,e as oe,a as D,L as me}from"./index-ByTlQuIX.js";import{r as d,X as W,k as Y,n as xe,o as ue,p as Z,a as q,S as he,q as ee,s as ge,t as be,u as G}from"./ui-libs-CgXQafC0.js";import{u as pe}from"./useProductQuantity-DcdY3hPz.js";import{C as fe}from"./CustomSelect-C9rSXtyf.js";import"./vendor-qkC6yhPU.js";const je=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),ye=({product:s,onClose:o,onAddToCart:m})=>{const{quantity:u,increment:y,decrement:h,handleInputChange:f,handleBlur:C,stock:l}=pe(s),[c,g]=d.useState(!1),b=J();d.useEffect(()=>{g(!1)},[s]);const j=()=>{m(s,u),g(!0),setTimeout(()=>{o()},1500)},v=k=>{b(`/product-detail/${k}`),o()};return s?e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:o,children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row overflow-hidden",onClick:k=>k.stopPropagation(),children:[e.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-2 text-gray-500 hover:text-gray-800 bg-gray-100 rounded-full z-10",children:e.jsx(W,{className:"w-6 h-6"})}),e.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center bg-gray-100 p-8",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"max-h-64 object-contain rounded-lg"}):e.jsx(Y,{className:"w-48 h-48 text-gray-400"})}),e.jsxs("div",{className:"w-full md:w-1/2 p-8 flex flex-col justify-center overflow-y-auto",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600 uppercase",children:s.brand||"Marca"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-1",children:s.name}),e.jsx("p",{className:"text-3xl font-extrabold text-gray-800 mt-3",children:je(s.price)}),e.jsxs("div",{className:"flex items-center space-x-4 my-4",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cantidad:"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-l-lg",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:u,onChange:f,onBlur:C,className:"w-16 text-center border-y-0 border-x focus:ring-0"}),e.jsx("button",{onClick:y,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-r-lg",children:e.jsx(ue,{className:"w-4 h-4"})})]}),l<=0?e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsx("span",{className:"text-sm font-medium text-red-600",children:"Sin Stock"}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]}):e.jsxs("div",{className:"flex items-center ml-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Stock: ",l>100?"+100":l]}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]})]}),e.jsx("button",{onClick:j,disabled:c,className:`w-full py-3 px-6 rounded-lg text-white font-semibold transition-colors duration-300 ${c?"bg-espint-green hover:bg-green-600":"bg-espint-blue hover:bg-blue-700"}`,children:c?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"Agregado"]}):e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"Agregar al Carrito"]})}),e.jsx("button",{onClick:()=>v(s.id),className:"mt-4 text-center text-sm text-blue-600 hover:underline",children:"Ver detalles completos del producto"})]})]})}):null},Ne=({searchTerm:s,setSearchTerm:o,selectedBrand:m,setSelectedBrand:u,allBrands:y,setCurrentPage:h})=>e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"search-product",className:"sr-only",children:"Buscar Producto"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{id:"search-product",type:"text",value:s,onChange:f=>{o(f.target.value),h(1)},className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-espint-blue focus:border-espint-blue",placeholder:"Buscar por nombre o código..."})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"brand-select",className:"sr-only",children:"Seleccionar Marca"}),e.jsx(fe,{options:y,value:m,onChange:f=>{u(f),h(1)},placeholder:"Todas las marcas"})]})]})}),ve=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),we=({product:s,setSelectedProduct:o,handleAddToCartClick:m})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between p-4 bg-white rounded-lg shadow-md cursor-pointer hover:shadow-lg transition-shadow gap-4 md:gap-0",onClick:()=>o(s),children:[e.jsxs("div",{className:"flex items-start md:items-center space-x-4 w-full md:w-auto",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-gray-100 rounded-lg",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-16 h-16 object-cover rounded-md"}):e.jsx(Y,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 line-clamp-2 md:line-clamp-2",children:s.name}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-500 mt-1",children:[s.brand," ",e.jsx("span",{className:"mx-1",children:"•"})," Cód: ",s.code]}),e.jsx("div",{className:"flex items-center mt-1",children:s.stock_disponible<=0?e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs md:text-sm font-medium text-red-600",children:"Sin Stock"}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-[10px] md:text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xs md:text-sm font-medium text-gray-600",children:["Stock: ",s.stock_disponible>100?"+100":s.stock_disponible]}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-[10px] md:text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between md:flex-col md:items-end md:justify-center w-full md:w-auto mt-2 md:mt-0 pt-3 md:pt-0 border-t md:border-t-0 border-gray-100",children:[e.jsx("p",{className:"text-lg font-bold text-[#0B3D68]",children:ve(s.price)}),e.jsx("button",{onClick:u=>{u.stopPropagation(),m(s)},className:"px-6 py-2 md:px-4 md:py-1 text-sm font-medium text-white bg-[#8CB818] rounded-md hover:bg-[#7aa315] transition-colors cursor-pointer md:mt-2",children:"Añadir"})]})]}),X=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),Ce=({cart:s,productMap:o,updateQuantity:m,removeFromCart:u,totalPrice:y,handleReviewOrder:h,handleQuantityChange:f})=>{const{clearCart:C}=K();return e.jsx("div",{className:"lg-col-span-1 hidden lg:block",children:e.jsxs("div",{className:"sticky top-8 bg-white rounded-lg shadow-md flex flex-col max-h-[calc(100vh-4rem)] border-t-4 border-espint-magenta",children:[e.jsx("div",{className:"flex-shrink-0 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"w-6 h-6 text-gray-800 mr-3"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Resumen del Pedido"})]}),s.length>0&&e.jsx("button",{onClick:C,className:"text-xs text-red-500 hover:text-red-700 underline",children:"Vaciar Carrito"})]})}),e.jsxs("div",{className:"flex-1 divide-y divide-gray-200 overflow-y-auto px-6",children:[s.length===0&&e.jsx("p",{className:"py-4 text-center text-gray-500",children:"Tu carrito está vacío."}),s.map(l=>{const g=(o.get(l.id)||l)?.indicator_description,b=g!=null&&(String(g).trim()==="0"||Number(g)===0);return e.jsxs("div",{className:"py-4 flex items-center space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.name}),b&&e.jsx("span",{className:"inline-block px-2 py-0.5 mt-1 text-[10px] font-bold text-blue-700 bg-blue-100 rounded-full border border-blue-200",children:"Pedido por embalaje"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:X(l.price)}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("label",{htmlFor:`qty-${l.id}`,className:"text-xs text-gray-600 mr-2",children:"Cant:"}),e.jsx("input",{id:`qty-${l.id}`,type:"number",value:l.quantity,onChange:j=>m(l.id,j.target.value),onBlur:j=>f(l.id,j.target.value,o.get(l.id)||l),className:"w-16 border-gray-300 rounded-md shadow-sm focus:ring-espint-blue focus:border-espint-blue text-center",min:"0"},`qty-${l.id}`)]})]}),e.jsx("button",{onClick:()=>u(l.id),className:"p-1 text-gray-400 hover:text-red-600","aria-label":"Quitar item",children:e.jsx(ee,{className:"w-5 h-5"})})]},l.id)})]}),s.length>0&&e.jsxs("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:X(y)})]}),e.jsxs("button",{onClick:h,disabled:s.length===0,className:"w-full inline-flex items-center justify-center px-6 py-3 font-semibold text-white bg-[#8CB818] rounded-md shadow-sm hover:bg-[#7aa315] transition-colors disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Revisar Pedido"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Precio con IVA incluído"})]})]})})},H=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),ke=({cart:s,isOpen:o,onClose:m,productMap:u,updateQuantity:y,removeFromCart:h,totalPrice:f,handleQuantityChange:C,clearCart:l})=>o?e.jsx("div",{className:"fixed inset-0 z-[60] flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm",onClick:m,children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-t-2xl sm:rounded-2xl max-h-[80vh] flex flex-col shadow-xl overflow-hidden animate-in slide-in-from-bottom duration-300",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"w-5 h-5 text-espint-blue mr-2"}),e.jsxs("h2",{className:"text-lg font-bold text-gray-800",children:["Tu Carrito (",s.length,")"]})]}),e.jsx("button",{onClick:m,className:"p-2 text-gray-500 hover:text-gray-700 bg-white rounded-full shadow-sm",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Tu carrito está vacío"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:l,className:"text-xs text-red-500 hover:text-red-700 underline",children:"Vaciar Carrito"})}),s.map(c=>{const g=u.get(c.id)||c,b=g?.indicator_description,j=b!=null&&(String(b).trim()==="0"||Number(b)===0);return e.jsx("div",{className:"flex gap-3 bg-white border border-gray-100 rounded-lg p-3 shadow-sm",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 line-clamp-2",children:c.name}),j&&e.jsx("span",{className:"inline-block px-2 py-0.5 mt-1 text-[10px] font-bold text-blue-700 bg-blue-100 rounded-full border border-blue-200",children:"Pedido por embalaje"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-sm font-bold text-espint-blue",children:H(c.price)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center border border-gray-300 rounded-md bg-gray-50 h-8",children:e.jsx("input",{type:"number",value:c.quantity,onChange:v=>y(c.id,v.target.value),onBlur:v=>C(c.id,v.target.value,g),className:"w-12 text-center bg-transparent border-none p-0 text-sm focus:ring-0",min:"0"})}),e.jsx("button",{onClick:()=>h(c.id),className:"p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",children:e.jsx(ee,{className:"w-4 h-4"})})]})]})]})},c.id)})]})}),s.length>0&&e.jsxs("div",{className:"p-4 border-t border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Total Estimado"}),e.jsx("span",{className:"text-xl font-bold text-espint-blue",children:H(f)})]}),e.jsx("p",{className:"text-xs text-gray-400 text-center mb-3",children:"Incluye IVA"}),e.jsx("button",{onClick:m,className:"w-full py-3 bg-gray-900 text-white font-medium rounded-lg hover:bg-gray-800 transition-colors",children:"Seguir Comprando"})]})]})}):null,Pe=20,Se=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s||0),Te=()=>{const{user:s}=de(),o=J(),[m]=oe(),[u,y]=d.useState([]),[h,f]=d.useState(new Map),[C,l]=d.useState(0),[c,g]=d.useState([]),[b,j]=d.useState(!0),[v,k]=d.useState(null),[B,V]=d.useState(m.get("search")||""),[_,se]=d.useState(""),[te,$]=d.useState(null),[re,Q]=d.useState(!1),{cart:N,addToCart:L,updateQuantity:T,removeFromCart:O,setCart:ae,clearCart:le}=K(),[S,I]=d.useState(1),A=Math.ceil(C/Pe);d.useEffect(()=>{s&&(async()=>{try{const n=await D.fetchProtheusBrands();g(n)}catch(n){console.error(n)}})()},[s]),d.useEffect(()=>{const t=m.get("search");t!==null&&V(t)},[m]),d.useEffect(()=>{s&&(async()=>{try{j(!0),k(null);const n=_?[_]:[],i=await D.fetchProducts(S,B,n);y(i.products),l(i.totalProducts),f(r=>{const p=new Map(r);return i.products.forEach(a=>p.set(a.id,a)),p})}catch(n){console.error("Error al cargar productos:",n),k(n.message)}finally{j(!1)}})()},[S,B,_,s]);const M=(t,n,i)=>{let r=parseInt(n,10);if(isNaN(r)||r<1){T(t,0);return}const p=Number(i?.stock_disponible)||0,a=Number(i?.pack_quantity)>0?Number(i.pack_quantity):1,P=i?.indicator_description;if(P!=null&&(String(P).trim()==="0"||Number(P)===0)){if(p<=0){if(r%a!==0){const x=r%a;x>=a/2?r=r+(a-x):r=r-x,r<a&&(r=a)}}else if(r>p){const x=r-p;if(x%a!==0){const R=x%a;let w=x;R>=a/2?w=x+(a-R):w=x-R,w<a&&(w=a),r=p+w}}}T(t,r)},ne=t=>{const n=Number(t?.stock_disponible)||0,i=t?.indicator_description,r=i!=null&&(String(i).trim()==="0"||Number(i)===0),p=Number(t?.pack_quantity)>0?Number(t.pack_quantity):1;let a=1;n<=0&&r&&(a=p),L(t,a)},U=()=>{let t=!1;const n=N.map(i=>{const r=h.get(i.id)||i,p=Number(r?.stock_disponible)||0,a=r?.indicator_description,P=a!=null&&(String(a).trim()==="0"||Number(a)===0),F=Number(r?.pack_quantity)>0?Number(r.pack_quantity):1;let x=i.quantity;if(P&&x>p){const w=(x-p)%F;if(w!==0){const ie=F-w;x=x+ie,t=!0}}return{...i,quantity:x}});t&&ae(n),o("/order-preview")},E=d.useMemo(()=>N.reduce((t,n)=>t+n.price*n.quantity,0),[N]),z=d.useMemo(()=>N.reduce((t,n)=>t+n.quantity,0),[N]),ce=()=>b?e.jsx(me,{text:"Cargando productos..."}):v?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md text-center text-red-500",children:v}):u.length===0?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md text-center text-gray-500",children:"No se encontraron productos."}):u.map(t=>e.jsx(we,{product:t,setSelectedProduct:$,handleAddToCartClick:ne},t.id));return e.jsxs("div",{className:"min-h-screen bg-gray-100 font-sans",children:[e.jsx(ye,{product:te,onClose:()=>$(null),onAddToCart:L}),e.jsx(ke,{cart:N,isOpen:re,onClose:()=>Q(!1),productMap:h,updateQuantity:M,removeFromCart:O,totalPrice:E,handleQuantityChange:M,clearCart:le}),e.jsxs("main",{className:"p-4 md:p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>o("/dashboard"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Volver al dashboard",children:e.jsx(ge,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Nuevo Pedido"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx(Ne,{searchTerm:B,setSearchTerm:V,selectedBrand:_,setSelectedBrand:se,allBrands:c,setCurrentPage:I}),e.jsx("div",{className:"bg-blue-50 border-l-4 border-espint-blue p-4 mb-4 rounded-r-lg",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Nota:"})," Seleccione los productos de la lista para agregarlos al pedido."]})}),e.jsx("div",{className:"space-y-4",children:ce()}),A>1&&e.jsxs("div",{className:"flex justify-between items-center p-4 bg-white rounded-lg shadow-md",children:[e.jsxs("button",{onClick:()=>I(t=>Math.max(t-1,1)),disabled:S===1||b,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 cursor-pointer",children:[e.jsx(be,{className:"w-5 h-5 mr-2"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Página ",S," de ",A]}),e.jsxs("button",{onClick:()=>I(t=>Math.min(t+1,A)),disabled:S===A||b,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 cursor-pointer",children:["Siguiente",e.jsx(G,{className:"w-5 h-5 ml-2"})]})]})]}),e.jsx(Ce,{cart:N,productMap:h,updateQuantity:T,removeFromCart:O,totalPrice:E,handleReviewOrder:U,handleQuantityChange:M})]})]}),N.length>0&&e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] px-4 py-3 lg:hidden z-50 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col flex-1 cursor-pointer active:opacity-70 transition-opacity",onClick:()=>Q(!0),children:[e.jsxs("span",{className:"text-xs text-gray-500 font-medium flex items-center",children:["Total (",z," ",z===1?"ítem":"ítems",")",e.jsx("span",{className:"ml-1 text-[10px] text-blue-500 font-bold bg-blue-50 px-1.5 py-0.5 rounded-full",children:"VER"})]}),e.jsx("span",{className:"text-xl font-bold text-espint-blue",children:Se(E)})]}),e.jsxs("button",{onClick:U,className:"flex items-center justify-center px-4 py-3 bg-[#8CB818] text-white font-bold rounded-lg shadow-md hover:bg-[#7aa315] transition-colors",children:["Ver Pedido",e.jsx(G,{className:"w-5 h-5 ml-1"})]})]}),N.length>0&&e.jsx("div",{className:"h-24 lg:hidden"})]})};export{Te as default};
