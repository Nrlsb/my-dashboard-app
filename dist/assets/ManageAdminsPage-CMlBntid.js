import{a as r,j as s,L as F}from"./index-BusU-Tbk.js";import{r as a}from"./ui-libs-B_T7o9er.js";import{C as P}from"./CustomSelect-CPhkJAzG.js";import{C as Q}from"./ConfirmationModal-DVVMyF60.js";import"./vendor-qkC6yhPU.js";const H=[{value:"manage_content",label:"Gestionar Contenido"},{value:"manage_offers",label:"Gestionar Ofertas"},{value:"view_analytics",label:"Ver Analíticas"},{value:"manage_admins",label:"Gestionar Admins"}],Z=()=>{const[p,I]=a.useState([]),[i,_]=a.useState([]),[j,L]=a.useState([]),[m,y]=a.useState(""),[u,N]=a.useState(""),[M,v]=a.useState(!0),[R,w]=a.useState(null),[E,l]=a.useState(null),[d,S]=a.useState(!1),[C,A]=a.useState(null),[c,x]=a.useState(""),[b,g]=a.useState([]),[O,h]=a.useState(!1),[D,f]=a.useState(null),n=a.useCallback(async()=>{try{v(!0),w(null),l(null);const[e,t,o]=await Promise.all([r.getAdmins(),r.getAdminUsers(),r.getRoles()]);I(e),_(t),L(o),t.length>0&&y(t[0].id),o.length>0&&N(o[0].name)}catch(e){w(e.message||"Error al cargar los datos.")}finally{v(!1)}},[]);a.useEffect(()=>{n()},[n]);const U=async()=>{if(!m){l("Por favor, selecciona un usuario.");return}if(!u){l("Por favor, selecciona un rol.");return}try{l(null),await r.addAdmin(m,u),await n()}catch(e){l(e.message||"Error al añadir administrador.")}},G=async e=>{try{l(null),await r.removeAdmin(e),await n()}catch(t){l(t.message||"Error al quitar administrador.")}},q=async()=>{if(!c.trim()){l("El nombre del rol es requerido.");return}try{l(null),d&&C?await r.updateRole(C,{name:c,permissions:b}):await r.createRole({name:c,permissions:b}),k(),await n()}catch(e){l(e.message||"Error al guardar el rol.")}},T=e=>{f(e),h(!0)},$=async()=>{if(D){h(!1);try{l(null),await r.deleteRole(D),await n()}catch(e){l(e.message||"Error al eliminar el rol.")}finally{f(null)}}},V=()=>{h(!1),f(null)},z=e=>{S(!0),A(e.id),x(e.name),g(e.permissions||[])},k=()=>{S(!1),A(null),x(""),g([])},B=e=>{g(t=>t.includes(e)?t.filter(o=>o!==e):[...t,e])};return M?s.jsx(F,{text:"Cargando..."}):R?s.jsxs("div",{className:"text-red-700 bg-red-100 border border-red-400 p-4 rounded-md text-center mt-4",children:["Error: ",R]}):s.jsxs("div",{className:"p-8 max-w-6xl mx-auto my-8 bg-gray-50 rounded-lg shadow-md",children:[s.jsx("h2",{className:"text-center mb-8 text-gray-800 text-2xl font-bold",children:"Gestionar Roles y Permisos"}),s.jsxs("div",{className:"mb-10 p-6 border border-gray-200 rounded-lg bg-white",children:[s.jsx("h3",{className:"mt-0 mb-4 text-gray-700 border-b-2 border-gray-300 pb-2 text-xl font-semibold",children:d?"Editar Rol":"Crear Nuevo Rol"}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("input",{type:"text",placeholder:"Nombre del Rol",value:c,onChange:e=>x(e.target.value),className:"p-2 border border-gray-300 rounded-md"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(e=>s.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-md cursor-pointer hover:bg-gray-50",children:[s.jsx("input",{type:"checkbox",checked:b.includes(e.value),onChange:()=>B(e.value)}),e.label]},e.value))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:q,className:"py-2 px-6 bg-blue-600 text-white rounded-md font-bold hover:bg-blue-700",children:d?"Actualizar Rol":"Crear Rol"}),d&&s.jsx("button",{onClick:k,className:"py-2 px-6 bg-gray-500 text-white rounded-md font-bold hover:bg-gray-600",children:"Cancelar"})]})]}),s.jsxs("div",{className:"mt-6",children:[s.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Roles Existentes"}),s.jsx("ul",{className:"list-disc pl-5",children:j.map(e=>s.jsxs("li",{className:"flex justify-between items-center mb-2",children:[s.jsxs("span",{children:[s.jsx("strong",{children:e.name})," - Permisos: ",e.permissions?.join(", ")||"Ninguno"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>z(e),className:"text-blue-600 hover:underline",disabled:e.name==="admin",children:"Editar"}),e.name!=="admin"&&s.jsx("button",{onClick:()=>T(e.id),className:"text-red-600 hover:underline",children:"Eliminar"})]})]},e.id))})]})]}),s.jsxs("div",{className:"mb-10 p-6 border border-gray-200 rounded-lg bg-white",children:[s.jsx("h3",{className:"mt-0 mb-2 text-gray-700 border-b-2 border-gray-300 pb-2 text-xl font-semibold",children:"Asignar Rol"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Selecciona un usuario y el rol que deseas asignarle."}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-stretch md:items-center",children:[s.jsx("div",{className:"flex-grow",children:s.jsx(P,{options:i.length>0?i.map(e=>({label:`${e.full_name} (${e.email})`,value:e.id})):[],value:m,onChange:e=>y(e),placeholder:i.length>0?"Seleccionar usuario":"No hay usuarios para añadir"})}),s.jsx("div",{className:"w-full md:w-40",children:s.jsx(P,{options:j.map(e=>({label:e.name,value:e.name})),value:u,onChange:e=>N(e),placeholder:"Rol"})}),s.jsx("button",{onClick:U,disabled:i.length===0,className:"py-2 px-6 bg-green-600 text-white rounded-md cursor-pointer font-bold transition-colors duration-200 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed h-[42px]",children:"Añadir"})]})]}),s.jsxs("div",{className:"mb-10 p-6 border border-gray-200 rounded-lg bg-white",children:[s.jsx("h3",{className:"mt-0 mb-2 text-gray-700 border-b-2 border-gray-300 pb-2 text-xl font-semibold",children:"Usuarios con Roles Asignados"}),p.length>0?s.jsx("ul",{className:"list-none p-0",children:p.map(e=>s.jsxs("li",{className:"flex flex-col md:flex-row justify-between items-start md:items-center py-4 px-0 border-b border-gray-200 last:border-b-0 gap-3",children:[s.jsxs("div",{className:"flex flex-col w-full",children:[s.jsx("span",{className:"text-base font-bold text-gray-800",children:e.full_name}),s.jsx("span",{className:"text-sm text-gray-600 break-all",children:e.email}),s.jsx("span",{className:`mt-2 self-start px-2 py-1 text-xs rounded-full font-medium ${e.role==="admin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:e.role})]}),s.jsx("button",{onClick:()=>G(e.id),className:"w-full md:w-auto py-2 px-4 bg-red-600 text-white rounded-md cursor-pointer font-bold transition-colors duration-200 hover:bg-red-700 text-sm mt-2 md:mt-0",children:"Quitar"})]},e.id))}):s.jsx("p",{children:"No hay administradores configurados."})]}),E&&s.jsx("div",{className:"text-red-700 bg-red-100 border border-red-400 p-4 rounded-md text-center mt-4",children:E}),s.jsx(Q,{isOpen:O,onClose:V,onConfirm:$,title:"Eliminar Rol",message:"¿Estás seguro de eliminar este rol?",confirmText:"Eliminar",variant:"danger"})]})};export{Z as default};
