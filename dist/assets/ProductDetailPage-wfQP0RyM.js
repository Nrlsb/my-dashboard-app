import{i as k,u as S,d as A,b as P,c as E,j as e,a as y}from"./index-BGFVR-Os.js";import{r as x,A as I,m as D,u as _,a as F,V as W,l as w,T as G,x as L,W as R}from"./ui-libs-DeieS4Kk.js";import{u as T}from"./useProductQuantity-BzcVWqW6.js";import"./vendor-qkC6yhPU.js";const q=r=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:2,maximumFractionDigits:2}).format(r||0),B=()=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"bg-gray-200 h-96 rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-200 h-8 w-1/3 rounded"}),e.jsx("div",{className:"bg-gray-200 h-12 w-3/4 rounded"}),e.jsx("div",{className:"bg-gray-200 h-8 w-1/4 rounded"}),e.jsx("div",{className:"bg-gray-200 h-20 w-full rounded"}),e.jsx("div",{className:"bg-gray-200 h-12 w-1/2 rounded"})]})]})}),v=({message:r})=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-md",children:[e.jsx(G,{className:"w-12 h-12 text-red-500 mb-4"}),e.jsx("p",{className:"text-red-500 font-semibold text-lg",children:"Error al cargar el producto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:r})]});function $(){const{productId:r}=k(),m=S(),{addToCart:n}=A(),{user:c}=P(),{data:s,isLoading:u,isError:g,error:h}=E({queryKey:["product",r,c?.id],queryFn:()=>y.fetchProductById(r),enabled:!!r}),{quantity:d,increment:o,decrement:p,handleInputChange:f,handleBlur:t}=T(s,1),[i,a]=x.useState(!1),b=()=>{s&&(n(s,d),a(!0),setTimeout(()=>a(!1),2e3))},l=()=>u?e.jsx(B,{}):g?e.jsx(v,{message:h.message}):s?e.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg h-80 md:h-96 overflow-hidden",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-contain",referrerPolicy:"no-referrer"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-24 h-24 text-gray-400"}),e.jsx("span",{className:"absolute text-gray-500 text-sm mt-32",children:"Imagen de producto"})]})}),e.jsxs("div",{className:"flex flex-col justify-center space-y-4",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600 uppercase",children:s.brand||"Marca"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"text-4xl font-extrabold text-gray-800",children:q(s.price)}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:s.description||s.capacity_description}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cantidad:"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:p,className:"px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-l-lg cursor-pointer",children:"-"}),e.jsx("input",{type:"number",value:d,onChange:f,onBlur:t,className:"w-16 text-center border-none focus:ring-0",min:"1"}),e.jsx("button",{onClick:o,className:"px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-r-lg cursor-pointer",children:"+"})]})]}),c?.role!=="vendedor"&&e.jsx("button",{onClick:b,className:`w-full py-3 px-6 rounded-lg text-white font-semibold transition-colors duration-300 cursor-pointer ${i?"bg-green-500 hover:bg-green-600":"bg-blue-600 hover:bg-blue-700"}`,children:i?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"Agregado"]}):e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2"}),"Agregar al Carrito"]})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Cód: ",s.code]})]}),e.jsx("div",{className:"flex items-center font-medium",children:e.jsx("div",{className:"flex items-center mt-1",children:s.stock_disponible<=0?e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-red-600",children:"Sin Stock"}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Stock: ",s.stock_disponible>100?"+100":s.stock_disponible]}),s.stock_de_seguridad>0&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-medium",children:"| Previsto de ingreso"})]})})})]})]})]}),e.jsxs("div",{className:"mt-12 border-t pt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(w,{className:"w-6 h-6 text-purple-600 mr-2"}),"Detalles del Producto"]})}),e.jsx(M,{product:s,isAdmin:c?.is_admin})]})]}):e.jsx(v,{message:"No se encontró el producto."});return e.jsxs("div",{className:"p-6 bg-white min-h-screen",children:[e.jsxs("header",{className:"mb-6 flex items-center",children:[e.jsx("button",{onClick:()=>m(-1),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Volver",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Detalle del Producto"})})]}),l()]})}const M=({product:r,isAdmin:m})=>{const[n,c]=x.useState(r.ai_description||""),[s,u]=x.useState(!1),[g,h]=x.useState(!1),[d,o]=x.useState(!1),p=async()=>{u(!0);try{const t=await y.generateAiDescription(r.id,{name:r.name,brand:r.brand,price:r.price,formattedPrice:r.formattedPrice});c(t.description),o(!0)}catch(t){console.error("Error generating description:",t),alert("Error al generar la descripción")}finally{u(!1)}},f=async()=>{h(!0);try{await y.saveAiDescription(r.id,n),o(!1)}catch(t){console.error("Error saving description:",t),alert("Error al guardar la descripción")}finally{h(!1)}};return!m&&!n?null:e.jsx("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-100",children:!d&&!n?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"No hay descripción generada por IA para este producto."}),m&&e.jsx("button",{onClick:p,disabled:s,className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2 animate-spin"}),"Generando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Generar Descripción con IA"]})})]}):e.jsxs("div",{className:"space-y-4",children:[d?e.jsx("textarea",{value:n,onChange:t=>c(t.target.value),className:"w-full h-40 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Descripción del producto..."}):e.jsx("div",{className:"prose max-w-none text-gray-700",children:n.split(`
`).map((t,i)=>{const a=t.trim();if(!a)return e.jsx("div",{className:"h-2"},i);if(a.startsWith("**")&&a.endsWith("**")&&!a.includes(":"))return e.jsx("h4",{className:"text-lg font-bold text-gray-900 mt-4 mb-2",children:a.replace(/\*\*/g,"")},i);if(a.startsWith("* ")||a.startsWith("- ")){const N=a.substring(2).split(/(\*\*.*?\*\*)/g);return e.jsxs("div",{className:"flex items-start mb-1 ml-4",children:[e.jsx("span",{className:"mr-2 text-purple-500",children:"•"}),e.jsx("span",{children:N.map((j,C)=>j.startsWith("**")&&j.endsWith("**")?e.jsx("strong",{className:"font-semibold text-gray-900",children:j.replace(/\*\*/g,"")},C):j)})]},i)}const b=t.split(/(\*\*.*?\*\*)/g);return e.jsx("p",{className:"mb-2 leading-relaxed",children:b.map((l,N)=>l.startsWith("**")&&l.endsWith("**")?e.jsx("strong",{className:"font-semibold text-gray-900",children:l.replace(/\*\*/g,"")},N):l)},i)})}),m&&e.jsx("div",{className:"flex justify-end space-x-3",children:d?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancelar"}),e.jsx("button",{onClick:f,disabled:g,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:g?"Guardando...":"Guardar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,disabled:s,className:"px-4 py-2 text-purple-600 hover:bg-purple-100 rounded-lg transition-colors",children:s?"Regenerando...":"Regenerar"}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Editar"]})]})})]})})};export{$ as default};
