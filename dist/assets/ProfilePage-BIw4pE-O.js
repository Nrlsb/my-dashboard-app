import{u as M,b as w,f as P,c as D,j as e,a as j}from"./index-DwNA7lLh.js";import{r as m,s as N,U as u,O,M as L,P as S,I as U,p as I,w as k,Q as G}from"./ui-libs-CgXQafC0.js";import{u as R}from"./useMutation-BZI9kCvh.js";import"./vendor-qkC6yhPU.js";const n=({icon:s,label:c,id:t,...o})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-1",children:c}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(s,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{id:t,className:"w-full pl-10 p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",...o})]})]}),B=()=>e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"})]}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("div",{className:"bg-gray-200 h-10 w-28 rounded-lg"})})]}),q=({message:s})=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-md",children:[e.jsx("p",{className:"text-red-500 font-semibold text-lg",children:"Error al cargar el perfil"}),e.jsx("p",{className:"text-gray-600 mt-2",children:s})]});function J(){const[s,c]=m.useState({A1_COD:"",A1_LOJA:"",A1_NOME:"",A1_EMAIL:"",A1_NUMBER:"",A1_CGC:"",A1_END:""}),[t,o]=m.useState(""),[x,g]=m.useState(""),h=M(),{user:l}=w(),b=P(),{data:a,isLoading:p,isError:v,error:y,isSuccess:f}=D({queryKey:["userProfile",l?.id],queryFn:()=>j.fetchUserProfile(),enabled:!!l?.id,staleTime:1e3*60*15});m.useEffect(()=>{f&&a&&c({A1_COD:a.A1_COD||"",A1_LOJA:a.A1_LOJA||"",A1_NOME:a.A1_NOME||"",A1_EMAIL:a.A1_EMAIL||"",A1_NUMBER:a.A1_NUMBER||"",A1_CGC:a.A1_CGC||"",A1_END:a.A1_END||""})},[f,a]);const r=R({mutationFn:j.updateUserProfile,onSuccess:i=>{o("¡Perfil actualizado con éxito!"),g(""),b.invalidateQueries({queryKey:["userProfile",l?.id]}),b.invalidateQueries({queryKey:["currentUser"]})},onError:i=>{g(i.message||"Error al guardar los cambios."),o("")}}),d=i=>{const{id:C,value:_}=i.target;c(E=>({...E,[C]:_}))},A=i=>{i.preventDefault(),o(""),g(""),r.mutate(s)};if(p)return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("header",{className:"mb-6 flex items-center",children:[e.jsx("button",{onClick:()=>h("/dashboard"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors","aria-label":"Volver al dashboard",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Mi Perfil"}),e.jsx("p",{className:"text-gray-600",children:"Actualiza tu información personal y de contacto."})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto",children:e.jsx(B,{})})]});if(v){const i=l?.id?y.message:"No se ha podido identificar al usuario.";return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("header",{className:"mb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Mi Perfil"})}),e.jsx(q,{message:i})]})}return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("header",{className:"mb-6 flex items-center",children:[e.jsx("button",{onClick:()=>h("/dashboard"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors","aria-label":"Volver al dashboard",children:e.jsx(N,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Mi Perfil"}),e.jsx("p",{className:"text-gray-600",children:"Actualiza tu información personal y de contacto."})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto",children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(n,{icon:u,label:l?.role==="vendedor"?"Código de Vendedor":"Código de Cliente",id:"A1_COD",value:s.A1_COD,onChange:d,disabled:!0})}),e.jsx(n,{icon:u,label:l?.role==="vendedor"?"Nombre":"Nombre / Razón Social",id:"A1_NOME",value:s.A1_NOME,onChange:d,disabled:r.isPending}),l?.role!=="vendedor"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:u,label:"CUIT",id:"A1_CGC",value:s.A1_CGC,onChange:d,disabled:r.isPending}),e.jsx(n,{icon:O,label:"Dirección",id:"A1_END",value:s.A1_END,onChange:d,disabled:r.isPending})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{icon:L,label:"Email de Contacto",id:"A1_EMAIL",type:"email",value:s.A1_EMAIL,onChange:d,disabled:r.isPending}),e.jsx(n,{icon:S,label:"Teléfono",id:"A1_NUMBER",type:"tel",value:s.A1_NUMBER,onChange:d,disabled:r.isPending})]}),x&&e.jsxs("div",{className:"flex items-center p-3 bg-red-100 text-red-700 rounded-md",children:[e.jsx(U,{className:"w-5 h-5 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:x})]}),t&&e.jsxs("div",{className:"flex items-center p-3 bg-green-100 text-green-700 rounded-md",children:[e.jsx(I,{className:"w-5 h-5 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:t})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center px-6 py-2.5 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50",disabled:r.isPending,children:[r.isPending?e.jsx(k,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(G,{className:"w-5 h-5 mr-2"}),r.isPending?"Guardando...":"Guardar Cambios"]})})]})})]})}export{J as default};
