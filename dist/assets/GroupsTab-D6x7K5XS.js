import{a as l,j as e,L as O}from"./index-BZjVnX_U.js";import{r as a,a4 as t,s as ne,W as ie,u as F,X as f,$ as q,S as de}from"./ui-libs-CEDXVaGM.js";import{C as B}from"./CustomSelect-BnF8ZfS-.js";import{C as ue}from"./ConfirmationModal-B_SkBHCG.js";import"./vendor-qkC6yhPU.js";const ge=()=>{const[p,E]=a.useState([]),[o,i]=a.useState(!1),[W,j]=a.useState(!1),[X,_]=a.useState(!1),[h,k]=a.useState("static_group"),[I,P]=a.useState(""),[y,d]=a.useState(""),[D,U]=a.useState(""),[H,J]=a.useState([]),[c,z]=a.useState(null),[T,v]=a.useState([]),[b,R]=a.useState(""),[u,m]=a.useState(""),[N,A]=a.useState(""),[M,L]=a.useState([]),[K,$]=a.useState(!1),[Q,w]=a.useState(!1),[C,G]=a.useState(null);a.useEffect(()=>{g()},[]);const g=async()=>{i(!0);try{const s=await l.getCarouselGroups();E(s.filter(r=>!r.is_launch_group))}catch(s){console.error(s),t.error("Error al cargar grupos")}finally{i(!1)}},V=async()=>{j(!0);try{const s=await l.getAdminProductGroups();J(s)}catch{t.error("Error al cargar grupos disponibles")}},Y=async s=>{s.preventDefault();try{await l.createCarouselGroup({name:I,image_url:y,type:h,reference_id:h==="static_group"?D:null,display_order:p.length+1}),t.success("Grupo creado"),j(!1),g(),Z()}catch{t.error("Error al crear grupo")}},Z=()=>{P(""),d(""),k("static_group"),U("")},ee=s=>{G(s),w(!0)},se=async()=>{if(C){w(!1);try{await l.deleteCarouselGroup(C.id),t.success("Grupo eliminado"),g()}catch{t.error("Error al eliminar grupo")}finally{G(null)}}},re=()=>{w(!1),G(null)},ae=async s=>{z(s),R(s.name||""),m(s.image_url||""),L([]),A(""),_(!0);try{const r=await l.getCustomCollectionProducts(s.id);v(r)}catch{t.error("Error al cargar items de la colección")}},te=async()=>{try{await l.updateCarouselGroup(c.id,{name:b,image_url:u}),t.success("Grupo actualizado"),E(s=>s.map(r=>r.id===c.id?{...r,name:b,image_url:u}:r)),z(s=>({...s,name:b,image_url:u})),g()}catch{t.error("Error al actualizar grupo")}},le=async s=>{if(s.preventDefault(),!!N.trim()){$(!0);try{const r=await l.fetchProducts(1,N);L(r.products)}catch{t.error("Error al buscar productos")}finally{$(!1)}}},oe=async s=>{try{await l.addCustomGroupItem(c.id,s),t.success("Producto agregado a la colección");const r=await l.getCustomCollectionProducts(c.id);v(r)}catch{t.error("Error al agregar producto")}},ce=async s=>{try{await l.removeCustomGroupItem(c.id,s),t.success("Producto eliminado de la colección");const r=await l.getCustomCollectionProducts(c.id);v(r)}catch{t.error("Error al eliminar producto")}};return o&&p.length===0?e.jsx(O,{}):e.jsxs("div",{children:[e.jsxs("button",{onClick:V,className:"bg-espint-green text-white px-4 py-2 rounded mb-4 flex items-center gap-2 hover:bg-green-600 transition",children:[e.jsx(ne,{size:20})," Agregar Grupo"]}),e.jsxs("div",{className:"space-y-4",children:[p.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded shadow flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:s.name,className:"w-16 h-16 object-cover rounded shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg leading-tight",children:s.name||`Grupo ${s.reference_id}`}),e.jsx("span",{className:`text-xs px-2 py-1 rounded inline-block mt-1 ${s.type==="static_group"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:s.type==="static_group"?"Grupo Existente":"Colección Personalizada"})]})]}),e.jsxs("div",{className:"flex gap-2 self-end md:self-auto",children:[s.type==="custom_collection"&&e.jsx("button",{onClick:()=>ae(s),className:"text-blue-500 hover:text-blue-700 p-2",title:"Editar Productos",children:e.jsx(ie,{size:20})}),e.jsx("button",{onClick:()=>ee(s),className:"text-red-500 hover:text-red-700 p-2",title:"Eliminar Grupo",children:e.jsx(F,{size:20})})]})]},s.id)),p.length===0&&!o&&e.jsx("p",{className:"text-gray-500",children:"No hay grupos configurados."})]}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Agregar Grupo al Carousel"}),e.jsx("button",{onClick:()=>j(!1),children:e.jsx(f,{size:24})})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Tipo"}),e.jsx(B,{options:[{label:"Grupo Existente",value:"static_group"},{label:"Colección Personalizada",value:"custom_collection"}],value:h,onChange:s=>k(s),placeholder:"Seleccionar Tipo"})]}),h==="static_group"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Seleccionar Grupo"}),e.jsx(B,{options:H.map(s=>({label:`${s.brand} (${s.product_group})`,value:s.product_group})),value:D,onChange:s=>U(s),placeholder:"-- Seleccionar --"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Nombre de la Colección"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:I,onChange:s=>P(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Imagen de la Colección"}),y&&e.jsxs("div",{className:"mb-2 relative w-full h-32 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:[e.jsx("img",{src:y,alt:"Preview",className:"w-full h-full object-contain",referrerPolicy:"no-referrer"}),e.jsx("button",{type:"button",onClick:()=>d(""),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-sm",title:"Eliminar imagen",children:e.jsx(f,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"flex-1 cursor-pointer bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),o?"Subiendo...":"Seleccionar Imagen",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:o,onChange:async s=>{const r=s.target.files[0];if(!r)return;const S=URL.createObjectURL(r);d(S),i(!0);const x=new FormData;x.append("image",r);try{const n=await l.uploadToDrive(x);d(n.imageUrl),t.success("Imagen subida a Drive correctamente")}catch(n){console.error(n),t.error("Error al subir imagen"),d("")}finally{i(!1)}}})]})})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-espint-blue text-white py-2 rounded font-bold hover:bg-blue-800 transition",disabled:o,children:"Crear Grupo"})]})]})}),X&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Editar Colección: ",c.name]}),e.jsx("button",{onClick:()=>_(!1),children:e.jsx(f,{size:24})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded border border-gray-200",children:[e.jsx("h3",{className:"font-bold mb-3 text-gray-700",children:"Detalles del Grupo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Nombre"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:b,onChange:s=>R(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Imagen"}),u&&e.jsxs("div",{className:"mb-2 relative w-full h-32 bg-white rounded-md overflow-hidden border border-gray-200",children:[e.jsx("img",{src:u,alt:"Preview",className:"w-full h-full object-contain",referrerPolicy:"no-referrer"}),e.jsx("button",{type:"button",onClick:()=>m(""),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-sm",title:"Eliminar imagen",children:e.jsx(f,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"flex-1 cursor-pointer bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),o?"Subiendo...":"Cambiar Imagen",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:o,onChange:async s=>{const r=s.target.files[0];if(!r)return;const S=URL.createObjectURL(r);m(S),i(!0);const x=new FormData;x.append("image",r);try{const n=await l.uploadToDrive(x);m(n.imageUrl),t.success("Imagen subida a Drive correctamente")}catch(n){console.error(n),t.error("Error al subir imagen"),m("")}finally{i(!1)}}})]})})]})]}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{onClick:te,className:`bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition ${o?"opacity-50 cursor-not-allowed":""}`,disabled:o,children:o?"Guardando...":"Guardar Cambios"})})]}),e.jsxs("form",{onSubmit:le,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar productos para agregar...",className:"flex-1 border p-2 rounded",value:N,onChange:s=>A(s.target.value)}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:e.jsx(de,{size:20})})]}),K&&e.jsx(O,{}),M.length>0&&e.jsxs("div",{className:"mb-4 border-b pb-4",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Resultados de Búsqueda"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:M.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-10 h-10 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.code})]})]}),e.jsx("button",{onClick:()=>oe(s.id),className:"bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600",children:"Agregar"})]},s.id))})]}),e.jsx("h3",{className:"font-bold mb-2",children:"Productos en la Colección"}),e.jsxs("div",{className:"space-y-2",children:[T.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-10 h-10 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.code})]})]}),e.jsx("button",{onClick:()=>ce(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(F,{size:18})})]},s.id)),T.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"No hay productos en esta colección."})]})]})}),e.jsx(ue,{isOpen:Q,onClose:re,onConfirm:se,title:"Eliminar Grupo",message:`¿Estás seguro de eliminar el grupo "${C?.name}"?`,confirmText:"Eliminar",variant:"danger"})]})};export{ge as default};
