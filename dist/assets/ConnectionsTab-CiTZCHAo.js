import{j as e,A as w,a as h}from"./index-Bn-_5g9O.js";import{r as l,a9 as b,a4 as d}from"./ui-libs-CgXQafC0.js";import"./vendor-qkC6yhPU.js";const S=({progress:s,message:o})=>e.jsxs("div",{className:"w-full mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:o}),e.jsxs("span",{className:"font-medium text-gray-700",children:[s,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${s}%`}})})]}),T=()=>{const[s,o]=l.useState(!1),[u,m]=l.useState(0),[g,p]=l.useState(""),[t,x]=l.useState(null),f=async c=>{if(s)return;const y=c==="manual"?"¿Deseas iniciar la sincronización manual? Este proceso puede tomar varios minutos.":"¿Deseas iniciar la sincronización TOTAL? Este proceso abarca TODA la base de datos y puede demorar varios minutos.";if(!window.confirm(y))return;o(!0),x(c),m(0),p("Iniciando conexión...");const j=localStorage.getItem("token"),v=`${w}/admin/sync-events?token=${j}`,n=new EventSource(v);n.onopen=()=>{console.log("SSE Connection Opened")},n.onmessage=r=>{try{const a=JSON.parse(r.data);a.type==="progress"&&(a.percent!==null&&m(a.percent),a.message&&p(a.message),a.status==="completed"?(d.success(a.message||"Sincronización completada"),i()):a.status==="error"&&(d.error(a.message||"Error en la sincronización"),i()))}catch(a){console.error("Error parsing SSE data",a)}},n.onerror=r=>{console.error("SSE Error",r),n.readyState===2&&i()};const i=()=>{n.close(),o(!1),x(null)};try{c==="manual"?await h.triggerManualSync():await h.triggerFullSync()}catch(r){console.error(r),d.error("No se pudo iniciar la sincronización."),i()}};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center relative overflow-hidden",children:[e.jsx("div",{className:"bg-green-100 p-4 rounded-full mb-4",children:e.jsx(b,{size:40,className:`text-green-600 ${s&&t==="manual"?"animate-spin":""}`})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Sincronización Manual"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Ejecuta manualmente el proceso de sincronización de productos y precios desde Protheus."}),s&&t==="manual"?e.jsx(S,{progress:u,message:g}):e.jsx("button",{onClick:()=>f("manual"),disabled:s,className:`bg-green-600 text-white px-4 py-2 rounded font-bold hover:bg-green-700 transition w-full ${s?"opacity-50 cursor-not-allowed":""}`,children:s?"Sincronizando...":"Sincronizar Ahora"})]}),e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center relative overflow-hidden",children:[e.jsx("div",{className:"bg-purple-100 p-4 rounded-full mb-4",children:e.jsx(b,{size:40,className:`text-purple-600 ${s&&t==="full"?"animate-spin":""}`})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Sincronización Total"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Sincroniza Productos, Precios, Clientes y Vendedores. Útil para actualizaciones masivas o iniciales."}),s&&t==="full"?e.jsx(S,{progress:u,message:g}):e.jsx("button",{onClick:()=>f("full"),disabled:s,className:`bg-purple-600 text-white px-4 py-2 rounded font-bold hover:bg-purple-700 transition w-full ${s?"opacity-50 cursor-not-allowed":""}`,children:s?"Sincronizando...":"Sincronizar Todo"})]})]})};export{T as default};
