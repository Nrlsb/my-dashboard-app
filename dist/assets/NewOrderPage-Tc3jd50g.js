import{c as E,a as X,u as L,r,d as H,j as e,S as R,b as M,L as J}from"./index-CwM0WAWl.js";import{C as K}from"./CustomSelect-z94BmbL1.js";import{A as W}from"./arrow-left-QZw-K6al.js";import{S as Y,X as Z}from"./x-_tLvud1g.js";import{C as T}from"./chevron-right-DLSR7Wkl.js";import{T as ee,P as se}from"./trash-2-CKo5-eEj.js";import{C as q}from"./circle-check-big-C6z7pSiY.js";import{P as D}from"./package-Pm4ZNlA7.js";import"./check-ooMS4Kjg.js";const te=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ae=E("chevron-left",te);const re=[["path",{d:"M5 12h14",key:"1ays0h"}]],le=E("minus",re),ne=20,m=t=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(t||0),de=({product:t,onClose:n,onAddToCart:x})=>{const[h,u]=r.useState(1),[c,g]=r.useState(!1),j=L();r.useEffect(()=>{u(1),g(!1)},[t]);const y=()=>{x(t,h),g(!0),setTimeout(()=>{n()},1500)},N=l=>{j(`/product-detail/${l}`),n()};return t?e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-50",onClick:n,children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row overflow-hidden",onClick:l=>l.stopPropagation(),children:[e.jsx("button",{onClick:n,className:"absolute top-4 right-4 p-2 text-gray-500 hover:text-gray-800 bg-gray-100 rounded-full z-10",children:e.jsx(Z,{className:"w-6 h-6"})}),e.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center bg-gray-100 p-8",children:t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.name,className:"max-h-64 object-contain rounded-lg"}):e.jsx(D,{className:"w-48 h-48 text-gray-400"})}),e.jsxs("div",{className:"w-full md:w-1/2 p-8 flex flex-col justify-center overflow-y-auto",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600 uppercase",children:t.brand||"Marca"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-1",children:t.name}),e.jsx("p",{className:"text-3xl font-extrabold text-gray-800 mt-3",children:m(t.price)}),e.jsxs("p",{className:"text-gray-600 leading-relaxed my-4 text-sm",children:[t.capacity_description||"Descripción no disponible.",'Aquí tienes una descripción de producto para "Látex Interior Constructor Mate Blanco 20L" de Alba.']}),e.jsxs("div",{className:"flex items-center space-x-4 my-4",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cantidad:"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>u(l=>Math.max(1,l-1)),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-l-lg",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:h,readOnly:!0,className:"w-16 text-center border-y-0 border-x focus:ring-0"}),e.jsx("button",{onClick:()=>u(l=>l+1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-r-lg",children:e.jsx(se,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.stock_disponible," disponibles)"]}),t.stock_disponible<=0?e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),"Sin Stock"]}):t.stock_disponible<=(t.stock_de_seguridad||0)?e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full mr-1"}),"Stock Bajo"]}):e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-1"}),"Disponible"]})]}),e.jsx("button",{onClick:y,disabled:c,className:`w-full py-3 px-6 rounded-lg text-white font-semibold transition-colors duration-300 ${c?"bg-espint-green hover:bg-green-600":"bg-espint-blue hover:bg-blue-700"}`,children:c?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"Agregado"]}):e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Agregar al Carrito"]})}),e.jsx("button",{onClick:()=>N(t.id),className:"mt-4 text-center text-sm text-blue-600 hover:underline",children:"Ver detalles completos del producto"})]})]})}):null},be=()=>{const{user:t}=X(),n=L(),[x,h]=r.useState([]),[u,c]=r.useState(new Map),[g,j]=r.useState(0),[y,N]=r.useState([]),[l,v]=r.useState(!0),[C,k]=r.useState(null),[w,F]=r.useState(""),[p,I]=r.useState(""),[U,P]=r.useState(null),{cart:d,addToCart:S,updateQuantity:$,removeFromCart:Q}=H(),[o,b]=r.useState(1),f=Math.ceil(g/ne);r.useEffect(()=>{t&&(async()=>{try{const a=await M.fetchProtheusBrands();N(a)}catch(a){console.error(a)}})()},[t]),r.useEffect(()=>{t&&(async()=>{try{v(!0),k(null);const a=p?[p]:[],i=await M.fetchProducts(o,w,a);h(i.products),j(i.totalProducts),c(G=>{const A=new Map(G);return i.products.forEach(B=>A.set(B.id,B)),A})}catch(a){console.error("Error al cargar productos:",a),k(a.message)}finally{v(!1)}})()},[o,w,p,t]);const V=(s,a)=>{const i=parseInt(a,10);$(s,isNaN(i)?0:i)},z=s=>{S(s,1)},_=r.useMemo(()=>d.reduce((s,a)=>s+a.price*a.quantity,0),[d]),O=()=>l?e.jsx(J,{text:"Cargando productos..."}):C?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md text-center text-red-500",children:C}):x.length===0?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md text-center text-gray-500",children:"No se encontraron productos."}):x.map(s=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between p-4 bg-white rounded-lg shadow-md cursor-pointer hover:shadow-lg transition-shadow gap-4 md:gap-0",onClick:()=>P(s),children:[e.jsxs("div",{className:"flex items-start md:items-center space-x-4 w-full md:w-auto",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-gray-100 rounded-lg",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-16 h-16 object-cover rounded-md"}):e.jsx(D,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 line-clamp-2 md:line-clamp-2",children:s.name}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-500 mt-1",children:[s.brand," ",e.jsx("span",{className:"mx-1",children:"•"})," Cód: ",s.code]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsxs("span",{className:"text-xs md:text-sm text-gray-500 mr-2",children:["Stock: ",s.stock_disponible]}),s.stock_disponible<=0?e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mr-1"}),"Sin Stock"]}):s.stock_disponible<=(s.stock_de_seguridad||0)?e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full mr-1"}),"Bajo"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-1"}),"Disponible"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between md:flex-col md:items-end md:justify-center w-full md:w-auto mt-2 md:mt-0 pt-3 md:pt-0 border-t md:border-t-0 border-gray-100",children:[e.jsx("p",{className:"text-lg font-bold text-[#0B3D68]",children:m(s.price)}),e.jsx("button",{onClick:a=>{a.stopPropagation(),z(s)},className:"px-6 py-2 md:px-4 md:py-1 text-sm font-medium text-white bg-[#8CB818] rounded-md hover:bg-[#7aa315] transition-colors cursor-pointer md:mt-2",children:"Añadir"})]})]},s.id));return e.jsxs("div",{className:"min-h-screen bg-gray-100 font-sans",children:[e.jsx(de,{product:U,onClose:()=>P(null),onAddToCart:S}),e.jsxs("main",{className:"p-4 md:p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>n("/dashboard"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Volver al dashboard",children:e.jsx(W,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Nuevo Pedido"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-md",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"search-product",className:"sr-only",children:"Buscar Producto"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{id:"search-product",type:"text",value:w,onChange:s=>{F(s.target.value),b(1)},className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-espint-blue focus:border-espint-blue",placeholder:"Buscar por nombre o código..."})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"brand-select",className:"sr-only",children:"Seleccionar Marca"}),e.jsx(K,{options:y,value:p,onChange:s=>{I(s),b(1)},placeholder:"Todas las marcas"})]})]})}),e.jsx("div",{className:"bg-blue-50 border-l-4 border-espint-blue p-4 mb-4 rounded-r-lg",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Nota:"})," Seleccione los productos de la lista para agregarlos al pedido."]})}),e.jsx("div",{className:"space-y-4",children:O()}),f>1&&e.jsxs("div",{className:"flex justify-between items-center p-4 bg-white rounded-lg shadow-md",children:[e.jsxs("button",{onClick:()=>b(s=>Math.max(s-1,1)),disabled:o===1||l,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 cursor-pointer",children:[e.jsx(ae,{className:"w-5 h-5 mr-2"}),"Anterior"]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Página ",o," de ",f]}),e.jsxs("button",{onClick:()=>b(s=>Math.min(s+1,f)),disabled:o===f||l,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 cursor-pointer",children:["Siguiente",e.jsx(T,{className:"w-5 h-5 ml-2"})]})]})]}),e.jsx("div",{className:"lg-col-span-1 hidden lg:block",children:e.jsxs("div",{className:"sticky top-8 bg-white rounded-lg shadow-md flex flex-col max-h-[calc(100vh-4rem)] border-t-4 border-espint-magenta",children:[e.jsx("div",{className:"flex-shrink-0 p-6",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(R,{className:"w-6 h-6 text-gray-800 mr-3"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Resumen del Pedido"})]})}),e.jsxs("div",{className:"flex-1 divide-y divide-gray-200 overflow-y-auto px-6",children:[d.length===0&&e.jsx("p",{className:"py-4 text-center text-gray-500",children:"Tu carrito está vacío."}),d.map(s=>e.jsxs("div",{className:"py-4 flex items-center space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:m(s.price)}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("label",{htmlFor:`qty-${s.id}`,className:"text-xs text-gray-600 mr-2",children:"Cant:"}),e.jsx("input",{id:`qty-${s.id}`,type:"number",value:s.quantity,onChange:a=>V(s.id,a.target.value),className:"w-16 px-2 py-1 border border-gray-300 rounded-md text-sm",min:"0",max:s.stock_disponible})]})]}),e.jsx("button",{onClick:()=>Q(s.id),className:"p-1 text-gray-400 hover:text-red-600","aria-label":"Quitar item",children:e.jsx(ee,{className:"w-5 h-5"})})]},s.id))]}),d.length>0&&e.jsxs("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:m(_)})]}),e.jsxs("button",{onClick:()=>n("/order-preview"),disabled:d.length===0,className:"w-full inline-flex items-center justify-center px-6 py-3 font-semibold text-white bg-[#8CB818] rounded-md shadow-sm hover:bg-[#7aa315] transition-colors disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Revisar Pedido"]})]})]})})]})]}),d.length>0&&e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] p-4 lg:hidden z-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Total Estimado"}),e.jsx("span",{className:"text-xl font-bold text-espint-blue",children:m(_)})]}),e.jsxs("button",{onClick:()=>n("/order-preview"),className:"flex items-center justify-center px-6 py-3 bg-[#8CB818] text-white font-bold rounded-lg shadow-md hover:bg-[#7aa315] transition-colors",children:["Ver Pedido",e.jsx(T,{className:"w-5 h-5 ml-1"})]})]}),d.length>0&&e.jsx("div",{className:"h-24 lg:hidden"})]})};export{be as default};
