import{c as P,u as O,b as D,h as B,r as d,j as e,d as E,a as f}from"./index-D4bF6ViR.js";import{u as _}from"./useQuery-BYFzGr7S.js";import{u as V}from"./useMutation-B_S8SKaY.js";import{C as N}from"./CustomSelect-BQfOd6z9.js";import{P as T}from"./package-Dlhfn9It.js";import{C as M}from"./chevron-right-CjxsofYo.js";import"./useBaseQuery-XsHwmUvW.js";import"./check-6EdDfDG4.js";const $=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],R=P("calendar",$);function G(){const c=O(),{user:l}=D(),a=l?.role==="vendedor",w=B(),[x,h]=d.useState({}),[m,u]=d.useState({}),[p,j]=d.useState(""),[o,v]=d.useState(""),g=(t,s)=>{h(r=>({...r,[t]:s}))},b=(t,s)=>{u(r=>({...r,[t]:s}))},{data:i,isLoading:C,error:y}=_({queryKey:["orderHistory",l.id],queryFn:()=>f.fetchOrderHistory(),staleTime:1e3*60*5,enabled:!!l?.id});d.useEffect(()=>{if(i){const t={},s={};i.forEach(r=>{s[r.id]=r.vendorSalesOrderNumber||"",t[r.id]=r.status}),h(s),u(t)}},[i]);const S=V({mutationFn:t=>f.updateOrderDetails(t),onSuccess:()=>{alert("Cambios guardados exitosamente!"),w.invalidateQueries(["orderHistory",l.id])},onError:t=>{alert("Error al guardar los cambios: "+t.message)}}),k=()=>{const t=i.map(s=>({id:s.id,vendorSalesOrderNumber:x[s.id],status:m[s.id]}));S.mutate(t)},n=i?.filter(t=>{const s=p?t.status===p:!0,r=o?t.client_name&&t.client_name.toLowerCase().includes(o.toLowerCase())||String(t.id).includes(o):!0;return s&&r})||[];return C?e.jsx(E,{text:"Cargando historial..."}):y?e.jsxs("div",{children:["Error al cargar el historial: ",y.message]}):e.jsxs("div",{className:"container mx-auto p-4 md:p-8 min-h-screen bg-gray-50",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-6 border-b-2 border-gray-200 pb-2",children:"Historial de Pedidos"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-6 items-center",children:[e.jsx("button",{onClick:()=>c("/dashboard"),className:"flex-grow sm:flex-grow-0 w-full sm:w-auto px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors duration-200 font-semibold cursor-pointer",children:"Volver al Dashboard"}),a&&e.jsx("button",{onClick:k,className:"flex-grow sm:flex-grow-0 w-full sm:w-auto px-4 py-2 bg-espint-green text-white rounded-md hover:bg-green-600 transition-colors duration-200 font-semibold cursor-pointer",children:"Guardar Cambios"})]}),a&&e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md my-5 flex flex-col sm:flex-row gap-4 items-center",children:[e.jsx("input",{type:"text",placeholder:"Buscar por Cliente o ID de Pedido",value:o,onChange:t=>v(t.target.value),className:"py-2 px-3 border border-gray-300 rounded-md text-base min-w-[200px] w-full sm:w-auto focus:ring-blue-500 focus:border-blue-500"}),e.jsx("div",{className:"relative w-full md:w-64",children:e.jsx(N,{options:["Pendiente","Confirmado","Cancelado"],value:p,onChange:t=>j(t),placeholder:"Todos los Estados"})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"md:hidden space-y-4",children:n&&n.length>0?n.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:"text-lg font-bold text-[#183B64]",children:["#",t.id]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold
                      ${t.status==="Pendiente"?"bg-yellow-100 text-yellow-800":""}
                      ${t.status==="Confirmado"?"bg-green-100 text-green-800":""}
                      ${t.status==="Cancelado"||t.status==="Rechazado"?"bg-red-100 text-red-800":""}
                      ${["Pendiente","Confirmado","Cancelado","Rechazado"].includes(t.status)?"":"bg-gray-100 text-gray-800"}
                    `,children:t.status})]}),a&&e.jsxs("div",{className:"mb-3 text-sm font-medium text-gray-700",children:[e.jsx("span",{className:"text-gray-500 mr-1",children:"Cliente:"}),t.client_name]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:t.formatted_date})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.item_count," Items"]})]})]}),!a&&t.status==="Confirmado"&&t.vendorSalesOrderNumber&&e.jsxs("div",{className:"mb-3 text-sm font-medium text-gray-700",children:[e.jsx("span",{className:"text-gray-500 mr-1",children:"N° Pedido Venta:"}),"#",t.vendorSalesOrderNumber]}),a&&e.jsxs("div",{className:"mb-4 space-y-3 bg-gray-50 p-3 rounded-md",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500",children:"N° Pedido Venta"}),e.jsx("input",{type:"text",value:x[t.id]||"",onChange:s=>g(t.id,s.target.value),placeholder:"N° Pedido",className:"p-2 border border-gray-300 rounded-md text-sm w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500",children:"Estado del Pedido"}),e.jsx(N,{options:["Pendiente","Confirmado","Cancelado"],value:m[t.id]||"",onChange:s=>b(t.id,s),placeholder:"Seleccionar"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:t.formattedTotal}),e.jsxs("button",{onClick:()=>c(`/order-detail/${t.id}`),className:"flex items-center text-sm font-medium text-espint-blue hover:text-blue-700 transition-colors",children:["Ver Detalle",e.jsx(M,{className:"w-4 h-4 ml-1"})]})]})]},t.id)):e.jsx("p",{className:"p-4 text-gray-500 text-center bg-white rounded-lg shadow-sm",children:"No tienes pedidos en tu historial."})}),e.jsx("div",{className:"hidden md:block overflow-x-auto bg-white rounded-lg shadow-lg",children:n&&n.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 table-collapse",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"ID Pedido"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"Fecha"}),a&&e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"Cliente"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"Total"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"Estado"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"Cant. Items"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"N° Pedido Venta"}),a&&e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"Estado del Pedido"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-white uppercase tracking-wider border-b border-gray-200 bg-[#0B3D68]",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 font-mono",children:["#",t.id]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800",children:t.formatted_date}),a&&e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800",children:t.client_name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 font-mono",children:t.formattedTotal}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800",children:t.status}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:t.item_count}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:a?e.jsx("input",{type:"text",value:x[t.id]||"",onChange:s=>g(t.id,s.target.value),placeholder:"N° Pedido",className:"p-1 border border-gray-300 rounded-md w-24 text-center text-sm"}):e.jsx("span",{className:"font-mono font-medium text-gray-700",children:t.status==="Confirmado"&&t.vendorSalesOrderNumber?`#${t.vendorSalesOrderNumber}`:"-"})}),a&&e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:e.jsxs("select",{value:m[t.id]||"",onChange:s=>b(t.id,s.target.value),className:"p-1 border border-gray-300 rounded-md text-center text-sm w-32",children:[e.jsx("option",{value:"Pendiente",children:"Pendiente"}),e.jsx("option",{value:"Rechazado",children:"Rechazado"}),e.jsx("option",{value:"Confirmado",children:"Confirmado"})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium text-center",children:e.jsx("button",{onClick:()=>c(`/order-detail/${t.id}`),className:"inline-flex items-center px-3 py-1.5 border border-espint-blue text-xs font-medium rounded-md shadow-sm text-espint-blue bg-transparent hover:bg-espint-blue hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-espint-blue transition-colors duration-200 cursor-pointer",children:"Ver Detalle"})})]},t.id))})]}):e.jsx("p",{className:"p-4 text-gray-500",children:"No tienes pedidos en tu historial."})})]})]})}export{G as default};
