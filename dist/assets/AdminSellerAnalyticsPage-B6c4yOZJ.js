import{i as w,u as S,e as C,a as D,j as e,L as A}from"./index-C9spfAEE.js";import{r as a,a8 as P,A as m,c as k,a2 as E,a3 as V,D as L,b as $}from"./ui-libs-Bu6C6VT7.js";import"./vendor-qkC6yhPU.js";const M=()=>{const{sellerCode:r}=w(),l=S(),[h]=C(),g=h.get("name")||r,[t,u]=a.useState(null),[p,o]=a.useState(!0),[c,x]=a.useState(null),[n,b]=a.useState(()=>{const s=new Date;return s.setDate(s.getDate()-30),s.toISOString().split("T")[0]}),[i,j]=a.useState(()=>new Date().toISOString().split("T")[0]);a.useEffect(()=>{f()},[r,n,i]);const f=async()=>{o(!0),x(null);try{const s=await D.getSellerAnalytics(r,{startDate:n,endDate:i});u(s.data)}catch(s){console.error("Error fetching seller analytics:",s),x("No se pudo cargar la información del vendedor."),P.error("Error al cargar las estadísticas.")}finally{o(!1)}};return p?e.jsx(A,{text:"Cargando análisis del vendedor..."}):c||!t?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] p-4 text-center",children:[e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg mb-4",children:c||"No hay datos disponibles."}),e.jsxs("button",{onClick:()=>l("/analytics"),className:"flex items-center gap-2 text-blue-600 hover:underline",children:[e.jsx(m,{className:"w-4 h-4"})," Volver al Panel de Análisis"]})]}):e.jsxs("div",{className:"container mx-auto p-4 md:p-6 pb-12",children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>l(-1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Volver",children:e.jsx(m,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(k,{className:"w-6 h-6 text-blue-600"}),"Análisis de Vendedor"]}),e.jsxs("p",{className:"text-gray-500",children:[g," (",r,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"flex flex-col flex-1 md:flex-none",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1",children:"Desde"}),e.jsx("input",{type:"date",value:n,onChange:s=>b(s.target.value),className:"border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),e.jsxs("div",{className:"flex flex-col flex-1 md:flex-none",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",value:i,onChange:s=>j(s.target.value),className:"border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-500 text-sm font-medium uppercase tracking-wider",children:"Visitas"}),e.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg",children:e.jsx(E,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t.summary.visitCount})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-500 text-sm font-medium uppercase tracking-wider",children:"Pedidos"}),e.jsx("div",{className:"p-2 bg-green-100 text-green-600 rounded-lg",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[t.summary.orderCount,e.jsxs("span",{className:"text-sm font-normal text-green-600 ml-2",children:["(",t.summary.confirmedOrderCount," Conf.)"]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-500 text-sm font-medium uppercase tracking-wider",children:"Valor de Pedidos"}),e.jsx("div",{className:"p-2 bg-purple-100 text-purple-600 rounded-lg",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["$",t.summary.totalSales.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-500 text-sm font-medium uppercase tracking-wider",children:"Clientes Activos"}),e.jsx("div",{className:"p-2 bg-amber-100 text-amber-600 rounded-lg",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t.clients.length})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200 mb-8 overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800",children:"Actividad Diaria"}),e.jsx("div",{className:"h-64 flex items-end space-x-2 overflow-x-auto min-w-full pb-2",children:t.dailyStats.length>0?t.dailyStats.map((s,N)=>{const y=Math.max(...t.dailyStats.map(d=>d.visits),1),v=Math.max(...t.dailyStats.map(d=>d.orders),1);return e.jsxs("div",{className:"flex-1 flex flex-col items-center min-w-[50px] group relative",children:[e.jsxs("div",{className:"w-full flex items-end justify-center space-x-1 h-48",children:[e.jsx("div",{className:"w-3 bg-blue-500 rounded-t transition-all hover:bg-blue-600",style:{height:`${s.visits/y*100}%`}}),e.jsx("div",{className:"w-3 bg-green-500 rounded-t transition-all hover:bg-green-600",style:{height:`${s.orders/v*100}%`}})]}),e.jsx("div",{className:"mt-2 text-[10px] text-gray-500 transform -rotate-45 origin-top-left whitespace-nowrap",children:s.date.split("-").slice(1).join("/")}),e.jsxs("div",{className:"absolute bottom-full mb-2 bg-gray-800 text-white text-[10px] p-2 rounded opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none whitespace-nowrap",children:[e.jsx("strong",{children:s.date}),e.jsx("br",{}),"Visitas: ",s.visits,e.jsx("br",{}),"Pedidos: ",s.orders]})]},N)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"Sin datos de actividad en este periodo."})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Desglose por Cliente"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-semibold uppercase tracking-wider text-xs border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Cliente"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Visitas"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Pedidos"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Valor de Pedidos"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:t.clients.length>0?t.clients.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer group",onClick:()=>l(`/vendedor-client-analytics/${s.id}?name=${encodeURIComponent(s.full_name)}`),children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-semibold text-blue-600 group-hover:text-blue-800",children:s.full_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.email," | ID: ",s.a1_cod]})]}),e.jsx("td",{className:"px-6 py-4 text-center font-medium text-gray-700",children:s.visitCount}),e.jsxs("td",{className:"px-6 py-4 text-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.orderCount}),e.jsxs("span",{className:"text-xs text-green-600 block",children:["(",s.confirmedOrderCount," conf.)"]})]}),e.jsxs("td",{className:"px-6 py-4 text-right font-bold text-gray-900",children:["$",s.totalSpent.toLocaleString()]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-8 text-center text-gray-500 italic",children:"Este vendedor no tiene clientes asignados o no hay actividad en el rango seleccionado."})})})]})})]})]})};export{M as default};
