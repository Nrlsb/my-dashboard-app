import{c as O,r as l,j as e,f as V,b as S,L as X,w as M}from"./index-B-x8MTD0.js";import{X as J}from"./x-BNAImzv4.js";import{C as z}from"./check-DUaCqgU8.js";import{C as Y}from"./circle-alert-DWepWjqT.js";const Z=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],ee=O("file-image",Z);const se=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ae=O("upload",se),te=()=>{const[i,p]=l.useState([]),[N,U]=l.useState(!1),[v,k]=l.useState(null),[f,C]=l.useState(null),[A,j]=l.useState(null),[g,P]=l.useState({}),[h,I]=l.useState({}),[b,E]=l.useState({}),[$,R]=l.useState({}),[w,y]=l.useState({}),[s,o]=l.useState(""),[n,m]=l.useState(""),[x,B]=l.useState(!1),[_,L]=l.useState([]),[T,q]=l.useState("");l.useEffect(()=>{(async()=>{try{const a=await S.fetchProtheusBrands();L(a)}catch(a){console.error("Error loading brands:",a)}})()},[]);const W=t=>{p(Array.from(t.target.files)),k(null),C(null),j(null),P({}),I({}),E({}),y({})},G=async()=>{if(i.length===0){j("Por favor selecciona al menos un archivo.");return}U(!0),k(null),C(null),j(null);const t=new FormData;s&&t.append("userKeywords",s),n&&t.append("ignoreWords",n),T&&t.append("brand",T),t.append("useAI","false"),i.forEach(a=>{t.append("images",a)});try{const a=await S.uploadImages(t);k(a.results),C(a.errors);const r={},c={};a.results.forEach((d,u)=>{r[u]=[],c[u]=d.foundProducts||[]}),P(r),E(c)}catch(a){console.error("Upload error:",a),j(a.message||"Error al subir im치genes.")}finally{U(!1)}},D=async(t,a)=>{if(a){R(r=>({...r,[t]:!0}));try{const r=await S.fetchProducts(1,a,[],!1,250);E(c=>({...c,[t]:r.products}))}catch(r){console.error("Search error:",r)}finally{R(r=>({...r,[t]:!1}))}}},F=(t,a)=>{P(r=>{const c=r[t]||[],d=c.includes(a.id);let u;return d?u=c.filter(H=>H!==a.id):u=[...c,a.id],{...r,[t]:u}})},Q=async(t,a)=>{const r=g[t];if(!r||r.length===0)return;const c=r.map(d=>{const u=K(t,d);return u?{id:u.id,code:u.code}:null}).filter(d=>d!==null);if(c.length===0){console.error("No valid products found for selected IDs");return}y(d=>({...d,[t]:"saving"}));try{await S.assignImageToProducts(a,c,x),y(d=>({...d,[t]:"success"}))}catch(d){console.error("Assignment error:",d),y(u=>({...u,[t]:"error"}))}},K=(t,a)=>(b[t]||[]).find(c=>c.id===a);return e.jsxs("div",{className:"bg-white p-6 rounded shadow",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Subida Manual / Individual"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Sube im치genes y b칰scalas manualmente para asignarlas."}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Palabras clave / Contexto (Opcional)"}),e.jsx("input",{type:"text",value:s,onChange:t=>o(t.target.value),placeholder:"Ej: Pincel serie 170, Rodillo epoxi...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Palabras para buscar (adem치s del nombre del archivo)."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Palabras a ignorar (Opcional)"}),e.jsx("input",{type:"text",value:n,onChange:t=>m(t.target.value),placeholder:"Ej: copia, nuevo, 2024...",className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Palabras del nombre del archivo que NO se usar치n en la b칰squeda."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filtrar por Marca (Opcional)"}),e.jsxs("select",{value:T,onChange:t=>q(t.target.value),className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"",children:"-- Todas las marcas --"}),_.map((t,a)=>e.jsx("option",{value:t,children:t},a))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Si seleccionas una marca, la b칰squeda inicial se limitar치 a productos de esa marca."})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:W,className:`block w-full text-sm text-gray-500\r
                file:mr-4 file:py-2 file:px-4\r
                file:rounded-full file:border-0\r
                file:text-sm file:font-semibold\r
                file:bg-blue-50 file:text-blue-700\r
                hover:file:bg-blue-100`}),e.jsx("button",{onClick:G,disabled:N||i.length===0,className:`px-6 py-2 rounded-lg text-white font-bold transition-colors ${N||i.length===0?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:N?"Subiendo...":"Subir Im치genes"})]}),i.length>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[i.length," archivo(s) seleccionado(s)"]})]}),A&&e.jsxs("div",{className:"p-4 bg-red-100 text-red-700 rounded-lg border border-red-200",children:[e.jsx("strong",{children:"Error:"})," ",A]}),v&&v.length>0&&e.jsxs("div",{className:"space-y-8 mt-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Revisar y Asignar"}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm text-gray-700 bg-yellow-50 px-3 py-1 rounded border border-yellow-200 cursor-pointer hover:bg-yellow-100 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:t=>B(t.target.checked),className:"rounded text-yellow-600 focus:ring-yellow-500 h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Reemplazar im치genes existentes"})]})]}),v.map((t,a)=>e.jsxs("div",{className:"bg-gray-50 rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"w-full md:w-1/3 flex-shrink-0",children:[e.jsx("img",{src:t.imageUrl,alt:t.file,className:"w-full h-64 object-contain bg-white rounded-lg border"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:t.file})]}),e.jsxs("div",{className:"flex-grow space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Productos Seleccionados:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(g[a]||[]).length===0&&e.jsx("span",{className:"text-sm text-gray-400 italic",children:"Ning칰n producto seleccionado"}),(g[a]||[]).map(r=>{const c=K(a,r);return e.jsxs("div",{className:"flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm",children:[e.jsx("span",{className:"font-medium mr-2",children:c?c.code:r}),e.jsx("button",{onClick:()=>F(a,{id:r}),className:"hover:text-blue-600",children:e.jsx(J,{size:14})})]},r)})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2 text-sm",children:"Buscar Productos:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por c칩digo o descripci칩n...",className:"flex-grow text-sm border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2",value:h[a]||"",onChange:r=>I(c=>({...c,[a]:r.target.value})),onKeyDown:r=>r.key==="Enter"&&D(a,h[a])}),e.jsx("button",{onClick:()=>D(a,h[a]),className:"p-2 bg-gray-100 text-gray-600 rounded hover:bg-gray-200",children:e.jsx(V,{size:18})})]}),b[a]&&b[a].length>0?e.jsxs("div",{className:"mt-2 max-h-60 overflow-y-auto border border-gray-300 rounded-md bg-white shadow-sm",children:[e.jsx("div",{className:"bg-gray-50 px-3 py-2 border-b text-xs font-semibold text-gray-500 uppercase tracking-wider",children:h[a]?"Resultados de b칰squeda":"Coincidencias encontradas"}),b[a].map(r=>{const c=(g[a]||[]).includes(r.id);return e.jsxs("div",{onClick:()=>F(a,r),className:`p-3 border-b border-gray-100 cursor-pointer hover:bg-blue-50 flex items-start transition-colors ${c?"bg-blue-50":""}`,children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{type:"checkbox",checked:c,readOnly:!0,className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("span",{className:"font-bold text-gray-900",children:r.code}),e.jsx("span",{className:"text-gray-500 mx-1",children:"-"}),e.jsx("span",{className:"text-gray-700",children:r.name||r.description})]})]},r.id)})]}):b[a]&&!h[a]&&e.jsxs("div",{className:"mt-2 p-3 bg-yellow-50 text-yellow-800 text-sm rounded border border-yellow-200 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"丘멆잺"}),e.jsx("span",{children:"No se encontraron coincidencias autom치ticas. Intenta buscar manualmente."})]})]})]})]}),e.jsx("div",{className:"bg-gray-100 p-3 flex justify-end items-center border-t border-gray-200",children:w[a]==="success"?e.jsxs("span",{className:"text-green-600 font-bold flex items-center",children:[e.jsx(z,{className:"mr-2"})," Guardado Exitosamente"]}):e.jsx("button",{onClick:()=>Q(a,t.imageUrl),disabled:w[a]==="saving"||(g[a]||[]).length===0,className:`px-4 py-2 rounded text-sm font-bold text-white ${w[a]==="saving"||(g[a]||[]).length===0?"bg-gray-400":"bg-green-600 hover:bg-green-700"}`,children:w[a]==="saving"?"Guardando...":"Confirmar Asignaci칩n"})})]},a))]}),f&&f.length>0&&e.jsxs("div",{className:"space-y-2 mt-8",children:[e.jsxs("h3",{className:"font-semibold text-red-700",children:["Errores (",f.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:f.map((t,a)=>e.jsxs("div",{className:"p-3 bg-red-50 text-red-800 rounded border border-red-200",children:[e.jsx("p",{className:"font-bold",children:t.file}),e.jsx("p",{className:"text-sm",children:t.error})]},a))})]})]})},re=()=>{const[i,p]=l.useState([]),[N,U]=l.useState(""),[v,k]=l.useState(""),[f,C]=l.useState(""),[A,j]=l.useState([]),[g,P]=l.useState({}),[h,I]=l.useState(!1),[b,E]=l.useState(!1),$=s=>{s.target.files&&p(Array.from(s.target.files))},R=async()=>{if(i.length===0){M.error("Selecciona al menos una imagen");return}I(!0);const s=new FormData;i.forEach(o=>{s.append("images",o)}),s.append("userKeywords",N),s.append("ignoreWords",v),s.append("brand",f),s.append("useAI","true");try{const o=await S.uploadImages(s);j(o.results),M.success("An치lisis completado"),p([])}catch(o){console.error(o),M.error("Error en la subida masiva")}finally{I(!1)}},w=(s,o)=>{P(n=>{const m=n[s]||[];return m.includes(o)?{...n,[s]:m.filter(B=>B!==o)}:{...n,[s]:[...m,o]}})},y=async(s,o)=>{const n=Array.isArray(o)?o:[o];try{await S.assignImageToProducts(s,n,b),M.success("Imagen asignada correctamente"),j(m=>m.map(x=>x.imageUrl===s?{...x,assigned:!0,assignedTo:n}:x))}catch{M.error("Error al asignar imagen")}};return e.jsxs("div",{className:"bg-white p-6 rounded shadow",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Subida de Im치genes de Productos (IA)"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Sube im치genes y as칤gnalas a los productos correspondientes con ayuda de IA."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Contexto (ej: 'L칤nea AAT', 'Pulimentos')",value:N,onChange:s=>U(s.target.value),className:"border p-2 rounded w-full"}),e.jsx("input",{type:"text",placeholder:"Marca (Opcional, ej: '3D', 'Meguiars')",value:f,onChange:s=>C(s.target.value),className:"border p-2 rounded w-full"}),e.jsx("input",{type:"text",placeholder:"Ignorar palabras (ej: 'kit', 'combo')",value:v,onChange:s=>k(s.target.value),className:"border p-2 rounded w-full"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs("label",{className:"cursor-pointer bg-blue-50 text-blue-600 px-4 py-2 rounded font-bold hover:bg-blue-100 transition flex items-center gap-2",children:[e.jsx(ee,{size:20})," Elegir archivos",e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:$})]}),e.jsx("span",{className:"text-gray-500",children:i.length>0?`${i.length} archivos seleccionados`:"Ning칰n archivo seleccionado"}),i.length>0&&e.jsxs("button",{onClick:R,disabled:h,className:"ml-auto bg-espint-blue text-white px-6 py-2 rounded font-bold hover:bg-blue-800 transition disabled:opacity-50 flex items-center gap-2",children:[h?e.jsx(X,{size:"sm"}):e.jsx(ae,{size:20}),"Subir Im치genes"]})]}),A.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Resultados del An치lisis"}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm text-gray-700 bg-yellow-50 px-3 py-1 rounded border border-yellow-200 cursor-pointer hover:bg-yellow-100 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>E(s.target.checked),className:"rounded text-yellow-600 focus:ring-yellow-500 h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Reemplazar im치genes existentes"})]})]}),A.map((s,o)=>e.jsxs("div",{className:`border rounded p-4 flex flex-col md:flex-row gap-4 ${s.assigned?"bg-green-50 border-green-200":"bg-gray-50"}`,children:[e.jsx("div",{className:"w-32 h-32 shrink-0 bg-white rounded border flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:s.imageUrl,alt:s.file,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-md",children:s.file}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 space-y-1",children:[s.aiSuggestion?.code&&e.jsxs("p",{children:["C칩digo IA: ",e.jsx("span",{className:"font-mono bg-gray-200 px-1 rounded",children:s.aiSuggestion.code})]}),s.aiSuggestion?.brand&&e.jsxs("p",{children:["Marca IA: ",e.jsx("span",{className:"font-semibold",children:s.aiSuggestion.brand})]}),s.aiSuggestion?.keywords?.length>0&&e.jsxs("p",{children:["Keywords IA: ",s.aiSuggestion.keywords.join(", ")]})]}),s.aiSelection?.bestMatchId&&e.jsxs("div",{className:"mt-3 bg-blue-50 border border-blue-200 p-2 rounded text-sm",children:[e.jsxs("p",{className:"font-bold text-blue-800 flex items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"游뱄"})," Recomendaci칩n IA"]}),e.jsxs("p",{className:"text-gray-700 text-xs italic mb-1",children:['"',s.aiSelection.reasoning,'"']}),(()=>{const n=s.foundProducts.find(m=>m.id===s.aiSelection.bestMatchId);return n?e.jsxs("div",{className:"flex justify-between items-center bg-white p-2 rounded border border-blue-300 shadow-sm mt-1",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:n.description}),e.jsx("p",{className:"text-xs text-gray-500",children:n.code})]}),!s.assigned&&e.jsx("button",{onClick:()=>y(s.imageUrl,[n.id]),className:"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 shadow-sm",children:"Aceptar"})]}):null})()]})]}),s.assigned&&e.jsxs("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1",children:[e.jsx(z,{size:16})," Asignado"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"font-bold text-sm text-gray-700",children:"Productos Sugeridos:"}),!s.assigned&&(g[o]||[]).length>0&&e.jsxs("button",{onClick:()=>y(s.imageUrl,g[o]),className:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 shadow-sm flex items-center gap-1",children:[e.jsx(z,{size:14})," Confirmar Selecci칩n (",g[o].length,")"]})]}),s.foundProducts&&s.foundProducts.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:s.foundProducts.map(n=>{const m=s.aiSelection?.bestMatchId===n.id,x=(g[o]||[]).includes(n.id);return e.jsxs("div",{onClick:()=>!s.assigned&&w(o,n.id),className:`flex justify-between items-center p-2 rounded border transition cursor-pointer ${x?"bg-blue-100 border-blue-400 ring-1 ring-blue-400":m?"bg-blue-50 border-blue-300":"bg-white hover:bg-gray-50"} ${s.assigned?"opacity-60 cursor-default":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!s.assigned&&e.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${x?"bg-blue-600 border-blue-600":"border-gray-400 bg-white"}`,children:x&&e.jsx(z,{size:10,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:n.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["C칩digo: ",n.code," | Stock: ",n.stock]})]})]}),s.assigned&&s.assignedTo&&s.assignedTo.includes(n.id)&&e.jsx("span",{className:"text-green-600 text-xs font-bold",children:"Asignado"})]},n.id)})}):e.jsxs("div",{className:"flex items-center gap-2 text-orange-600 bg-orange-50 p-2 rounded text-sm",children:[e.jsx(Y,{size:16})," No se encontraron coincidencias autom치ticas."]})]})]})]},o))]})]})},ie=()=>{const[i,p]=l.useState("manual");return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-espint-blue mb-6",children:"Subir Im치genes"}),e.jsxs("div",{className:"flex space-x-4 mb-6 border-b border-gray-200",children:[e.jsx("button",{className:`py-2 px-4 font-semibold ${i==="manual"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>p("manual"),children:"Subida Manual / Individual"}),e.jsx("button",{className:`py-2 px-4 font-semibold ${i==="ai_upload"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>p("ai_upload"),children:"Subida Masiva IA"})]}),i==="manual"?e.jsx(te,{}):e.jsx(re,{})]})};export{ie as default};
