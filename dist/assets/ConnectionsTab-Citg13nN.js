import{j as e,a as h,A as z}from"./index-By-v-Isu.js";import{r as l,aa as b,a4 as u}from"./ui-libs-B_T7o9er.js";import"./vendor-qkC6yhPU.js";const S=({progress:s,message:r})=>e.jsxs("div",{className:"w-full mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:r}),e.jsxs("span",{className:"font-medium text-gray-700",children:[s,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${s}%`}})})]}),P=()=>{const[s,r]=l.useState(!1),[m,g]=l.useState(0),[p,x]=l.useState(""),[t,o]=l.useState(null),f=async c=>{if(s)return;const y=c==="manual"?"¿Deseas iniciar la sincronización manual? Este proceso puede tomar varios minutos.":"¿Deseas iniciar la sincronización TOTAL? Este proceso abarca TODA la base de datos y puede demorar varios minutos.";if(!window.confirm(y))return;r(!0),o(c),g(0),x("Iniciando conexión...");const j=localStorage.getItem("authToken"),w=`${z}/admin/sync-events?token=${j}`,v=()=>new Promise((i,N)=>{const n=new EventSource(w);n.onopen=()=>{console.log("SSE Connection Opened"),i(n)},n.onmessage=d=>{try{const a=JSON.parse(d.data);a.type==="progress"&&(a.percent!==null&&g(a.percent),a.message&&x(a.message),a.status==="completed"?(u.success(a.message||"Sincronización completada"),n.close(),r(!1),o(null)):a.status==="error"&&(u.error(a.message||"Error en la sincronización"),n.close(),r(!1),o(null)))}catch(a){console.error("Error parsing SSE data",a)}},n.onerror=d=>{console.error("SSE Error",d),n.readyState===2&&(n.close(),r(!1),o(null),N(new Error("Connection failed")))}});try{const i=await v();c==="manual"?await h.triggerManualSync():await h.triggerFullSync()}catch(i){console.error(i),u.error("No se pudo establecer conexión para la sincronización."),r(!1),o(null)}};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center relative overflow-hidden",children:[e.jsx("div",{className:"bg-green-100 p-4 rounded-full mb-4",children:e.jsx(b,{size:40,className:`text-green-600 ${s&&t==="manual"?"animate-spin":""}`})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Sincronización Manual"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Ejecuta manualmente el proceso de sincronización de productos y precios desde Protheus."}),s&&t==="manual"?e.jsx(S,{progress:m,message:p}):e.jsx("button",{onClick:()=>f("manual"),disabled:s,className:`bg-green-600 text-white px-4 py-2 rounded font-bold hover:bg-green-700 transition w-full ${s?"opacity-50 cursor-not-allowed":""}`,children:s?"Sincronizando...":"Sincronizar Ahora"})]}),e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center relative overflow-hidden",children:[e.jsx("div",{className:"bg-purple-100 p-4 rounded-full mb-4",children:e.jsx(b,{size:40,className:`text-purple-600 ${s&&t==="full"?"animate-spin":""}`})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Sincronización Total"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Sincroniza Productos, Precios, Clientes y Vendedores. Útil para actualizaciones masivas o iniciales."}),s&&t==="full"?e.jsx(S,{progress:m,message:p}):e.jsx("button",{onClick:()=>f("full"),disabled:s,className:`bg-purple-600 text-white px-4 py-2 rounded font-bold hover:bg-purple-700 transition w-full ${s?"opacity-50 cursor-not-allowed":""}`,children:s?"Sincronizando...":"Sincronizar Todo"})]})]})};export{P as default};
