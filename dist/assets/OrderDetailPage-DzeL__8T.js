import{l as F,u as R,b as U,r as d,R as _,e as I,j as e,d as S,a as n}from"./index-BSitqhbl.js";import{A as L}from"./arrow-left-B7VcC6yx.js";import{F as E}from"./file-text-zLXMMlSX.js";import{C as O}from"./cloud-upload-BI8dz1ZA.js";const $=()=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"});function T(){const{orderId:o}=F(),i=R(),c=$(),{user:l}=U(),[x,m]=d.useState(!1),[u,g]=d.useState(!1),[p,f]=d.useState(!1),[h,b]=d.useState(!1),y=_.useRef(null),{data:s,isLoading:v,error:w}=I({queryKey:["orderDetail",o],queryFn:()=>n.fetchOrderDetail(o),enabled:!!o&&!!l?.id}),N=async()=>{m(!0);try{const t=await n.downloadOrderPDF(o),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`Pedido_${o}.pdf`,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a)}catch(t){console.error("Error al descargar el PDF:",t),alert(`No se pudo descargar el PDF: ${t.message}`)}finally{m(!1)}},C=async()=>{g(!0);try{const t=await n.downloadOrderCSV(o),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`Pedido_${o}.csv`,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a)}catch(t){console.error("Error al descargar el CSV:",t),alert(`No se pudo descargar el CSV: ${t.message}`)}finally{g(!1)}},D=async t=>{const a=t.target.files[0];if(!a)return;if(a.type!=="application/pdf"){alert("Solo se permiten archivos PDF.");return}f(!0);const r=new FormData;r.append("invoiceFile",a);try{await n.uploadOrderInvoice(o,r),alert("Factura subida exitosamente."),window.location.reload()}catch(j){console.error("Error al subir factura:",j),alert(`Error al subir factura: ${j.message}`)}finally{f(!1)}},P=async()=>{b(!0);try{const t=await n.downloadOrderInvoice(o),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`Factura_Pedido_${o}.pdf`,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a)}catch(t){console.error("Error al descargar factura:",t),alert(`Error al descargar factura: ${t.message}`)}finally{b(!1)}},k=()=>{y.current?.click()};return v?e.jsx(S,{text:"Cargando detalles del pedido..."}):w?e.jsxs("div",{children:["Error al cargar el pedido: ",w.message]}):s?e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-6 border-b-2 border-gray-200 pb-2",children:["Detalle del Pedido #",s.id]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8 items-center",children:[e.jsx("button",{onClick:()=>i("/order-history"),className:"hidden md:block px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors duration-200 font-semibold",children:"Volver al Historial"}),e.jsxs("button",{onClick:()=>i("/order-history"),className:"md:hidden flex items-center text-gray-600 mb-2 self-start",children:[e.jsx(L,{className:"w-5 h-5 mr-1"}),"Volver"]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsx("button",{onClick:N,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200",disabled:x,children:x?"PDF...":"Descargar PDF"}),l?.role==="vendedor"&&e.jsx("button",{onClick:C,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",disabled:u,children:u?"CSV...":"Descargar CSV"}),s.invoice_url&&e.jsxs("button",{onClick:P,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200",disabled:h,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),h?"Descargando...":"Descargar Factura"]}),l?.role==="vendedor"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:y,className:"hidden",accept:"application/pdf",onChange:D}),e.jsxs("button",{onClick:k,className:"flex-1 md:flex-none inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors duration-200",disabled:p,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),p?"Subiendo...":"Adjuntar Factura"]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-8 shadow-md relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-900",children:"Fecha:"})," ",s.formatted_date]}),s.status==="Confirmado"&&s.vendor_sales_order_number&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-900",children:"N째 Pedido Venta:"})," #",s.vendor_sales_order_number]}),e.jsxs("p",{className:"md:hidden",children:[e.jsx("strong",{className:"text-gray-900",children:"Estado:"})," ",s.status]})]}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("strong",{className:"text-gray-700",children:"Estado:"})," ",s.status]}),e.jsx("div",{className:`md:hidden absolute top-0 right-0 px-3 py-1 rounded-bl-lg text-xs font-bold uppercase tracking-wide
                ${s.status==="Pendiente"?"bg-yellow-100 text-yellow-800":""}
                ${s.status==="Confirmado"?"bg-green-100 text-green-800":""}
                ${s.status==="Cancelado"||s.status==="Rechazado"?"bg-red-100 text-red-800":""}
                ${["Pendiente","Confirmado","Cancelado","Rechazado"].includes(s.status)?"":"bg-gray-100 text-gray-800"}
            `,children:s.status})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex justify-between items-end",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Total del Pedido:"}),e.jsx("span",{className:"text-2xl font-bold text-[#183B64]",children:s.formattedTotal})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mt-8 mb-3 border-b-2 border-gray-200 pb-2",children:"Items del Pedido"}),e.jsx("div",{className:"md:hidden space-y-4",children:s.items.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 leading-snug",children:t.product_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["C처d: ",t.product_code]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-50 text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:[t.quantity," x ",t.formattedPrice]}),e.jsx("div",{className:"font-bold text-gray-900",children:c.format(t.quantity*t.unit_price)})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto bg-white rounded-lg shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"C처digo"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Descripci처n"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Precio Unit."}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Subtotal"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800",children:t.product_code}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800",children:t.product_name}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:t.formattedPrice}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-800 text-center",children:c.format(t.quantity*t.unit_price)})]},t.id))})]})})]}):e.jsx("div",{children:"Pedido no encontrado."})}export{T as default};
