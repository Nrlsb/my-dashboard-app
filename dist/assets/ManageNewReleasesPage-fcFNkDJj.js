const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LaunchGroupsTab-BHdCWZzQ.js","assets/index-B--VbndO.js","assets/ui-libs-D3puNWdD.js","assets/vendor-qkC6yhPU.js","assets/index-DOPaUwGW.css","assets/useMutation-BSP_14MZ.js"])))=>i.map(i=>d[i]);
import{f as Y,u as Z,b as H,c as J,j as e,L as R,a as v,_ as ee}from"./index-B--VbndO.js";import{r as c,A as se,S as te,Y as ae,z as N,a6 as re,Z as ne,_ as ie,X as T,$ as oe,w as le,a0 as ce}from"./ui-libs-D3puNWdD.js";import{u as D}from"./useMutation-BSP_14MZ.js";import{u as de}from"./useInfiniteQuery-B5DUwJJ7.js";import"./vendor-qkC6yhPU.js";const ue=c.lazy(()=>ee(()=>import("./LaunchGroupsTab-BHdCWZzQ.js"),__vite__mapDeps([0,1,2,3,4,5]))),z=({checked:s,onChange:x,disabled:d,labelOff:p,labelOn:r,colorClass:l="bg-purple-600"})=>e.jsx("button",{type:"button",onClick:x,disabled:d,className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${s?l:"bg-gray-300"} ${d?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,"aria-label":s?r||"Desactivar":p||"Activar",children:e.jsx("span",{className:`inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200 ease-in-out ${s?"translate-x-6":"translate-x-1"}`})}),me=({product:s,onClose:x,onSave:d,isSaving:p})=>{const[r,l]=c.useState({custom_title:s.custom_title||"",custom_description:s.custom_description||"",custom_image_url:s.custom_image_url||""}),f=i=>{const{name:g,value:a}=i.target;l(j=>({...j,[g]:a}))},h=i=>{i.preventDefault(),d(s.id,r)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Editar Lanzamiento"}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx(T,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto p-6",children:e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título Personalizado"}),e.jsx("input",{type:"text",name:"custom_title",value:r.custom_title,onChange:f,placeholder:s.name,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar en blanco para usar el nombre original."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Personalizada"}),e.jsx("textarea",{name:"custom_description",value:r.custom_description,onChange:f,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagen Personalizada"}),(r.custom_image_url||r.previewUrl)&&e.jsxs("div",{className:"mb-2 relative w-full h-48 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:[e.jsx("img",{src:r.previewUrl||r.custom_image_url,alt:"Preview",className:"w-full h-full object-contain",referrerPolicy:"no-referrer"}),e.jsx("button",{type:"button",onClick:()=>l(i=>({...i,custom_image_url:"",previewUrl:""})),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-sm",title:"Eliminar imagen",children:e.jsx(T,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"flex-1 cursor-pointer bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),r.isUploading?"Subiendo...":"Seleccionar Imagen",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:r.isUploading,onChange:async i=>{const g=i.target.files[0];if(!g)return;const a=URL.createObjectURL(g);l(u=>({...u,isUploading:!0,previewUrl:a}));const j=new FormData;j.append("image",g);try{const u=await v.uploadToDrive(j);l(m=>({...m,custom_image_url:u.imageUrl,isUploading:!1})),N.success("Imagen subida a Drive correctamente")}catch(u){console.error(u),N.error("Error al subir imagen"),l(m=>({...m,isUploading:!1}))}}})]})})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 cursor-pointer",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:p||r.isUploading,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 flex items-center disabled:opacity-50 cursor-pointer",children:p?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})})]})]})})]})})},xe=({product:s,onToggle:x,isToggling:d,onEdit:p,viewMode:r})=>{const l=h=>{if(!h)return"-";try{return new Date(h).toLocaleDateString("es-AR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return"-"}},f=r==="included"?s.inclusion_date:r==="modified"?s.modification_date:s.inclusion_date;return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500 font-mono",children:s.code}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 font-medium",children:e.jsxs("div",{children:[s.custom_title||s.name,s.custom_title&&e.jsx("span",{className:"ml-2 text-xs text-purple-600 bg-purple-50 px-2 py-0.5 rounded-full border border-purple-100",children:"Personalizado"})]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:s.is_new_release?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.jsx(re,{className:"w-4 h-4 mr-1 fill-current"}),"Lanzamiento"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Estándar"]})}),r!==null&&e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500 font-mono whitespace-nowrap",children:l(f)}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx(z,{checked:!!s.is_new_release,onChange:x,disabled:d}),s.is_new_release&&e.jsx("button",{onClick:()=>p(s),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors cursor-pointer",title:"Editar detalles de lanzamiento",children:e.jsx(ie,{className:"w-5 h-5"})})]})})]})};function ye(){const[s,x]=c.useState("general"),[d,p]=c.useState(""),[r,l]=c.useState(""),[f,h]=c.useState(null),[i,g]=c.useState("included"),[a,j]=c.useState(!1),u=c.useRef(null),m=Y(),A=Z(),{user:w}=H();c.useEffect(()=>(u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{l(d)},500),()=>clearTimeout(u.current)),[d]);const{data:U,fetchNextPage:F,hasNextPage:L,isFetchingNextPage:E,isLoading:I,isError:$,error:q}=de({queryKey:["products",r,["new_releases",i]],queryFn:async({pageParam:t=1})=>{const n=await v.fetchProducts(t,r,[],!0,20,"",!1,!1,i),b=await v.fetchNewReleases(),o=new Map(b.map(y=>[y.code,y])),P=n.products.map(y=>{const _=o.get(y.code);return{...y,is_new_release:!!_,custom_title:_?.custom_title,custom_description:_?.custom_description,custom_image_url:_?.custom_image_url,inclusion_date:y.inclusion_date,modification_date:y.modification_date}});return{...n,products:P}},getNextPageParam:(t,n)=>n.reduce((o,P)=>o+P.products.length,0)<t.totalProducts?n.length+1:void 0,initialPageParam:1,enabled:!!(w?.is_admin||w?.role==="marketing")&&!a&&s==="general"}),{data:Q,isLoading:M,isError:K,error:G}=J({queryKey:["activeNewReleases",r],queryFn:async()=>{const n=(await v.fetchNewReleases()).map(o=>({...o,is_new_release:!0}));if(!r)return n;const b=r.toLowerCase();return n.filter(o=>o.name.toLowerCase().includes(b)||o.code.toLowerCase().includes(b))},enabled:!!(w?.is_admin||w?.role==="marketing")&&a&&s==="general"}),{mutate:O,isPending:V}=D({mutationFn:t=>v.toggleProductNewRelease(t),onSuccess:t=>{m.setQueryData(["products",r,["new_releases",i]],n=>n&&{...n,pages:n.pages.map(b=>({...b,products:b.products.map(o=>o.id===t.id?{...o,is_new_release:t.is_new_release}:o)}))}),m.invalidateQueries({queryKey:["activeNewReleases"]}),m.invalidateQueries({queryKey:["newReleases"]}),N.success(t.is_new_release?"Lanzamiento activado":"Lanzamiento desactivado")},onError:t=>N.error(`Error: ${t.message}`)}),{mutate:X,isPending:B}=D({mutationFn:({productId:t,details:n})=>v.updateProductNewReleaseDetails(t,n),onSuccess:()=>{m.invalidateQueries({queryKey:["products"]}),m.invalidateQueries({queryKey:["activeNewReleases"]}),m.invalidateQueries({queryKey:["newReleases"]}),h(null),N.success("Detalles actualizados")},onError:t=>N.error(`Error: ${t.message}`)}),C=a?Q||[]:U?.pages.flatMap(t=>t.products)||[],S=a?M:I,k=a?K:$,W=a?G:q;return!w?.is_admin&&w?.role!=="marketing"?e.jsx("div",{className:"p-8 text-center text-red-500",children:"Acceso denegado."}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("header",{className:"mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>A("/manage-content"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsx(se,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Gestionar Nuevos Lanzamientos"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona productos individuales y grupos de lanzamiento."})]})]})}),e.jsxs("div",{className:"flex space-x-4 mb-6 border-b border-gray-200",children:[e.jsx("button",{className:`py-2 px-4 font-semibold ${s==="general"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500 hover:text-gray-700"}`,onClick:()=>x("general"),children:"Productos Individuales"}),e.jsx("button",{className:`py-2 px-4 font-semibold ${s==="groups"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500 hover:text-gray-700"}`,onClick:()=>x("groups"),children:"Grupos de Lanzamiento"})]}),s==="general"&&e.jsxs("div",{className:"animate-fadeIn",children:[e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(te,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",value:d,onChange:t=>p(t.target.value),placeholder:"Buscar por nombre o código...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-3 bg-white p-2 rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex space-x-2 mr-4 border-r pr-4 border-gray-200",children:[e.jsx("button",{onClick:()=>g("included"),disabled:a,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${i==="included"&&!a?"bg-purple-100 text-purple-800":"text-gray-600 hover:bg-gray-50 disabled:opacity-50"}`,children:"Productos Incluidos"}),e.jsx("button",{onClick:()=>g("modified"),disabled:a,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${i==="modified"&&!a?"bg-purple-100 text-purple-800":"text-gray-600 hover:bg-gray-50 disabled:opacity-50"}`,children:"Producto Modificado"}),e.jsx("button",{onClick:()=>g("all"),disabled:a,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${i==="all"&&!a?"bg-purple-100 text-purple-800":"text-gray-600 hover:bg-gray-50 disabled:opacity-50"}`,children:"Todos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:`w-5 h-5 ${a?"text-purple-600":"text-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ver solo activos"})]}),e.jsx(z,{checked:a,onChange:()=>j(!a),labelOff:"Todo",labelOn:"Activos",colorClass:"bg-purple-600"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gray-100 border-b border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Código"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Descripción"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Estado"}),!a&&e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Fecha"}),e.jsx("th",{className:"py-3 px-4 text-center text-xs font-semibold text-gray-600 uppercase",children:"Acciones"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[S&&e.jsx("tr",{children:e.jsx("td",{colSpan:a?"4":"5",className:"p-0",children:e.jsx(R,{text:"Cargando productos..."})})}),k&&e.jsx("tr",{children:e.jsxs("td",{colSpan:a?"4":"5",className:"p-8 text-center text-red-500",children:["Error: ",W?.message]})}),!S&&!k&&C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:a?"4":"5",className:"p-8 text-center text-gray-500",children:"No se encontraron productos."})}),C.map(t=>e.jsx(xe,{product:t,onToggle:()=>O(t.id),isToggling:V,onEdit:h,viewMode:a?null:i},t.id))]})]})}),!a&&e.jsxs("div",{className:"p-4 text-center",children:[L&&e.jsx("button",{onClick:()=>F(),disabled:E,className:"mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 disabled:opacity-50 cursor-pointer",children:E?"Cargando...":"Cargar más productos"}),!L&&!S&&C.length>0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Fin de los resultados."})]})]})]}),s==="groups"&&e.jsx(c.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(ue,{})}),f&&e.jsx(me,{product:f,onClose:()=>h(null),onSave:(t,n)=>X({productId:t,details:n}),isSaving:B})]})}export{ye as default};
