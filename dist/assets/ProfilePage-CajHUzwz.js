import{u as M,b as w,f as P,c as D,j as e,a as b}from"./index-DPS1l8Lk.js";import{r as m,u as f,U as x,O,M as L,P as S,I as U,s as I}from"./ui-libs-BtkfA6K7.js";import{u as k}from"./useMutation-B-4m24I7.js";import"./vendor-qkC6yhPU.js";const n=({icon:s,label:c,id:t,...o})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-1",children:c}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(s,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{id:t,className:"w-full pl-10 p-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",...o})]})]}),R=()=>e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"})]}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"}),e.jsx("div",{className:"bg-gray-200 h-12 rounded-lg"})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("div",{className:"bg-gray-200 h-10 w-28 rounded-lg"})})]}),B=({message:s})=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-md",children:[e.jsx("p",{className:"text-red-500 font-semibold text-lg",children:"Error al cargar el perfil"}),e.jsx("p",{className:"text-gray-600 mt-2",children:s})]});function z(){const[s,c]=m.useState({A1_COD:"",A1_LOJA:"",A1_NOME:"",A1_EMAIL:"",A1_NUMBER:"",A1_CGC:"",A1_END:""}),[t,o]=m.useState(""),[u,g]=m.useState(""),h=M(),{user:l}=w(),N=P(),{data:a,isLoading:v,isError:p,error:A,isSuccess:j}=D({queryKey:["userProfile",l?.id],queryFn:()=>b.fetchUserProfile(),enabled:!!l?.id,staleTime:1e3*60*15});m.useEffect(()=>{j&&a&&c({A1_COD:a.A1_COD||"",A1_LOJA:a.A1_LOJA||"",A1_NOME:a.A1_NOME||"",A1_EMAIL:a.A1_EMAIL||"",A1_NUMBER:a.A1_NUMBER||"",A1_CGC:a.A1_CGC||"",A1_END:a.A1_END||""})},[j,a]);const i=k({mutationFn:b.updateUserProfile,onSuccess:r=>{o("¡Perfil actualizado con éxito!"),g(""),N.invalidateQueries({queryKey:["userProfile",l?.id]}),N.invalidateQueries({queryKey:["currentUser"]})},onError:r=>{g(r.message||"Error al guardar los cambios."),o("")}}),d=r=>{const{id:C,value:_}=r.target;c(E=>({...E,[C]:_}))},y=r=>{r.preventDefault(),o(""),g(""),i.mutate(s)};if(v)return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("header",{className:"mb-6 flex items-center",children:[e.jsx("button",{onClick:()=>h("/dashboard"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors","aria-label":"Volver al dashboard",children:e.jsx(f,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Mi Perfil"}),e.jsx("p",{className:"text-gray-600",children:"Actualiza tu información personal y de contacto."})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto",children:e.jsx(R,{})})]});if(p){const r=l?.id?A.message:"No se ha podido identificar al usuario.";return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("header",{className:"mb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Mi Perfil"})}),e.jsx(B,{message:r})]})}return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("header",{className:"mb-6 flex items-center",children:[e.jsx("button",{onClick:()=>h("/dashboard"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors","aria-label":"Volver al dashboard",children:e.jsx(f,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Mi Perfil"}),e.jsx("p",{className:"text-gray-600",children:"Actualiza tu información personal y de contacto."})]})]}),e.jsx("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto",children:e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(n,{icon:x,label:l?.role==="vendedor"?"Código de Vendedor":"Código de Cliente",id:"A1_COD",value:s.A1_COD,onChange:d,disabled:!0})}),e.jsx(n,{icon:x,label:l?.role==="vendedor"?"Nombre":"Nombre / Razón Social",id:"A1_NOME",value:s.A1_NOME,onChange:d,disabled:i.isPending}),l?.role!=="vendedor"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:x,label:"CUIT",id:"A1_CGC",value:s.A1_CGC,onChange:d,disabled:i.isPending}),e.jsx(n,{icon:O,label:"Dirección",id:"A1_END",value:s.A1_END,onChange:d,disabled:i.isPending})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{icon:L,label:"Email de Contacto",id:"A1_EMAIL",type:"email",value:s.A1_EMAIL,onChange:d,disabled:i.isPending}),e.jsx(n,{icon:S,label:"Teléfono",id:"A1_NUMBER",type:"tel",value:s.A1_NUMBER,onChange:d,disabled:i.isPending})]}),u&&e.jsxs("div",{className:"flex items-center p-3 bg-red-100 text-red-700 rounded-md",children:[e.jsx(U,{className:"w-5 h-5 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:u})]}),t&&e.jsxs("div",{className:"flex items-center p-3 bg-green-100 text-green-700 rounded-md",children:[e.jsx(I,{className:"w-5 h-5 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:t})]})]})})]})}export{z as default};
