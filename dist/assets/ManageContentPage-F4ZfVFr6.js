import{c as D,r,a as o,A as a,j as e,d as f,h as L}from"./index-DL2Lzwsl.js";import{C as $}from"./CustomSelect-Qiv_Vp7U.js";import{P as q,T as y}from"./trash-2-DbDgSUlO.js";import{X as v}from"./x-CY1L5sdB.js";import"./check-BB_irszG.js";const le=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],ce=D("file-spreadsheet",le);const ne=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ie=D("square-pen",ne),pe=()=>{const[l,m]=r.useState("accessories"),[U,N]=r.useState(!1),[w,O]=r.useState([]),[x,B]=r.useState([]),[F,h]=r.useState(!1),[H,p]=r.useState(!1),[V,C]=r.useState(!1),[d,b]=r.useState(""),[g,S]=r.useState([]),[k,G]=r.useState(!1),[u,A]=r.useState("static_group"),[E,_]=r.useState(""),[z,M]=r.useState(""),[P,R]=r.useState(""),[X,J]=r.useState([]),[c,K]=r.useState(null),[I,j]=r.useState([]);r.useEffect(()=>{n()},[l]);const n=async()=>{N(!0);try{if(l==="accessories"){const s=await o.getAccessories();O(s)}else{const s=await o.getCarouselGroups();B(s)}}catch(s){console.error(s),a.error("Error al cargar datos")}finally{N(!1)}},T=async s=>{if(s.preventDefault(),!!d.trim()){G(!0);try{const t=await o.fetchProducts(1,d);S(t.products)}catch{a.error("Error al buscar productos")}finally{G(!1)}}},Q=async s=>{try{await o.addAccessory(s),a.success("Accesorio agregado"),n(),h(!1)}catch{a.error("Error al agregar accesorio")}},W=async s=>{if(window.confirm("¿Estás seguro de eliminar este accesorio?"))try{await o.removeAccessory(s),a.success("Accesorio eliminado"),n()}catch{a.error("Error al eliminar accesorio")}},Y=async()=>{p(!0);try{const s=await o.getAdminProductGroups();J(s)}catch{a.error("Error al cargar grupos disponibles")}},Z=async s=>{s.preventDefault();try{await o.createCarouselGroup({name:E,image_url:z,type:u,reference_id:u==="static_group"?P:null,display_order:x.length+1}),a.success("Grupo creado"),p(!1),n(),ee()}catch{a.error("Error al crear grupo")}},ee=()=>{_(""),M(""),A("static_group"),R("")},se=async s=>{if(window.confirm("¿Estás seguro de eliminar este grupo?"))try{await o.deleteCarouselGroup(s),a.success("Grupo eliminado"),n()}catch{a.error("Error al eliminar grupo")}},te=async s=>{K(s),C(!0);try{const t=await o.getCustomCollectionProducts(s.id);j(t)}catch{a.error("Error al cargar items de la colección")}},re=async s=>{try{await o.addCustomGroupItem(c.id,s),a.success("Producto agregado a la colección");const t=await o.getCustomCollectionProducts(c.id);j(t)}catch{a.error("Error al agregar producto")}},ae=async s=>{try{await o.removeCustomGroupItem(c.id,s),a.success("Producto eliminado de la colección");const t=await o.getCustomCollectionProducts(c.id);j(t)}catch{a.error("Error al eliminar producto")}},oe=async()=>{try{const s=await o.downloadMissingImagesReport(),t=window.URL.createObjectURL(s),i=document.createElement("a");i.href=t,i.download="reporte_faltantes.xlsx",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(t),document.body.removeChild(i),a.success("Reporte descargado correctamente")}catch(s){console.error(s),a.error("Error al descargar el reporte")}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-espint-blue mb-6",children:"Gestionar Contenido"}),e.jsxs("div",{className:"flex space-x-4 mb-6 border-b border-gray-200 overflow-x-auto whitespace-nowrap pb-1",children:[e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="accessories"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>m("accessories"),children:[e.jsx("span",{className:"md:hidden",children:"Accesorios"}),e.jsx("span",{className:"hidden md:inline",children:"Accesorios (Carousel)"})]}),e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="groups"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>m("groups"),children:[e.jsx("span",{className:"md:hidden",children:"Grupos"}),e.jsx("span",{className:"hidden md:inline",children:"Grupos de Productos (Carousel)"})]}),e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="reports"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>m("reports"),children:[e.jsx("span",{className:"md:hidden",children:"Reportes"}),e.jsx("span",{className:"hidden md:inline",children:"Reportes y Análisis"})]})]}),U?e.jsx(f,{}):e.jsxs("div",{children:[l==="accessories"&&e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{h(!0),S([]),b("")},className:"bg-espint-green text-white px-4 py-2 rounded mb-4 flex items-center gap-2 hover:bg-green-600 transition",children:[e.jsx(q,{size:20})," Agregar Accesorio"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[w.map(s=>e.jsxs("div",{className:"relative aspect-square bg-gray-800 rounded shadow overflow-hidden group",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover opacity-70 group-hover:opacity-50 transition-opacity"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-2 pointer-events-none",children:[e.jsx("h3",{className:"font-bold text-white text-center text-sm md:text-base leading-tight drop-shadow-md",children:s.name}),e.jsx("p",{className:"text-gray-200 text-xs mt-1 drop-shadow-md",children:s.code})]}),e.jsx("button",{onClick:()=>W(s.id),className:"absolute bottom-2 right-2 bg-red-500 text-white p-1.5 rounded opacity-100 md:opacity-0 group-hover:opacity-100 transition shadow-lg z-10",title:"Eliminar",children:e.jsx(y,{size:16})})]},s.id)),w.length===0&&e.jsx("p",{className:"text-gray-500",children:"No hay accesorios configurados."})]})]}),l==="groups"&&e.jsxs("div",{children:[e.jsxs("button",{onClick:Y,className:"bg-espint-green text-white px-4 py-2 rounded mb-4 flex items-center gap-2 hover:bg-green-600 transition",children:[e.jsx(q,{size:20})," Agregar Grupo"]}),e.jsxs("div",{className:"space-y-4",children:[x.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded shadow flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:s.name,className:"w-16 h-16 object-cover rounded shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg leading-tight",children:s.name||`Grupo ${s.reference_id}`}),e.jsx("span",{className:`text-xs px-2 py-1 rounded inline-block mt-1 ${s.type==="static_group"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:s.type==="static_group"?"Grupo Existente":"Colección Personalizada"})]})]}),e.jsxs("div",{className:"flex gap-2 self-end md:self-auto",children:[s.type==="custom_collection"&&e.jsx("button",{onClick:()=>te(s),className:"text-blue-500 hover:text-blue-700 p-2",title:"Editar Productos",children:e.jsx(ie,{size:20})}),e.jsx("button",{onClick:()=>se(s.id),className:"text-red-500 hover:text-red-700 p-2",title:"Eliminar Grupo",children:e.jsx(y,{size:20})})]})]},s.id)),x.length===0&&e.jsx("p",{className:"text-gray-500",children:"No hay grupos configurados."})]})]}),l==="reports"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center",children:[e.jsx("div",{className:"bg-blue-100 p-4 rounded-full mb-4",children:e.jsx(ce,{size:40,className:"text-blue-600"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Productos Sin Imágenes"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Genera un reporte Excel con todos los productos activos que no tienen imágenes asignadas."}),e.jsx("button",{onClick:oe,className:"bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition w-full",children:"Descargar Excel"})]})})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Agregar Producto"}),e.jsx("button",{onClick:()=>h(!1),children:e.jsx(v,{size:24})})]}),e.jsxs("form",{onSubmit:T,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre o código...",className:"flex-1 border p-2 rounded",value:d,onChange:s=>b(s.target.value)}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:e.jsx(L,{size:20})})]}),k&&e.jsx(f,{}),e.jsx("div",{className:"space-y-2",children:g.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.code})]}),e.jsx("button",{onClick:()=>Q(s.id),className:"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600",children:"Agregar"})]},s.id))})]})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Agregar Grupo al Carousel"}),e.jsx("button",{onClick:()=>p(!1),children:e.jsx(v,{size:24})})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Tipo"}),e.jsx($,{options:[{label:"Grupo Existente",value:"static_group"},{label:"Colección Personalizada",value:"custom_collection"}],value:u,onChange:s=>A(s),placeholder:"Seleccionar Tipo"})]}),u==="static_group"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Seleccionar Grupo"}),e.jsx($,{options:X.map(s=>({label:`${s.brand} (${s.product_group})`,value:s.product_group})),value:P,onChange:s=>R(s),placeholder:"-- Seleccionar --"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Nombre de la Colección"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:E,onChange:s=>_(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"URL de Imagen (Opcional)"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:z,onChange:s=>M(s.target.value)})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-espint-blue text-white py-2 rounded font-bold hover:bg-blue-800 transition",children:"Crear Grupo"})]})]})}),V&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Editar Colección: ",c.name]}),e.jsx("button",{onClick:()=>C(!1),children:e.jsx(v,{size:24})})]}),e.jsxs("form",{onSubmit:T,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar productos para agregar...",className:"flex-1 border p-2 rounded",value:d,onChange:s=>b(s.target.value)}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:e.jsx(L,{size:20})})]}),k&&e.jsx(f,{}),g.length>0&&e.jsxs("div",{className:"mb-4 border-b pb-4",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Resultados de Búsqueda"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:g.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.code})]}),e.jsx("button",{onClick:()=>re(s.id),className:"bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600",children:"Agregar"})]},s.id))})]}),e.jsx("h3",{className:"font-bold mb-2",children:"Productos en la Colección"}),e.jsxs("div",{className:"space-y-2",children:[I.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.code})]}),e.jsx("button",{onClick:()=>ae(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(y,{size:18})})]},s.id)),I.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"No hay productos en esta colección."})]})]})})]})};export{pe as default};
