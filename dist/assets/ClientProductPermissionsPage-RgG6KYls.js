import{b as _,a as y,j as e,L as $}from"./index-Br7A3Qex.js";import{r}from"./ui-libs-D3puNWdD.js";import"./vendor-qkC6yhPU.js";const U=()=>{const{user:l}=_(),[a,g]=r.useState([]),[i,b]=r.useState([]),[n,j]=r.useState(""),[N,h]=r.useState([]),[v,c]=r.useState(!1),[E,P]=r.useState(!1),[w,d]=r.useState(null),[S,C]=r.useState(""),[u,G]=r.useState(""),[o,R]=r.useState(1),p=10,[m,f]=r.useState(!1),F=async()=>{if(m){f(!1);return}if(f(!0),a.length===0&&i.length===0){if(!l||!l.is_admin){d("Acceso denegado. Requiere permisos de administrador.");return}try{c(!0),d(null);const s=await y.getGlobalDeniedProducts(),t=s.map(T=>T.code);g(t),b(s)}catch(s){d("Error al cargar las restricciones globales."),console.error(s)}finally{c(!1)}}};r.useEffect(()=>{const s=setTimeout(async()=>{if(n.length<3){h([]);return}try{P(!0);const t=await y.fetchProducts(1,n,[],!1,100);h(t.products)}catch(t){console.error("Error searching products:",t)}finally{P(!1)}},500);return()=>clearTimeout(s)},[n]),r.useEffect(()=>{R(1)},[u]);const L=i.filter(s=>s.name&&s.name.toLowerCase().includes(u.toLowerCase())||s.code&&s.code.toLowerCase().includes(u.toLowerCase())),x=Math.ceil(L.length/p),k=(o-1)*p,A=L.slice(k,k+p),D=s=>{s>=1&&s<=x&&R(s)},q=s=>{a.includes(s.code)||(g([...a,s.code]),b([...i,s]),m||f(!0))},B=s=>{g(a.filter(t=>t!==s)),b(i.filter(t=>t.code!==s))},I=async()=>{try{c(!0),d(null),C(""),await y.updateGlobalProductPermissions(a),C("Restricciones globales guardadas con éxito.")}catch(s){d("Error al guardar las restricciones."),console.error(s)}finally{c(!1)}};return!l||!l.is_admin?e.jsx("div",{className:"text-center p-8 text-red-500",children:"Acceso denegado. No tiene permisos de administrador."}):e.jsxs("div",{className:"p-8 max-w-4xl mx-auto bg-gray-50 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-center mb-8 text-gray-800",children:"Gestionar Restricciones Globales de Productos"}),e.jsxs("p",{className:"text-center text-gray-600 mb-6",children:["Los productos seleccionados aquí estarán ocultos para ",e.jsx("strong",{children:"todos los usuarios"})," (excepto administradores)."]}),S&&e.jsx("p",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:S}),w&&e.jsx("p",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:w}),e.jsxs("div",{className:"mt-4 p-6 border border-gray-200 rounded-lg bg-white",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"font-bold block mb-2",children:"Buscar Producto para Restringir:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:s=>j(s.target.value),placeholder:"Buscar por nombre o código...",className:"p-2 rounded border border-gray-300 w-full"}),n&&e.jsx("button",{onClick:()=>{j(""),h([])},className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Limpiar"})]}),E&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Buscando..."}),N.length>0&&e.jsx("ul",{className:"mt-2 border border-gray-200 rounded max-h-60 overflow-y-auto bg-white shadow-lg",children:N.map(s=>{const t=a.includes(s.code);return e.jsxs("li",{className:`p-2 hover:bg-gray-100 cursor-pointer flex justify-between items-center ${t?"bg-blue-50":""}`,onClick:()=>!t&&q(s),children:[e.jsxs("span",{children:[s.name," ",e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",s.code,")"]})]}),e.jsx("span",{className:`text-sm font-semibold ${t?"text-green-600":"text-blue-600"}`,children:t?"Agregado":"Agregar"})]},s.id)})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-700 m-0",children:["Productos Restringidos Globalmente (",a.length,")"]}),e.jsx("button",{onClick:F,className:"text-blue-600 hover:text-blue-800 text-sm font-semibold underline",children:m?"Ocultar Lista":"Ver Lista Completa"})]}),m&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",value:u,onChange:s=>G(s.target.value),placeholder:"Filtrar lista de restringidos...",className:"p-2 rounded border border-gray-300 w-full text-sm"})}),v?e.jsx($,{text:"Cargando productos..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-4",children:A.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No hay productos que coincidan."}):A.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 border border-red-100 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["(",s.code,")"]})]}),e.jsx("button",{onClick:()=>B(s.code),className:"text-red-600 hover:text-red-800 font-semibold",children:"Quitar"})]},s.id))}),x>1&&e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("button",{onClick:()=>D(o-1),disabled:o===1,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50 hover:bg-gray-300 transition-colors",children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Página ",o," de ",x]}),e.jsx("button",{onClick:()=>D(o+1),disabled:o===x,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50 hover:bg-gray-300 transition-colors",children:"Siguiente"})]})]})]}),e.jsx("button",{onClick:I,disabled:v,className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed w-full sm:w-auto mt-4",children:"Guardar Cambios"})]})]})};export{U as default};
