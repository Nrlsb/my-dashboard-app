import{a as o,j as e,L as k}from"./index-C-zGBuFS.js";import{r as t,a2 as a,T as he,a3 as pe,u as V,q as A,Y as ge,a4 as be,a5 as X,X as b,S as Y,a1 as H}from"./ui-libs-CH5ZO-RL.js";import{C as J}from"./CustomSelect-BNS5PVAs.js";import"./vendor-qkC6yhPU.js";const ve=()=>{const[l,x]=t.useState("general"),[c,m]=t.useState(!1),[P,K]=t.useState([]),[N,Q]=t.useState([]),[W,v]=t.useState(!1),[Z,w]=t.useState(!1),[ee,I]=t.useState(!1),[j,C]=t.useState(""),[S,R]=t.useState([]),[U,_]=t.useState(!1),[f,T]=t.useState("static_group"),[D,L]=t.useState(""),[G,h]=t.useState(""),[M,$]=t.useState(""),[se,re]=t.useState([]),[i,O]=t.useState(null),[q,E]=t.useState([]),[z,F]=t.useState(""),[y,p]=t.useState("");t.useEffect(()=>{l!=="general"&&u()},[l]);const u=async()=>{m(!0);try{if(l==="accessories"){const s=await o.getAccessories();K(s)}else if(l==="groups"){const s=await o.getCarouselGroups();Q(s)}}catch(s){console.error(s),a.error("Error al cargar datos")}finally{m(!1)}},B=async s=>{if(s.preventDefault(),!!j.trim()){_(!0);try{const r=await o.fetchProducts(1,j);R(r.products)}catch{a.error("Error al buscar productos")}finally{_(!1)}}},ae=async s=>{try{await o.addAccessory(s),a.success("Accesorio agregado"),u(),v(!1)}catch{a.error("Error al agregar accesorio")}},te=async s=>{if(window.confirm("¿Estás seguro de eliminar este accesorio?"))try{await o.removeAccessory(s),a.success("Accesorio eliminado"),u()}catch{a.error("Error al eliminar accesorio")}},oe=async()=>{w(!0);try{const s=await o.getAdminProductGroups();re(s)}catch{a.error("Error al cargar grupos disponibles")}},le=async s=>{s.preventDefault();try{await o.createCarouselGroup({name:D,image_url:G,type:f,reference_id:f==="static_group"?M:null,display_order:N.length+1}),a.success("Grupo creado"),w(!1),u(),ce()}catch{a.error("Error al crear grupo")}},ce=()=>{L(""),h(""),T("static_group"),$("")},ne=async s=>{if(window.confirm("¿Estás seguro de eliminar este grupo?"))try{await o.deleteCarouselGroup(s),a.success("Grupo eliminado"),u()}catch{a.error("Error al eliminar grupo")}},ie=async s=>{O(s),F(s.name||""),p(s.image_url||""),I(!0);try{const r=await o.getCustomCollectionProducts(s.id);E(r)}catch{a.error("Error al cargar items de la colección")}},de=async()=>{try{await o.updateCarouselGroup(i.id,{name:z,image_url:y}),a.success("Grupo actualizado"),u(),O(s=>({...s,name:z,image_url:y}))}catch{a.error("Error al actualizar grupo")}},me=async s=>{try{await o.addCustomGroupItem(i.id,s),a.success("Producto agregado a la colección");const r=await o.getCustomCollectionProducts(i.id);E(r)}catch{a.error("Error al agregar producto")}},ue=async s=>{try{await o.removeCustomGroupItem(i.id,s),a.success("Producto eliminado de la colección");const r=await o.getCustomCollectionProducts(i.id);E(r)}catch{a.error("Error al eliminar producto")}},xe=async()=>{try{const s=await o.downloadMissingImagesReport(),r=window.URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download="reporte_faltantes.xlsx",document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n),a.success("Reporte descargado correctamente")}catch(s){console.error(s),a.error("Error al descargar el reporte")}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-espint-blue mb-6",children:"Gestionar Contenido"}),e.jsxs("div",{className:"flex space-x-4 mb-6 border-b border-gray-200 overflow-x-auto whitespace-nowrap pb-1",children:[e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="general"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>x("general"),children:[e.jsx("span",{className:"md:hidden",children:"General"}),e.jsx("span",{className:"hidden md:inline",children:"General"})]}),e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="accessories"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>x("accessories"),children:[e.jsx("span",{className:"md:hidden",children:"Accesorios"}),e.jsx("span",{className:"hidden md:inline",children:"Accesorios"})]}),e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="groups"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>x("groups"),children:[e.jsx("span",{className:"md:hidden",children:"Grupos"}),e.jsx("span",{className:"hidden md:inline",children:"Grupos de Productos"})]}),e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="reports"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>x("reports"),children:[e.jsx("span",{className:"md:hidden",children:"Reportes"}),e.jsx("span",{className:"hidden md:inline",children:"Reportes y Análisis"})]}),e.jsxs("button",{className:`py-2 px-4 font-semibold ${l==="connections"?"text-espint-blue border-b-2 border-espint-blue":"text-gray-500"}`,onClick:()=>x("connections"),children:[e.jsx("span",{className:"md:hidden",children:"Conexiones"}),e.jsx("span",{className:"hidden md:inline",children:"Conexiones"})]})]}),c?e.jsx(k,{}):e.jsxs("div",{children:[l==="general"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:[e.jsxs("a",{href:"/manage-offers",className:"p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow flex flex-col items-center justify-center text-center border border-gray-100 group",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-full mb-3 group-hover:bg-blue-100 transition-colors",children:e.jsx(he,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Gestionar Ofertas"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Activar/desactivar y personalizar ofertas"})]}),e.jsxs("a",{href:"/manage-new-releases",className:"p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow flex flex-col items-center justify-center text-center border border-gray-100 group",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-full mb-3 group-hover:bg-purple-100 transition-colors",children:e.jsx(pe,{className:"h-8 w-8 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Gestionar Nuevos Lanzamientos"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Destacar productos como nuevos"})]})]}),l==="accessories"&&e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>{v(!0),R([]),C("")},className:"bg-espint-green text-white px-4 py-2 rounded mb-4 flex items-center gap-2 hover:bg-green-600 transition",children:[e.jsx(V,{size:20})," Agregar Accesorio"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[P.map(s=>e.jsxs("div",{className:"relative aspect-square bg-gray-800 rounded shadow overflow-hidden group",children:[e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover opacity-70 group-hover:opacity-50 transition-opacity"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-2 pointer-events-none",children:[e.jsx("h3",{className:"font-bold text-white text-center text-sm md:text-base leading-tight drop-shadow-md",children:s.name}),e.jsx("p",{className:"text-gray-200 text-xs mt-1 drop-shadow-md",children:s.code})]}),e.jsx("button",{onClick:()=>te(s.id),className:"absolute bottom-2 right-2 bg-red-500 text-white p-1.5 rounded opacity-100 md:opacity-0 group-hover:opacity-100 transition shadow-lg z-10",title:"Eliminar",children:e.jsx(A,{size:16})})]},s.id)),P.length===0&&e.jsx("p",{className:"text-gray-500",children:"No hay accesorios configurados."})]})]}),l==="groups"&&e.jsxs("div",{children:[e.jsxs("button",{onClick:oe,className:"bg-espint-green text-white px-4 py-2 rounded mb-4 flex items-center gap-2 hover:bg-green-600 transition",children:[e.jsx(V,{size:20})," Agregar Grupo"]}),e.jsxs("div",{className:"space-y-4",children:[N.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded shadow flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:s.name,className:"w-16 h-16 object-cover rounded shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg leading-tight",children:s.name||`Grupo ${s.reference_id}`}),e.jsx("span",{className:`text-xs px-2 py-1 rounded inline-block mt-1 ${s.type==="static_group"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:s.type==="static_group"?"Grupo Existente":"Colección Personalizada"})]})]}),e.jsxs("div",{className:"flex gap-2 self-end md:self-auto",children:[s.type==="custom_collection"&&e.jsx("button",{onClick:()=>ie(s),className:"text-blue-500 hover:text-blue-700 p-2",title:"Editar Productos",children:e.jsx(ge,{size:20})}),e.jsx("button",{onClick:()=>ne(s.id),className:"text-red-500 hover:text-red-700 p-2",title:"Eliminar Grupo",children:e.jsx(A,{size:20})})]})]},s.id)),N.length===0&&e.jsx("p",{className:"text-gray-500",children:"No hay grupos configurados."})]})]}),l==="reports"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center",children:[e.jsx("div",{className:"bg-blue-100 p-4 rounded-full mb-4",children:e.jsx(be,{size:40,className:"text-blue-600"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Productos Sin Imágenes"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Genera un reporte Excel con todos los productos activos que no tienen imágenes asignadas."}),e.jsx("button",{onClick:xe,className:"bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition w-full",children:"Descargar Excel"})]})}),l==="connections"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center",children:[e.jsx("div",{className:"bg-green-100 p-4 rounded-full mb-4",children:e.jsx(X,{size:40,className:"text-green-600"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Sincronización Manual"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Ejecuta manualmente el proceso de sincronización de productos y precios desde Protheus."}),e.jsx("button",{onClick:async()=>{if(window.confirm("¿Deseas iniciar la sincronización manual? Este proceso puede tomar varios minutos."))try{const s=o.triggerManualSync();a.promise(s,{loading:"Iniciando sincronización...",success:"Sincronización completada",error:"Error al sincronizar"}),await s}catch(s){console.error(s)}},className:"bg-green-600 text-white px-4 py-2 rounded font-bold hover:bg-green-700 transition w-full",children:"Sincronizar Ahora"})]}),e.jsxs("div",{className:"bg-white p-6 rounded shadow border border-gray-200 flex flex-col items-center text-center",children:[e.jsx("div",{className:"bg-purple-100 p-4 rounded-full mb-4",children:e.jsx(X,{size:40,className:"text-purple-600"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Sincronización Total"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Sincroniza Productos, Precios, Clientes y Vendedores. Útil para actualizaciones masivas o iniciales."}),e.jsx("button",{onClick:async()=>{if(window.confirm("¿Deseas iniciar la sincronización TOTAL? Este proceso abarca TODA la base de datos y puede demorar varios minutos."))try{const s=o.triggerFullSync();a.promise(s,{loading:"Iniciando sincronización completa...",success:"Sincronización total completada",error:"Error al sincronizar"}),await s}catch(s){console.error(s)}},className:"bg-purple-600 text-white px-4 py-2 rounded font-bold hover:bg-purple-700 transition w-full",children:"Sincronizar Todo"})]})]})]}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Agregar Producto"}),e.jsx("button",{onClick:()=>v(!1),children:e.jsx(b,{size:24})})]}),e.jsxs("form",{onSubmit:B,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre o código...",className:"flex-1 border p-2 rounded",value:j,onChange:s=>C(s.target.value)}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:e.jsx(Y,{size:20})})]}),U&&e.jsx(k,{}),e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.code})]})]}),e.jsx("button",{onClick:()=>ae(s.id),className:"bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600",children:"Agregar"})]},s.id))})]})}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Agregar Grupo al Carousel"}),e.jsx("button",{onClick:()=>w(!1),children:e.jsx(b,{size:24})})]}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Tipo"}),e.jsx(J,{options:[{label:"Grupo Existente",value:"static_group"},{label:"Colección Personalizada",value:"custom_collection"}],value:f,onChange:s=>T(s),placeholder:"Seleccionar Tipo"})]}),f==="static_group"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Seleccionar Grupo"}),e.jsx(J,{options:se.map(s=>({label:`${s.brand} (${s.product_group})`,value:s.product_group})),value:M,onChange:s=>$(s),placeholder:"-- Seleccionar --"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Nombre de la Colección"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:D,onChange:s=>L(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Imagen de la Colección"}),G&&e.jsxs("div",{className:"mb-2 relative w-full h-32 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:[e.jsx("img",{src:G,alt:"Preview",className:"w-full h-full object-contain",referrerPolicy:"no-referrer"}),e.jsx("button",{type:"button",onClick:()=>h(""),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-sm",title:"Eliminar imagen",children:e.jsx(b,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"flex-1 cursor-pointer bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),c?"Subiendo...":"Seleccionar Imagen",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:c,onChange:async s=>{const r=s.target.files[0];if(!r)return;const n=URL.createObjectURL(r);h(n),m(!0);const g=new FormData;g.append("image",r);try{const d=await o.uploadToDrive(g);h(d.imageUrl),a.success("Imagen subida a Drive correctamente")}catch(d){console.error(d),a.error("Error al subir imagen"),h("")}finally{m(!1)}}})]})})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-espint-blue text-white py-2 rounded font-bold hover:bg-blue-800 transition",disabled:c,children:"Crear Grupo"})]})]})}),ee&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Editar Colección: ",i.name]}),e.jsx("button",{onClick:()=>I(!1),children:e.jsx(b,{size:24})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded border border-gray-200",children:[e.jsx("h3",{className:"font-bold mb-3 text-gray-700",children:"Detalles del Grupo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Nombre"}),e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:z,onChange:s=>F(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Imagen"}),y&&e.jsxs("div",{className:"mb-2 relative w-full h-32 bg-white rounded-md overflow-hidden border border-gray-200",children:[e.jsx("img",{src:y,alt:"Preview",className:"w-full h-full object-contain",referrerPolicy:"no-referrer"}),e.jsx("button",{type:"button",onClick:()=>p(""),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-sm",title:"Eliminar imagen",children:e.jsx(b,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"flex-1 cursor-pointer bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),c?"Subiendo...":"Cambiar Imagen",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",disabled:c,onChange:async s=>{const r=s.target.files[0];if(!r)return;const n=URL.createObjectURL(r);p(n),m(!0);const g=new FormData;g.append("image",r);try{const d=await o.uploadToDrive(g);p(d.imageUrl),a.success("Imagen subida a Drive correctamente")}catch(d){console.error(d),a.error("Error al subir imagen"),p("")}finally{m(!1)}}})]})})]})]}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{onClick:de,className:`bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition ${c?"opacity-50 cursor-not-allowed":""}`,disabled:c,children:c?"Guardando...":"Guardar Cambios"})})]}),e.jsxs("form",{onSubmit:B,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar productos para agregar...",className:"flex-1 border p-2 rounded",value:j,onChange:s=>C(s.target.value)}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded",children:e.jsx(Y,{size:20})})]}),U&&e.jsx(k,{}),S.length>0&&e.jsxs("div",{className:"mb-4 border-b pb-4",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Resultados de Búsqueda"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:S.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-10 h-10 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.code})]})]}),e.jsx("button",{onClick:()=>me(s.id),className:"bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600",children:"Agregar"})]},s.id))})]}),e.jsx("h3",{className:"font-bold mb-2",children:"Productos en la Colección"}),e.jsxs("div",{className:"space-y-2",children:[q.map(s=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-10 h-10 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.code})]})]}),e.jsx("button",{onClick:()=>ue(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(A,{size:18})})]},s.id)),q.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"No hay productos en esta colección."})]})]})})]})};export{ve as default};
