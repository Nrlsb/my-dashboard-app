import{c as C,l as S,u as A,g as E,b as I,r as x,e as P,j as e,S as D,a as N}from"./index-C_92WgPb.js";import{A as _}from"./arrow-left-8U7cF0ts.js";import{P as W}from"./package-Bhkqiqcc.js";import{C as F}from"./circle-check-big-BYl7W7FL.js";import{S as w}from"./sparkles-C1fs6BZI.js";import{T as G}from"./triangle-alert-CJ22Vrb8.js";import{L}from"./loader-circle-D8nY74SV.js";import{S as M}from"./square-pen-CgFXK_dB.js";const R=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],T=C("info",R),q=r=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(r||0),B=()=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"bg-gray-200 h-96 rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-200 h-8 w-1/3 rounded"}),e.jsx("div",{className:"bg-gray-200 h-12 w-3/4 rounded"}),e.jsx("div",{className:"bg-gray-200 h-8 w-1/4 rounded"}),e.jsx("div",{className:"bg-gray-200 h-20 w-full rounded"}),e.jsx("div",{className:"bg-gray-200 h-12 w-1/2 rounded"})]})]})}),v=({message:r})=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-md",children:[e.jsx(G,{className:"w-12 h-12 text-red-500 mb-4"}),e.jsx("p",{className:"text-red-500 font-semibold text-lg",children:"Error al cargar el producto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:r})]});function X(){const{productId:r}=S(),g=A(),{addToCart:i}=E(),{user:u}=I(),[c,d]=x.useState(1),[p,h]=x.useState(!1),{data:s,isLoading:o,isError:j,error:y}=P({queryKey:["product",r,u?.id],queryFn:()=>N.fetchProductById(r),enabled:!!r}),t=()=>{s&&(i(s,c),h(!0),setTimeout(()=>h(!1),2e3))},m=a=>{const l=a.stock_disponible!==void 0?a.stock_disponible:a.stock,f=a.stock_de_seguridad||0;return l<=0?e.jsx("span",{className:"inline-flex items-center p-1.5 rounded-full bg-red-100 bg-opacity-50 text-red-800",title:"Sin Stock",children:e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})}):l<=f?e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 bg-opacity-50 text-yellow-800",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full mr-1"}),"Stock Bajo"]}):e.jsx("span",{className:"inline-flex items-center p-1.5 rounded-full bg-green-100 bg-opacity-50 text-green-800",title:"Disponible",children:e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})})},n=()=>o?e.jsx(B,{}):j?e.jsx(v,{message:y.message}):s?e.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"flex items-center justify-center bg-gray-100 rounded-lg h-80 md:h-96 overflow-hidden",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-contain",referrerPolicy:"no-referrer"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-24 h-24 text-gray-400"}),e.jsx("span",{className:"absolute text-gray-500 text-sm mt-32",children:"Imagen de producto"})]})}),e.jsxs("div",{className:"flex flex-col justify-center space-y-4",children:[e.jsx("span",{className:"text-sm font-medium text-blue-600 uppercase",children:s.brand||"Marca"}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"text-4xl font-extrabold text-gray-800",children:q(s.price)}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:s.description||s.capacity_description}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Cantidad:"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>d(a=>Math.max(1,a-1)),className:"px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-l-lg cursor-pointer",children:"-"}),e.jsx("input",{type:"number",value:c,onChange:a=>d(Math.max(1,parseInt(a.target.value,10)||1)),className:"w-16 text-center border-none focus:ring-0",min:"1"}),e.jsx("button",{onClick:()=>d(a=>a+1),className:"px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-r-lg cursor-pointer",children:"+"})]})]}),e.jsx("button",{onClick:t,className:`w-full py-3 px-6 rounded-lg text-white font-semibold transition-colors duration-300 cursor-pointer ${p?"bg-green-500 hover:bg-green-600":"bg-blue-600 hover:bg-blue-700"}`,children:p?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2"}),"Agregado"]}):e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Agregar al Carrito"]})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Cód: ",s.code]})]}),e.jsx("div",{className:"flex items-center font-medium",children:m(s)})]})]})]}),e.jsxs("div",{className:"mt-12 border-t pt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(w,{className:"w-6 h-6 text-purple-600 mr-2"}),"Detalles del Producto"]})}),e.jsx(Q,{product:s,isAdmin:u?.is_admin})]})]}):e.jsx(v,{message:"No se encontró el producto."});return e.jsxs("div",{className:"p-6 bg-white min-h-screen",children:[e.jsxs("header",{className:"mb-6 flex items-center",children:[e.jsx("button",{onClick:()=>g(-1),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Volver",children:e.jsx(_,{className:"w-6 h-6"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Detalle del Producto"})})]}),n()]})}const Q=({product:r,isAdmin:g})=>{const[i,u]=x.useState(r.ai_description||""),[c,d]=x.useState(!1),[p,h]=x.useState(!1),[s,o]=x.useState(!1),j=async()=>{d(!0);try{const t=await N.generateAiDescription(r.id,{name:r.name,brand:r.brand,price:r.price,formattedPrice:r.formattedPrice});u(t.description),o(!0)}catch(t){console.error("Error generating description:",t),alert("Error al generar la descripción")}finally{d(!1)}},y=async()=>{h(!0);try{await N.saveAiDescription(r.id,i),o(!1)}catch(t){console.error("Error saving description:",t),alert("Error al guardar la descripción")}finally{h(!1)}};return!g&&!i?null:e.jsx("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-100",children:!s&&!i?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"No hay descripción generada por IA para este producto."}),g&&e.jsx("button",{onClick:j,disabled:c,className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:c?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2 animate-spin"}),"Generando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Generar Descripción con IA"]})})]}):e.jsxs("div",{className:"space-y-4",children:[s?e.jsx("textarea",{value:i,onChange:t=>u(t.target.value),className:"w-full h-40 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Descripción del producto..."}):e.jsx("div",{className:"prose max-w-none text-gray-700",children:i.split(`
`).map((t,m)=>{const n=t.trim();if(!n)return e.jsx("div",{className:"h-2"},m);if(n.startsWith("**")&&n.endsWith("**")&&!n.includes(":"))return e.jsx("h4",{className:"text-lg font-bold text-gray-900 mt-4 mb-2",children:n.replace(/\*\*/g,"")},m);if(n.startsWith("* ")||n.startsWith("- ")){const f=n.substring(2).split(/(\*\*.*?\*\*)/g);return e.jsxs("div",{className:"flex items-start mb-1 ml-4",children:[e.jsx("span",{className:"mr-2 text-purple-500",children:"•"}),e.jsx("span",{children:f.map((b,k)=>b.startsWith("**")&&b.endsWith("**")?e.jsx("strong",{className:"font-semibold text-gray-900",children:b.replace(/\*\*/g,"")},k):b)})]},m)}const a=t.split(/(\*\*.*?\*\*)/g);return e.jsx("p",{className:"mb-2 leading-relaxed",children:a.map((l,f)=>l.startsWith("**")&&l.endsWith("**")?e.jsx("strong",{className:"font-semibold text-gray-900",children:l.replace(/\*\*/g,"")},f):l)},m)})}),g&&e.jsx("div",{className:"flex justify-end space-x-3",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancelar"}),e.jsx("button",{onClick:y,disabled:p,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:p?"Guardando...":"Guardar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:j,disabled:c,className:"px-4 py-2 text-purple-600 hover:bg-purple-100 rounded-lg transition-colors",children:c?"Regenerando...":"Regenerar"}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Editar"]})]})})]})})};export{X as default};
