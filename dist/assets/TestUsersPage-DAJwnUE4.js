import{f as M,c as P,a as g,j as e,u as O}from"./index-BGFVR-Os.js";import{r,c as L}from"./ui-libs-DeieS4Kk.js";import{u as w}from"./useMutation-GoRl1t-X.js";import{b as Q,F as _,c as q,d as I}from"./index-CBI14r1h.js";import{T as R}from"./TestUserAnalyticsModal-DSOsvlOB.js";import{C as $}from"./ConfirmationModal-DH1ux98q.js";import"./vendor-qkC6yhPU.js";const V=()=>{const n=M(),[t,h]=r.useState({name:"",password:"",cellphone:""}),[b,l]=r.useState(null),[y,v]=r.useState(null),[C,f]=r.useState(!1),[o,c]=r.useState(null),[U,m]=r.useState(!1),j=5,{data:i=[],isLoading:S}=P({queryKey:["testUsers"],queryFn:async()=>(await g.getTestUsers()).data.users||[]}),a=i.length>=j,d=w({mutationFn:s=>g.createTestUser(s),onSuccess:()=>{n.invalidateQueries(["testUsers"]),h({name:"",password:"",cellphone:""}),l(null)},onError:s=>{l(s.message)}}),N=w({mutationFn:s=>g.deleteTestUser(s),onSuccess:()=>{n.invalidateQueries(["testUsers"])},onError:s=>{l(s.message)}}),x=s=>{const{name:u,value:p}=s.target;h(F=>({...F,[u]:p}))},D=s=>{if(s.preventDefault(),!t.name||!t.password){l("Nombre y contraseña son obligatorios.");return}d.mutate(t)},T=s=>{const u=i.find(p=>p.id===s);c(u||{id:s}),m(!0)},E=()=>{o&&N.mutate(o.id),m(!1),c(null)},k=()=>{m(!1),c(null)},A=s=>{v(s),f(!0)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2",children:[e.jsx(Q,{className:"text-blue-600"})," Gestión de Usuarios de Prueba"]}),e.jsxs("div",{className:"mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Crear Nuevo Usuario"}),a&&e.jsxs("div",{className:"mb-4 text-amber-700 bg-amber-50 p-3 rounded border border-amber-200",children:["Has alcanzado el límite de ",j," usuarios activos. Debes eliminar uno para poder crear otro."]}),b&&e.jsx("div",{className:"mb-4 text-red-600 bg-red-50 p-3 rounded",children:b}),e.jsxs("form",{onSubmit:D,className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:x,className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border disabled:bg-gray-100 disabled:text-gray-500",placeholder:"Ej. Cliente Prueba",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contraseña"}),e.jsx("input",{type:"text",name:"password",value:t.password,onChange:x,className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border disabled:bg-gray-100 disabled:text-gray-500",placeholder:"Contraseña",disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Celular"}),e.jsx("input",{type:"text",name:"cellphone",value:t.cellphone,onChange:x,className:"w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border disabled:bg-gray-100 disabled:text-gray-500",placeholder:"Ej. +549...",disabled:a})]}),e.jsx("button",{type:"submit",disabled:d.isPending||a,className:`px-4 py-2 rounded-md transition-colors flex items-center justify-center gap-2 h-[42px] ${a||d.isPending?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:d.isPending?"Creando...":"Crear Usuario"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Usuarios Activos"}),S?e.jsx("p",{className:"text-gray-500",children:"Cargando usuarios..."}):i.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No hay usuarios de prueba creados."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credenciales"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contacto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Creado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Baja Automática"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded text-xs",children:s.password})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 flex items-center gap-2",children:[s.cellphone&&e.jsx(_,{className:"text-green-500"})," ",s.cellphone||"-"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(new Date(s.created_at).getTime()+10080*60*1e3).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>A(s),className:"text-blue-600 hover:text-blue-900 bg-blue-50 p-2 rounded-full transition-colors focus:outline-none",title:"Ver Análisis",children:e.jsx(L,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>T(s.id),className:"text-red-600 hover:text-red-900 bg-red-50 p-2 rounded-full transition-colors focus:outline-none",title:"Eliminar usuario",disabled:N.isPending,children:e.jsx(q,{})})]})]},s.id))})]})})]}),e.jsx(R,{isOpen:C,onClose:()=>f(!1),userId:y?.id,userName:y?.name}),e.jsx($,{isOpen:U,onClose:k,onConfirm:E,title:"Eliminar Usuario de Prueba",message:`¿Estás seguro de eliminar este usuario de prueba${o?.name?` ${o.name}`:""}?`,confirmText:"Eliminar",variant:"danger"})]})},J=()=>{const n=O();return e.jsx("div",{className:"p-8 bg-gray-50 min-h-screen font-sans",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>n(-1),className:"mb-6 text-gray-600 hover:text-blue-600 flex items-center gap-2 transition-colors",children:[e.jsx(I,{})," Volver"]}),e.jsx(V,{})]})})};export{J as default};
