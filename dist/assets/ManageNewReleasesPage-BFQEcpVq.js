import{r as u,i as P,u as q,b as A,j as e,h as M,d as $,a as f,z as y}from"./index-HaypTO0E.js";import{u as z}from"./useMutation-CIp0L9GL.js";import{u as K}from"./useInfiniteQuery-CqwhgtbK.js";import{A as G}from"./arrow-left-VnuV4HLR.js";import{S as I}from"./star-DyqASUOA.js";import{C as X,P as B}from"./pen-DCUofiK0.js";import{X as U}from"./x-552kiOEN.js";import{L as V}from"./loader-circle-Bt8pj9RZ.js";import{S as H}from"./save-BmFlX-TI.js";const J=({checked:t,onChange:n,disabled:r})=>e.jsx("button",{type:"button",onClick:n,disabled:r,className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${t?"bg-purple-600":"bg-gray-300"} ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,"aria-label":t?"Desactivar lanzamiento":"Activar lanzamiento",children:e.jsx("span",{className:`inline-block w-4 h-4 transform bg-white rounded-full transition-transform duration-200 ease-in-out ${t?"translate-x-6":"translate-x-1"}`})}),O=({product:t,onClose:n,onSave:r,isSaving:c})=>{const[l,x]=u.useState({custom_title:t.custom_title||"",custom_description:t.custom_description||"",custom_image_url:t.custom_image_url||""}),o=g=>{const{name:m,value:N}=g.target;x(w=>({...w,[m]:N}))},d=g=>{g.preventDefault(),r(t.id,l)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Editar Lanzamiento"}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:d,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título Personalizado"}),e.jsx("input",{type:"text",name:"custom_title",value:l.custom_title,onChange:o,placeholder:t.name,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar en blanco para usar el nombre original."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción Personalizada"}),e.jsx("textarea",{name:"custom_description",value:l.custom_description,onChange:o,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL de Imagen Personalizada"}),e.jsx("input",{type:"text",name:"custom_image_url",value:l.custom_image_url,onChange:o,placeholder:"https://ejemplo.com/imagen.jpg",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 cursor-pointer",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:c,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 flex items-center disabled:opacity-50 cursor-pointer",children:c?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})})]})]})]})})},W=({product:t,onToggle:n,isToggling:r,onEdit:c})=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500 font-mono",children:t.code}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-900 font-medium",children:e.jsxs("div",{children:[t.custom_title||t.name,t.custom_title&&e.jsx("span",{className:"ml-2 text-xs text-purple-600 bg-purple-50 px-2 py-0.5 rounded-full border border-purple-100",children:"Personalizado"})]})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:t.is_new_release?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.jsx(I,{className:"w-4 h-4 mr-1 fill-current"}),"Lanzamiento"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"Estándar"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx(J,{checked:!!t.is_new_release,onChange:n,disabled:r}),t.is_new_release&&e.jsx("button",{onClick:()=>c(t),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors cursor-pointer",title:"Editar detalles de lanzamiento",children:e.jsx(B,{className:"w-5 h-5"})})]})})]});function le(){const[t,n]=u.useState(""),[r,c]=u.useState(""),[l,x]=u.useState(null),o=u.useRef(null),d=P(),g=q(),{user:m}=A();u.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{c(t)},500),()=>clearTimeout(o.current)),[t]);const{data:N=[],isLoading:w}=P().getQueryData(["newReleases"])||{},{data:R,fetchNextPage:E,hasNextPage:L,isFetchingNextPage:v,isLoading:_,isError:C,error:k}=K({queryKey:["products",r,["new_releases"]],queryFn:async({pageParam:s=1})=>{const a=await f.fetchProducts(s,r,[],!0),p=await f.fetchNewReleases(),i=new Map(p.map(h=>[h.code,h])),j=a.products.map(h=>{const b=i.get(h.code);return{...h,is_new_release:!!b,custom_title:b?.custom_title,custom_description:b?.custom_description,custom_image_url:b?.custom_image_url}});return{...a,products:j}},getNextPageParam:(s,a)=>a.reduce((i,j)=>i+j.products.length,0)<s.totalProducts?a.length+1:void 0,initialPageParam:1,enabled:!!(m?.is_admin||m?.role==="marketing")}),{mutate:D,isPending:T}=z({mutationFn:s=>f.toggleProductNewRelease(s),onSuccess:s=>{d.setQueryData(["products",r,["new_releases"]],a=>a&&{...a,pages:a.pages.map(p=>({...p,products:p.products.map(i=>i.id===s.id?{...i,is_new_release:s.is_new_release}:i)}))}),d.invalidateQueries({queryKey:["newReleases"]}),y.success(s.is_new_release?"Lanzamiento activado correctamente":"Lanzamiento desactivado correctamente")},onError:s=>{y.error(`Error: ${s.message}`)}}),{mutate:F,isPending:Q}=z({mutationFn:({productId:s,details:a})=>f.updateProductNewReleaseDetails(s,a),onSuccess:(s,a)=>{d.invalidateQueries({queryKey:["products",r,["new_releases"]]}),d.invalidateQueries({queryKey:["newReleases"]}),x(null),y.success("Detalles actualizados")},onError:s=>{y.error(`Error: ${s.message}`)}}),S=R?.pages.flatMap(s=>s.products)||[];return!m?.is_admin&&m?.role!=="marketing"?e.jsx("div",{className:"p-8 text-center text-red-500",children:"Acceso denegado."}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("header",{className:"mb-6 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>g("/dashboard-settings"),className:"flex items-center justify-center p-2 mr-4 text-gray-600 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Volver a Configuración",children:e.jsx(G,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Gestionar Nuevos Lanzamientos"}),e.jsx("p",{className:"text-gray-500",children:"Destaca productos como nuevos lanzamientos en la plataforma."})]})]})}),e.jsxs("div",{className:"mb-6 relative",children:[e.jsx(M,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",value:t,onChange:s=>n(s.target.value),placeholder:"Buscar por nombre o código...",className:"w-full max-w-sm pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gray-100 border-b border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Código"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Descripción"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase",children:"Estado"}),e.jsx("th",{className:"py-3 px-4 text-center text-xs font-semibold text-gray-600 uppercase",children:"Acciones"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[_&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-0",children:e.jsx($,{text:"Cargando productos..."})})}),C&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"4",className:"p-8 text-center text-red-500",children:["Error: ",k.message]})}),!_&&!C&&S.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-8 text-center text-gray-500",children:"No se encontraron productos."})}),S.map(s=>e.jsx(W,{product:s,onToggle:()=>D(s.id),isToggling:T,onEdit:x},s.id))]})]})}),e.jsx("div",{className:"p-4 text-center",children:L&&e.jsx("button",{onClick:()=>E(),disabled:v,className:"mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 disabled:opacity-50 cursor-pointer",children:v?"Cargando...":"Cargar más productos"})})]}),l&&e.jsx(O,{product:l,onClose:()=>x(null),onSave:(s,a)=>F({productId:s,details:a}),isSaving:Q})]})}export{le as default};
