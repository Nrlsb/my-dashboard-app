import{a as _,r as t,b as g,j as e,L as D}from"./index-C7vuRkZ8.js";const M=()=>{const{user:n}=_(),[a,x]=t.useState([]),[b,l]=t.useState([]),[d,j]=t.useState(""),[N,h]=t.useState([]),[p,i]=t.useState(!1),[k,P]=t.useState(!1),[v,c]=t.useState(null),[w,C]=t.useState(""),[u,G]=t.useState(""),[o,S]=t.useState(1),f=10;t.useEffect(()=>{(async()=>{if(!n||!n.is_admin){c("Acceso denegado. Requiere permisos de administrador.");return}try{i(!0),c(null);const r=await g.getGlobalDeniedProducts();if(x(r),r.length>0){const I=r.map(y=>g.fetchProductByCode(y)),T=await Promise.all(I);l(T.filter(y=>y!==null))}else l([])}catch(r){c("Error al cargar las restricciones globales."),console.error(r)}finally{i(!1)}})()},[n]),t.useEffect(()=>{const s=setTimeout(async()=>{if(d.length<3){h([]);return}try{P(!0);const r=await g.fetchProducts(1,d,[],!1,100);h(r.products)}catch(r){console.error("Error searching products:",r)}finally{P(!1)}},500);return()=>clearTimeout(s)},[d]),t.useEffect(()=>{S(1)},[u]);const R=b.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())||s.code.toLowerCase().includes(u.toLowerCase())),m=Math.ceil(R.length/f),L=(o-1)*f,E=R.slice(L,L+f),A=s=>{s>=1&&s<=m&&S(s)},B=s=>{a.includes(s.code)||(x([...a,s.code]),l([...b,s]))},F=s=>{x(a.filter(r=>r!==s)),l(b.filter(r=>r.code!==s))},q=async()=>{try{i(!0),c(null),C(""),await g.updateGlobalProductPermissions(a),C("Restricciones globales guardadas con éxito.")}catch(s){c("Error al guardar las restricciones."),console.error(s)}finally{i(!1)}};return p&&a.length===0?e.jsx(D,{text:"Cargando..."}):!n||!n.is_admin?e.jsx("div",{className:"text-center p-8 text-red-500",children:"Acceso denegado. No tiene permisos de administrador."}):e.jsxs("div",{className:"p-8 max-w-4xl mx-auto bg-gray-50 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-center mb-8 text-gray-800",children:"Gestionar Restricciones Globales de Productos"}),e.jsxs("p",{className:"text-center text-gray-600 mb-6",children:["Los productos seleccionados aquí estarán ocultos para ",e.jsx("strong",{children:"todos los usuarios"})," (excepto administradores)."]}),w&&e.jsx("p",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:w}),v&&e.jsx("p",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:v}),e.jsxs("div",{className:"mt-4 p-6 border border-gray-200 rounded-lg bg-white",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"font-bold block mb-2",children:"Buscar Producto para Restringir:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:s=>j(s.target.value),placeholder:"Buscar por nombre o código...",className:"p-2 rounded border border-gray-300 w-full"}),d&&e.jsx("button",{onClick:()=>{j(""),h([])},className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Limpiar"})]}),k&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Buscando..."}),N.length>0&&e.jsx("ul",{className:"mt-2 border border-gray-200 rounded max-h-60 overflow-y-auto bg-white shadow-lg",children:N.map(s=>{const r=a.includes(s.code);return e.jsxs("li",{className:`p-2 hover:bg-gray-100 cursor-pointer flex justify-between items-center ${r?"bg-blue-50":""}`,onClick:()=>!r&&B(s),children:[e.jsxs("span",{children:[s.name," ",e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",s.code,")"]})]}),e.jsx("span",{className:`text-sm font-semibold ${r?"text-green-600":"text-blue-600"}`,children:r?"Agregado":"Agregar"})]},s.id)})})]}),e.jsxs("h3",{className:"mt-0 mb-4 border-b pb-2 text-xl font-semibold text-gray-700",children:["Productos Restringidos Globalmente (",a.length,")"]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",value:u,onChange:s=>G(s.target.value),placeholder:"Filtrar lista de restringidos...",className:"p-2 rounded border border-gray-300 w-full text-sm"})}),p?e.jsx(D,{text:"Cargando productos..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mb-4",children:E.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No hay productos que coincidan."}):E.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 border border-red-100 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["(",s.code,")"]})]}),e.jsx("button",{onClick:()=>F(s.code),className:"text-red-600 hover:text-red-800 font-semibold",children:"Quitar"})]},s.id))}),m>1&&e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("button",{onClick:()=>A(o-1),disabled:o===1,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50 hover:bg-gray-300 transition-colors",children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Página ",o," de ",m]}),e.jsx("button",{onClick:()=>A(o+1),disabled:o===m,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50 hover:bg-gray-300 transition-colors",children:"Siguiente"})]})]}),e.jsx("button",{onClick:q,disabled:p,className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed w-full sm:w-auto",children:"Guardar Cambios"})]})]})};export{M as default};
